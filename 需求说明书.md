# AutoMate 桌面智能体聊天系统需求规格说明书

## 1. 系统概述

### 1.1 项目背景

AutoMate 是一款基于现代 Web 技术栈构建的跨平台桌面智能体聊天系统。该系统旨在为用户提供一个界面精美、安装轻量、功能强大的智能体交互平台。用户可以通过类似 QQ 等即时通讯软件的聊天界面与各种智能体进行对话交互，智能体根据用户输入调用相应的 skill 执行操作，并将执行过程或结果返回给用户。智能体配置统一以 JSON 格式存储，无需复杂的数据库管理。

### 1.2 项目定位

AutoMate 定位为一款智能体交互平台，通过聊天界面实现用户与智能体的交互，智能体根据用户输入调用不同的 skill 执行特定任务，将执行过程或结果返回给用户，提供高效、智能的任务处理体验。

## 2. 系统建设目标

### 2.1 核心建设目标

1. **轻量级跨平台部署**：利用 Tauri 框架的特性，实现 Windows、macOS、Linux 三大平台的桌面应用，安装包体积控制在合理范围内（目标 < 50MB）

2. **现代化用户界面**：采用 React + Tailwind CSS 构建美观、流畅的用户界面，提供类似即时通讯软件的交互体验

3. **智能体对话引擎**：实现智能体与用户的自然语言交互，支持文本和文件输入

4. **Skill 调用框架**：设计灵活的 skill 调用机制，支持智能体根据用户输入调用相应的 skill

5. **Skill 执行管理**：实现 skill 的异步执行、状态管理和结果返回

6. **聊天消息管理**：实现聊天消息、skill 执行过程和结果的存储、查询、导出等功能

7. **智能体配置管理**：智能体信息以 JSON 格式存储，支持为智能体配置可用的 skill

### 2.2 功能目标

- 支持第三方统一认证
- 提供智能体列表展示（智能体配置以 JSON 格式存储）
- 实现类似 QQ 的双击打开聊天窗口交互
- 支持与智能体的实时对话交互
- 支持智能体根据用户输入调用相应的 skill
- 支持显示 skill 执行过程和结果
- 实现聊天记录、skill 执行记录的存储和查询
- 支持跨平台安装和运行

### 2.3 非功能性目标

- **性能**：应用启动时间 < 3 秒，界面操作响应时间 < 300ms
- **兼容性**：支持 Windows 10+、macOS 10.15+、主流 Linux 发行版
- **安全性**：聊天数据本地加密存储
- **可维护性**：模块化架构设计，便于功能扩展和维护
- **易用性**：直观的用户界面，降低用户学习成本

## 3. 系统功能描述

### 3.1 智能体配置管理

#### 3.1.1 智能体列表展示
- 从本地 JSON 文件加载智能体配置
- 类似 QQ 好友列表的侧边栏展示
- 显示智能体名称、头像、在线状态
- 支持智能体搜索和筛选

#### 3.1.2 智能体 skill 配置
- 智能体可用 skill 列表配置（从全局技能配置中选择）
- skill 版本选择和配置覆盖
- skill 调用权限管理

### 3.2 智能体处理模块

#### 3.2.1 消息解析
- 智能体接收用户消息
- 解析消息内容和意图
- 提取关键信息和文件

#### 3.2.2 Skill 匹配和调用
- 根据消息内容匹配合适的 skill
- 构建 skill 调用参数
- 调用 skill 执行
- 管理 skill 执行状态

#### 3.2.3 Skill 结果处理
- 接收 skill 执行结果
- 解析 skill 执行过程和结果
- 生成智能体回复消息

### 3.3 聊天交互模块

#### 3.3.1 聊天窗口
- 双击智能体列表项打开聊天窗口
- 支持多聊天窗口同时打开
- 聊天窗口最小化和关闭
- 窗口状态记忆（位置、大小）

#### 3.3.2 消息发送
- 文本消息输入
- 文件选择和上传功能（支持多文件）
- 支持拖拽文件到输入区
- 显示文件上传进度
- 支持文件预览和删除
- 消息发送功能（统一发送文本和文件）
- 发送状态显示（发送中、已发送、发送失败）
- 消息时间戳显示

#### 3.3.3 消息接收与展示
- 接收智能体回复消息
- 显示 skill 调用过程（可选）
- 显示 skill 执行状态更新
- 显示 skill 执行结果
- 消息实时显示
- 新消息提示（未读消息标识、通知）
- 历史消息加载
- 支持显示带文件附件的消息
- 支持文件下载功能

#### 3.3.4 聊天记录
- 聊天历史保存（包含消息和 skill 执行记录）
- 历史消息查询
- 聊天记录导出（支持包含 skill 执行记录的导出）
- 聊天记录清理

#### 3.3.5 消息管理
- 消息复制功能
- 消息删除功能
- 消息清空功能

### 3.4 skill 管理模块

#### 3.4.1 skill 配置
- 全局 skill 列表管理（通过JSON配置文件）
- skill 版本管理和配置定义
- skill 权限管理
- skill 启用/禁用管理

#### 3.4.2 skill 执行
- skill 执行环境管理
- skill 异步执行支持
- skill 执行状态监控
- skill 执行日志记录

### 3.5 数据管理模块

#### 3.5.1 数据存储
- SQLite 数据库初始化
- 聊天记录存储
- skill 执行记录存储

#### 3.5.2 数据备份
- 聊天数据备份功能
- 自动备份配置
- 备份文件管理

#### 3.5.3 数据恢复
- 聊天数据恢复功能
- 恢复进度显示
- 恢复结果验证

#### 3.5.4 数据导入导出
- 聊天记录导出（JSON、CSV 格式）
- 聊天记录导入功能
- 数据格式校验

## 4. 技术架构

### 4.1 前端技术栈

- **React** 18.2.0+：使用函数组件和 Hooks 进行组件化开发
- **TypeScript** 5.0.0+：提供类型安全和更好的开发体验
- **Tailwind CSS** 3.3.0+：快速构建响应式 UI，实现美观的界面设计
- **Vite** 4.4.0+：作为构建工具，提供快速的开发和构建体验

### 4.2 后端技术栈

- **Tauri** 1.5.0+：基于 Rust 的桌面应用框架，提供轻量级跨平台能力
- **Rust** 1.70.0+：系统级编程语言，提供高性能和安全性
- **Node.js** 18.0.0+：支持 skill 执行环境

### 4.3 数据库

- **SQLite** 3.40.0+：轻量级嵌入式数据库，无需额外安装
- **tauri-plugin-sqlite** 2.0.0+：Tauri 的 SQLite 插件，用于在 Rust 中操作 SQLite

### 4.4 架构设计

```
┌─────────────────────────────────────────────────────────┐
│                    用户界面层                              │
│                  (React + Tailwind)                       │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    业务逻辑层                              │
│                    (Tauri API)                            │
├─────────────────┬─────────────────┬─────────────────────┤
│  智能体配置模块  │   聊天交互模块   │   数据管理模块       │
├─────────────────┼─────────────────┼─────────────────────┤
│                   智能体处理模块   │   skill 管理模块     │
└─────────────────┴─────────────────┴─────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    skill 执行层                           │
│                    (Node.js)                              │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    数据访问层                              │
│                 (tauri-plugin-sqlite)                    │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    数据存储层                              │
│                      (SQLite)                             │
└─────────────────────────────────────────────────────────┘

```

## 5. 非功能性需求

### 5.1 性能要求

- 应用启动时间 < 3 秒
- 界面操作响应时间 < 300ms
- 消息发送延迟 < 500ms
- 数据库查询响应时间 < 100ms（常规查询）
- 大文件上传不影响界面响应
- 支持断点续传（可选）

### 5.2 安全性要求

- 用户密码使用加密存储（如 bcrypt）
- 防止 SQL 注入和 XSS 攻击
- 用户数据本地化存储，不上传云端
- 文件传输的安全性保护
- 文件存储的安全性加密
- 支持文件访问权限控制

### 5.3 兼容性要求

- **Windows**：Windows 10 及以上版本
- **macOS**：macOS 10.15 (Catalina) 及以上版本
- **Linux**：主流发行版（Ubuntu 20.04+、Fedora 35+、Debian 11+）
- 支持常见文件类型的预览（图片、文档等）

### 5.4 可用性要求

- 界面简洁直观，符合即时通讯软件的使用习惯
- 提供完善的错误提示和帮助文档
- 支持快捷键操作
- 支持主题切换（可选）
- 文件上传和下载操作简单易用

### 5.5 可维护性要求

- 模块化设计，降低模块间耦合度
- 完善的日志记录机制
- 代码注释和文档完善
- 支持插件化扩展

### 5.6 可扩展性要求

- 支持新增智能体类型
- 支持消息类型的扩展（如图片、文件等）
- 支持新增文件类型的预览
- 预留第三方集成接口
- 预留云存储集成接口

## 6. 数据模型

### 6.1 聊天消息表 (chat_messages)

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 消息ID，主键，自增 |
| agent_id | TEXT | 智能体ID（与JSON配置文件中的ID对应） |
| sender_type | TEXT | 发送者类型（user/agent） |
| content | TEXT | 消息内容（支持包含文件引用） |
| message_type | TEXT | 消息类型（text/file/mixed/skill_call/skill_result） |
| file_metadata | TEXT | 文件元数据（JSON格式，包含文件名、大小、路径等） |
| status | TEXT | 消息状态（sent/delivered/read/failed） |
| parent_message_id | INTEGER | 父消息ID（用于回复或关联） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 6.2 技能调用表 (skill_calls)

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 调用ID，主键，自增 |
| message_id | INTEGER | 关联的消息ID（外键，指向chat_messages.id） |
| agent_id | TEXT | 智能体ID |
| skill_name | TEXT | 调用的技能名称 |
| skill_version | TEXT | 调用的技能版本 |
| params | TEXT | 调用参数（JSON格式） |
| status | TEXT | 执行状态（pending/running/completed/failed） |
| result | TEXT | 执行结果（JSON格式） |
| log | TEXT | 执行日志 |
| error | TEXT | 错误信息（如果有） |
| start_time | DATETIME | 开始时间 |
| end_time | DATETIME | 结束时间 |
| duration | INTEGER | 执行耗时（毫秒） |
| created_at | DATETIME | 创建时间 |

## 7. 智能体与技能配置格式

### 7.1 JSON配置文件结构

```json
{
  "agents": [
    {
      "group_name": "通用助手",
      "agents": [
        {
          "id": "agent-001",
          "name": "智能助手",
          "description": "通用智能助手",
          "avatar": "avatar-1.png",
          "type": "general",
          "config": {
            "url": "model-url",
            "api_key": "your-api-key",
            "model": "gpt-3.5-turbo"
          },
          "skills": [
            {
              "name": "web_search",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "file_process",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "data_analysis",
              "version": "v1.0.0",
              "config_override": {}
            }
          ]
        }
      ]
    },
    {
      "group_name": "OA办公系统",
      "agents": [
        {
          "id": "agent-002",
          "name": "代码助手",
          "description": "代码生成和调试助手",
          "avatar": "avatar-2.png",
          "type": "code",
          "config": {
            "url": "model-url",
            "api_key": "your-api-key",
            "model": "gpt-4"
          },
          "skills": [
            {
              "name": "code_generate",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "code_debug",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "code_optimize",
              "version": "v1.0.0",
              "config_override": {}
            }
          ]
        },
        {
          "id": "agent-003",
          "name": "待办助手",
          "description": "待办事项管理助手",
          "avatar": "avatar-3.png",
          "type": "todo",
          "config": {
            "url": "model-url",
            "api_key": "your-api-key",
            "model": "gpt-3.5-turbo"
          },
          "skills": [
            {
              "name": "todo_create",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "todo_update",
              "version": "v1.0.0",
              "config_override": {}
            },
            {
              "name": "todo_query",
              "version": "v1.0.0",
              "config_override": {}
            }
          ]
        }
      ]
    }
  ],
  "skills": {
    "web_search": {
      "name": "web_search",
      "description": "网页搜索技能，用于获取互联网信息",
      "type": "information",
      "versions": {
        "v1.0.0": {
          "config": {
            "engine": "google",
            "max_results": 5
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "file_process": {
      "name": "file_process",
      "description": "文件处理技能，用于读取、写入和修改文件",
      "type": "file",
      "versions": {
        "v1.0.0": {
          "config": {
            "supported_formats": ["txt", "md", "json", "csv"]
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "data_analysis": {
      "name": "data_analysis",
      "description": "数据分析技能，用于处理和分析数据",
      "type": "analysis",
      "versions": {
        "v1.0.0": {
          "config": {
            "max_rows": 1000
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "code_generate": {
      "name": "code_generate",
      "description": "代码生成技能，用于生成各种编程语言的代码",
      "type": "code",
      "versions": {
        "v1.0.0": {
          "config": {
            "supported_languages": ["python", "javascript", "java", "c++"]
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "code_debug": {
      "name": "code_debug",
      "description": "代码调试技能，用于调试和修复代码",
      "type": "code",
      "versions": {
        "v1.0.0": {
          "config": {
            "supported_languages": ["python", "javascript"]
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "code_optimize": {
      "name": "code_optimize",
      "description": "代码优化技能，用于优化代码性能和可读性",
      "type": "code",
      "versions": {
        "v1.0.0": {
          "config": {
            "supported_languages": ["python", "javascript"]
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "todo_create": {
      "name": "todo_create",
      "description": "创建待办事项技能",
      "type": "productivity",
      "versions": {
        "v1.0.0": {
          "config": {
            "default_priority": "medium"
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "todo_update": {
      "name": "todo_update",
      "description": "更新待办事项技能",
      "type": "productivity",
      "versions": {
        "v1.0.0": {
          "config": {
            "supported_fields": ["title", "description", "priority", "status", "due_date"]
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    },
    "todo_query": {
      "name": "todo_query",
      "description": "查询待办事项技能",
      "type": "productivity",
      "versions": {
        "v1.0.0": {
          "config": {
            "max_results": 20
          },
          "created_at": "2023-01-01T00:00:00Z"
        }
      },
      "default_version": "v1.0.0"
    }
  }
}
```

## 8. 用户界面设计要点

### 8.1 主界面布局

- **左侧边栏**：智能体列表，类似 QQ 好友列表
  - 搜索框
  - 智能体分组列表（从JSON配置文件加载）
    - 分组名称展示
    - 分组下智能体列表
- **主内容区**：当前选中的智能体聊天窗口或欢迎页
- **状态栏**：应用状态信息（可选）

### 8.2 聊天窗口设计

- **顶部**：智能体信息（头像、名称、在线状态）、窗口操作按钮
- **消息区**：
  - 聊天消息展示，支持滚动和自动加载历史
  - 支持显示文件附件预览
  - 支持显示skill调用过程和状态更新
  - 支持显示skill执行结果
  - 支持执行状态指示器
- **输入区**：
  - 文本输入框
  - 文件选择按钮
  - 文件附件列表（显示已选择的文件，支持预览和删除）
  - 支持拖拽文件到输入区
  - 发送按钮（统一发送文本和文件）
- **消息气泡**：
  - 区分用户消息和智能体回复
  - 支持显示文件附件
  - 区分普通消息和skill执行消息
  - skill执行消息支持显示执行状态
  - 支持显示skill执行结果的结构化内容



## 9. 开发里程碑

### 9.1 第一阶段：基础框架搭建
- Tauri + React 项目初始化
- 基础 UI 框架搭建
- SQLite 数据库集成
- 第三方统一认证集成

### 9.2 第二阶段：核心功能实现
- 智能体配置加载（JSON格式）
- 智能体列表展示
- 聊天交互功能（消息发送、接收、展示）
- 聊天消息存储和查询
- 文件消息支持
- 文件上传和下载功能
- 智能体 skill 调用框架
- skill 执行流程实现
- 智能体消息处理模块

### 9.3 第三阶段：优化和完善
- 性能优化
- 界面美化
- 功能完善
- 测试和修复
- 文件传输优化
- skill 执行优化
- 智能体处理逻辑优化

## 10. 附录

### 10.1 术语说明

- **智能体（Agent）**：系统中的虚拟对话对象，配置信息以JSON格式存储，能够根据用户输入调用相应的skill执行任务
- **聊天窗口**：用户与智能体进行对话交互的界面窗口
- **Skill**：智能体可调用的功能模块，用于执行特定任务（如网页搜索、文件处理、数据分析等）
- **Skill调用**：智能体根据用户输入调用相应skill的过程
- **Skill执行**：skill执行特定任务的过程
- **Skill执行结果**：skill执行完成后返回的结果或执行过程

### 10.2 参考文档

- Tauri 官方文档：https://tauri.app/
- React 官方文档：https://react.dev/
- Tailwind CSS 官方文档：https://tailwindcss.com/
- Playwright 官方文档：https://playwright.dev/