# AutoMate 桌面智能体聊天系统需求规格说明书




## 1. 系统概述



### 1.1 项目背景



AutoMate 是一款基于现代 Web 技术栈构建的跨平台桌面智能体聊天系统。该系统旨在为用户提供一个界面精美、安装轻量、功能强大的智能体交互平台。用户可以通过类似 QQ 等即时通讯软件的聊天界面与各种智能体进行对话交互，智能体根据用户输入调用相应的 skill 执行操作，并将执行过程或结果返回给用户。智能体配置统一以 JSON 格式存储，无需复杂的数据库管理。



### 1.2 项目定位



AutoMate 定位为一款智能体交互平台，通过聊天界面实现用户与智能体的交互，智能体根据用户输入调用不同的 skill 执行特定任务，将执行过程或结果返回给用户，提供高效、智能的任务处理体验。



## 2. 系统建设目标



### 2.1 核心建设目标



- **功能目标**：

  - 智能体管理：实现智能体的加载、分组、搜索和状态管理，支持智能体的在线状态监控和响应时间统计

  - 聊天交互：实现流畅的消息发送和接收功能，支持技能调用和执行结果展示，确保消息状态的正确流转

  - 文件处理：支持文件上传和管理，实现文件元数据的存储和检索，确保文件处理的安全性和可靠性

  - 主题定制：提供浅色/深色主题切换功能，支持界面个性化设置，确保主题切换的流畅性和一致性

  - 启动体验：优化应用启动流程，实现智能体配置的快速加载，提供友好的欢迎页和快速开始引导



- **技术目标**：

  - 性能优化：确保应用启动时间<3秒，界面操作响应时间<300ms，消息发送延迟<500ms

  - 数据安全：实现聊天数据的本地加密存储，确保用户数据的安全性和隐私保护

  - 跨平台兼容：支持Windows 10+、macOS 10.15+、主流Linux发行版，确保在不同平台上的一致体验

  - 模块化设计：采用模块化架构，便于功能扩展和维护，支持插件化开发

  - 数据库优化：设计高效的数据库表结构和索引，确保数据查询性能和存储效率



- **用户体验目标**：

  - 直观易用：设计符合即时通讯软件使用习惯的界面，降低用户学习成本

  - 视觉美观：采用现代化的UI设计，支持主题切换，提供良好的视觉体验

  - 响应流畅：确保界面操作的流畅性，避免卡顿和延迟

  - 错误处理：提供友好的错误提示和帮助信息，增强用户信心

  - 个性化：支持界面布局和主题的个性化设置，满足不同用户的需求



- **系统目标**：

  - 稳定性：确保系统的稳定运行，减少崩溃和异常情况

  - 可扩展性：支持智能体类型和技能的扩展，适应未来功能需求的变化

  - 可维护性：完善的日志记录机制，便于问题定位和系统维护

  - 资源占用：优化系统资源占用，确保在低配置设备上的良好运行

  - 版本管理：实现版本检查和更新机制，确保系统能够及时获取最新功能和修复



### 2.2 功能目标



- **智能体管理**：实现智能体的加载、分组、搜索和状态管理，支持智能体的在线状态监控和响应时间统计

- **聊天交互**：实现流畅的消息发送和接收功能，支持技能调用和执行结果展示，确保消息状态的正确流转

- **文件处理**：支持文件上传和管理，实现文件元数据的存储和检索，确保文件处理的安全性和可靠性

- **主题定制**：提供浅色/深色主题切换功能，支持界面个性化设置，确保主题切换的流畅性和一致性

- **启动体验**：优化应用启动流程，实现智能体配置的快速加载，提供友好的欢迎页和快速开始引导

- **数据管理**：实现聊天记录的存储、检索和导出，支持数据清理和维护，确保数据的安全性和存储效率

- **技能集成**：支持智能体技能的配置和调用，实现技能执行状态的监控和结果展示，确保技能调用的可靠性



### 2.3 非功能性目标



- **性能**：应用启动时间 < 3 秒（包括智能体配置加载、数据库初始化等），界面操作响应时间 < 300ms（包括消息发送、主题切换等操作），智能体技能调用响应时间 < 1 秒（不包括技能执行时间），聊天记录加载（100条记录）时间 < 500ms

- **兼容性**：支持 Windows 10+（64位）、麒麟V10，支持 macOS 10.15+（64位），支持主流 Linux 发行版（Ubuntu 20.04+、Debian 10+、Fedora 34+），支持 Chrome 90+、Edge 90+、Firefox 88+ 浏览器（用于Web视图）

- **安全性**：聊天数据本地加密存储（使用AES-256加密算法），智能体配置文件权限控制（仅应用可访问），技能执行沙箱隔离（防止恶意代码执行），敏感信息（如API密钥）加密存储

- **可维护性**：模块化架构设计（按功能模块划分代码），代码注释覆盖率 > 80%，单元测试覆盖率 > 70%，版本控制使用Git，遵循语义化版本规范

- **易用性**：直观的用户界面（遵循Material Design设计规范），响应式布局，适配不同屏幕尺寸，快捷键支持（如Ctrl+Enter发送消息），操作引导和提示（首次使用时），错误提示友好，提供明确的解决建议

- **可靠性**：应用崩溃率 < 0.1%，技能执行成功率 > 95%，数据备份和恢复机制，异常处理和日志记录

- **可扩展性**：支持自定义智能体技能开发，支持插件系统，可扩展功能，支持多语言国际化，支持API接口扩展



## 3. 系统功能描述



### 3.1 智能体模块

*   **参考原型设计页面：**

    1. **《.\prototypes\MainLayout.html》**

*   **功能流程：**

    1.  **应用启动时自动加载：**

        *   **启动：** 系统启动时从本地读取智能体配置 JSON 文件（默认路径：`./config/agents.json`）

        *   **加载提示：** 显示启动加载动画和"正在初始化智能体..."等提示信息

        *   **加载进度条：** 显示启动加载进度，包括文件读取、解析和渲染等阶段

        *   **解析：** 解析 JSON 配置，按 `group_name` 字段对智能体进行分组

        *   **渲染：** 将分组信息和智能体列表渲染到左侧边栏

        *   **加载失败处理：**

            *   **配置文件不存在：** 显示友好错误提示并提供默认配置

            *   **配置文件格式错误：** 显示错误位置和修复建议

            *   **网络连接失败：** 显示离线模式提示（如果需要网络资源）

            *   **配置文件为空：** 显示"无智能体配置"提示并提供添加智能体的选项

            *   **配置文件权限不足：** 显示权限错误提示并引导用户解决

            *   **配置文件路径无效：** 显示路径错误提示并使用默认路径

        *   **启动完成反馈：** 加载完成后显示短暂的"加载完成"提示，增强用户信心

    2.  **智能体配置管理：**

        *   **配置存储：** 智能体信息以 JSON 格式存储，支持为智能体配置可用的 skill

        *   **配置加载：** 系统启动时加载配置文件，初始化智能体列表

        *   **配置保存反馈：**

            *   **保存中提示：** 配置更新时显示"保存中..."提示

            *   **保存成功反馈：** 保存成功后显示"保存成功"确认信息

            *   **保存失败处理：** 保存失败时显示错误原因和重试按钮

            *   **保存路径不存在：** 自动创建保存路径并提示用户

        *   **配置验证：** 实时验证配置格式，提供错误提示和自动修复建议

        *   **配置导入/导出：**

            *   **导入配置：** 显示进度条和验证结果

            *   **导出配置：** 显示保存位置提示

            *   **导入失败处理：** 显示详细错误信息

            *   **导入文件为空：** 显示"请选择有效文件"提示

            *   **导入文件格式错误：** 显示格式错误提示和支持的格式

            *   **导出路径无权限：** 显示权限错误提示并引导用户选择其他路径

    3.  **智能体分组展示：**

        *   **分组管理：** 按 `group_name` 字段对智能体进行分组展示

        *   **列表渲染：** 左侧边栏显示智能体分组和分组下的智能体列表

        *   **分组加载提示：** 分组数据加载时显示骨架屏或加载动画

        *   **分组操作反馈：**

            *   **新建分组：** 显示"创建中..."提示

            *   **删除分组：** 显示确认对话框

            *   **重命名分组：** 显示编辑状态和保存反馈

            *   **分组名称重复：** 自动处理重复分组名称（添加数字后缀）

        *   **分组数据更新：** 分组数据变化时显示平滑过渡动画

        *   **边界条件处理：**

            *   **分组为空：** 显示"该分组无智能体"提示

            *   **智能体列表为空：** 显示欢迎页和添加智能体的引导

            *   **分组删除：** 处理删除包含智能体的分组的情况（提示用户移动智能体）

    4.  **智能体搜索：**

        *   **搜索功能：** 提供智能体搜索框，支持按名称、描述等搜索智能体

        *   **搜索加载提示：** 搜索过程中（如果搜索耗时较长）显示加载指示器

        *   **搜索结果：** 实时显示搜索结果，高亮匹配内容

        *   **搜索结果反馈：**

            *   **显示匹配结果数量：** 明确告知用户找到的智能体数量

            *   **提供排序选项：** 按相关性、名称等排序

            *   **无结果推荐：** 搜索无结果时提供相关推荐

        *   **搜索清空：** 搜索框内容非空时显示清空按钮，支持一键清空搜索内容

        *   **无结果提示：** 搜索无匹配项时显示友好的提示信息和搜索图标

        *   **搜索高亮：** 对匹配的文本内容进行黄色背景高亮显示

        *   **搜索历史：** 记录最近搜索历史，支持快速重新搜索

        *   **搜索快捷键：** 支持Ctrl+F快速聚焦搜索框

        *   **边界条件处理：**

            *   **搜索输入为空：** 自动显示全部智能体列表

            *   **搜索词过长：** 限制搜索词长度，防止性能问题

            *   **搜索词包含特殊字符：** 自动转义特殊字符，确保搜索正常执行

    5.  **侧边栏交互功能：**

        *   **侧边栏收缩：** 支持侧边栏的收起和展开，收缩时只显示智能体图标

        *   **宽度调整：** 支持通过拖拽调整侧边栏宽度（范围：200px-500px）

        *   **宽度调整反馈：**

            *   **拖拽调整：** 拖拽调整宽度时显示当前宽度数值

            *   **调整完成：** 调整完成后显示"宽度已保存"提示

            *   **边界提示：** 达到最小/最大宽度时显示边界提示

        *   **状态持久化：** 侧边栏的收缩状态和宽度设置保存到本地存储

        *   **收缩状态提示：** 收缩状态下鼠标悬停显示工具提示（tooltip）

        *   **侧边栏状态切换：**

            *   **过渡动画：** 收缩/展开时显示平滑过渡动画

            *   **状态提示：** 状态切换完成后显示短暂的状态提示

            *   **快捷键：** 支持快捷键快速切换侧边栏状态

        *   **边界条件处理：**

            *   **拖拽调整宽度失败：** 显示错误提示并恢复默认宽度

            *   **状态保存失败：** 显示错误提示并使用默认状态

            *   **收缩状态下的操作：** 收缩状态下鼠标悬停显示工具提示

    6.  **分组交互功能：**

        *   **分组折叠：** 点击分组头部可折叠或展开该分组下的智能体列表

        *   **折叠动画：** 分组折叠/展开时带平滑过渡动画效果

        *   **分组折叠/展开反馈：**

            *   **加载动画：** 操作过程中（如果操作耗时较长）显示加载指示器

            *   **状态更新：** 折叠/展开后更新分组状态指示器

        *   **分组状态管理：** 保存分组的展开/折叠状态到本地存储

        *   **分组状态持久化：** 状态保存时显示"状态已保存"提示

        *   **分组高亮：** 鼠标悬停分组头部时显示高亮效果

        *   **分组排序：** 支持拖拽排序分组，显示排序反馈和保存提示

        *   **边界条件处理：**

            *   **分组折叠/展开：** 处理分组下无智能体的情况

            *   **分组排序：** 处理拖拽到无效位置的情况

            *   **分组状态保存失败：** 显示错误提示并使用默认状态

    7.  **智能体选择与状态：**

        *   **智能体选中：** 点击智能体时高亮显示当前选中的智能体（左侧渐变指示条+背景色）

        *   **智能体选择反馈：**

            *   **加载提示：** 选择智能体时显示"加载中..."提示（如果切换耗时较长）

            *   **切换完成反馈：** 切换完成后显示"已切换到[智能体名称]"确认信息

            *   **切换失败处理：** 切换失败时显示错误原因和重试按钮

        *   **主界面更新：** 选中智能体后更新主内容区的顶部标题和头像

        *   **欢迎页切换：** 首次选中智能体时隐藏欢迎页，显示对应的聊天窗口

        *   **选中状态持久化：** 记录最后选中的智能体，下次启动时自动恢复

        *   **智能体状态检查：** 定期检查智能体状态，显示状态检查进度

        *   **智能体技能加载：** 加载智能体技能时显示进度条和加载状态

    8.  **智能体状态展示：**

        *   **在线状态指示：** 显示智能体的在线/离线状态（绿色/红色状态点）

        *   **状态动画效果：** 在线状态点带有呼吸动画效果（2秒循环）

        *   **状态文字：** 在智能体名称旁显示"在线"或"离线"文字标识

        *   **状态样式：** 状态点带白色边框，与头像背景形成对比

        *   **状态切换过渡：** 智能体状态切换时显示平滑过渡动画

        *   **状态检查反馈：**

            *   **加载指示器：** 状态检查中显示加载指示器

            *   **状态更新：** 检查完成后更新状态显示

        *   **状态详细信息：** 鼠标悬停状态点时显示详细状态信息（如最后在线时间、响应时间等）

    9.  **主题切换功能：**

        *   **主题切换：** 支持浅色/深色主题切换

        *   **主题按钮：** 底部设置区域提供主题切换按钮（太阳/月亮图标）

        *   **主题持久化：** 保存用户的主题偏好设置到本地存储

        *   **主题同步：** 切换主题时同步更新所有界面元素（侧边栏、聊天窗口、输入框等）

        *   **主题图标更新：** 根据当前主题显示对应的图标（浅色显示太阳，深色显示月亮）

        *   **主题切换反馈：**

            *   **切换中提示：** 切换过程中显示"切换中..."提示

            *   **切换完成反馈：** 切换完成后显示"主题已更新"确认信息

            *   **切换失败处理：** 切换失败时显示错误原因和重试按钮

        *   **主题预览：** 提供主题预览功能，显示切换效果

        *   **主题加载优化：** 优化主题切换速度，减少用户等待时间

    10. **欢迎页功能：**

        *   **统计信息展示：** 显示可用智能体数量、可用技能数量、对话次数等统计信息

        *   **统计信息加载：**

            *   **加载状态：** 统计数据加载时显示骨架屏

            *   **加载完成：** 数据加载完成后显示数字动画效果

            *   **加载失败：** 数据加载失败时显示默认值和错误提示

        *   **快速开始引导：**

            *   **引导步骤：** 提供三步快速开始指南（选择智能体→输入问题→按Enter发送）

            *   **进度指示：** 引导步骤完成后显示进度指示

            *   **跳过选项：** 提供跳过选项和重新开始选项

        *   **统计数字动画：** 统计数字带有渐变色动画效果

        *   **统计卡片交互：** 统计卡片鼠标悬停时有上浮和阴影效果

        *   **欢迎页显示：** 应用启动或未选中智能体时显示欢迎页

        *   **欢迎页交互反馈：** 所有交互元素提供即时视觉反馈

    11. **设置与版本信息：**

        *   **设置入口：** 底部设置区域提供设置按钮

        *   **版本显示：** 底部显示应用版本号（如 v1.0.0）

        *   **在线状态标识：** 底部显示整体在线状态（绿色圆点+在线文字）

        *   **设置提示：** 鼠标悬停设置按钮时显示工具提示

        *   **设置操作反馈：**

            *   **修改提示：** 设置修改时显示"保存中..."提示

            *   **保存成功反馈：** 保存成功后显示"设置已保存"确认信息

            *   **保存失败处理：** 保存失败时显示错误原因和重试按钮

        *   **版本检查：**

            *   **检查更新：** 自动检查更新时显示"检查更新中..."提示

            *   **新版本提示：** 有新版本时显示更新提示和更新按钮

            *   **无新版本提示：** 无新版本时显示"当前为最新版本"提示

        *   **在线状态检查：**

            *   **状态检查：** 状态检查时显示加载指示器

            *   **状态更新：** 检查完成后更新状态显示

            *   **网络恢复提示：** 网络连接恢复时显示"网络已连接"提示

    12. **通用用户体验优化：**

        *   **全局加载状态：** 统一的加载指示器设计，确保用户了解系统正在处理请求

        *   **错误处理：**

            *   **分级错误提示：** 轻微、中等、严重错误的不同提示方式

            *   **错误信息友好化：** 避免技术术语，使用通俗易懂的语言

            *   **错误解决建议：** 提供具体的解决方法和帮助链接

        *   **操作撤销：** 支持最近操作的撤销功能

        *   **键盘导航：** 完善的键盘导航支持，提高可访问性

        *   **响应式设计优化：** 确保在不同设备上的良好体验

        *   **性能优化：**

            *   **延迟加载：** 非关键资源的延迟加载

            *   **数据缓存：** 频繁访问数据的缓存机制

            *   **渲染优化：** 减少卡顿，提高界面流畅度

    13. **异常处理与提示：**

        *   **网络异常：**

            *   **网络断开：** 显示离线模式提示

            *   **网络恢复：** 显示重新连接提示

            *   **请求超时：** 显示重试按钮

        *   **文件操作异常：**

            *   **读写失败：** 显示详细错误信息

            *   **权限不足：** 显示权限请求提示

            *   **存储空间不足：** 显示清理建议

        *   **系统异常：**

            *   **内存不足：** 显示优化建议

            *   **CPU使用率过高：** 显示性能警告

            *   **应用崩溃：** 提供错误报告选项

    14. **进度条与加载指示器：**

        *   **进度条设计：**

            *   **线性进度条：** 用于明确进度的任务

            *   **环形进度条：** 用于不确定进度的任务

            *   **骨架屏：** 用于内容加载

        *   **加载动画：**

            *   **脉冲动画：** 用于轻量级加载

            *   **旋转动画：** 用于中等量级加载

            *   **波纹动画：** 用于重量级加载

        *   **进度提示文本：**

            *   **进度百分比：** 显示当前进度数值

            *   **处理步骤：** 显示当前处理阶段

            *   **预计时间：** 显示预计剩余时间

    15. **反馈与确认：**

        *   **操作确认：**

            *   **危险操作：** 显示确认对话框

            *   **重要操作：** 显示二次确认

            *   **批量操作：** 显示操作数量和影响范围

        *   **成功反馈：**

            *   **操作完成：** 显示短暂的成功提示

            *   **结果信息：** 提供操作结果的详细信息

            *   **结果复制：** 支持复制操作结果

        *   **通知中心：**

            *   **集中管理：** 所有系统通知的统一管理

            *   **优先级分类：** 通知的优先级和分类

            *   **已读/未读状态：** 通知的状态管理

*   **视觉设计：**

    1.  **页面布局：**

        *   **左侧边栏：** 固定宽度280px（默认），支持拖拽调整宽度（范围：200px-500px）

        *   **搜索区域：** 顶部固定高度，带搜索图标和清空按钮

        *   **智能体列表：** 可滚动区域，分组显示

        *   **底部设置：** 固定高度，包含主题切换和设置按钮

    2.  **配色方案：**

        *   **浅色主题：**

            - 侧边栏背景：`#ffffff`

            - 分组头部背景：`#f3f4f6`

            - 智能体项背景：默认透明，hover 时 `#f9fafb`

            - 选中智能体背景：`linear-gradient(135deg, #e0e7ff 0%, #dbeafe 50%, #ede9fe 100%)`

            - 文本颜色：智能体名称 `#1e40af`，描述 `#6b7280`

            - 在线状态：`#10b981`

        *   **深色主题：**

            - 侧边栏背景：`#1f2937`

            - 分组头部背景：`#374151`

            - 智能体项背景：默认透明，hover 时 `#374151`

            - 选中智能体背景：`linear-gradient(135deg, rgba(37, 99, 235, 0.3) 0%, rgba(59, 130, 246, 0.4) 100%)`

            - 文本颜色：智能体名称 `#93c5fd`，描述 `#9ca3af`

            - 在线状态：`#34d399`

    3.  **按钮样式：**

        *   **主题切换按钮：** 图标按钮，圆角，悬停时背景色变化

        *   **设置按钮：** 图标按钮，圆角，悬停时背景色变化

        *   **搜索清空按钮：** 圆形按钮，位于搜索框右侧，内容非空时显示

    4.  **字体排版：**

        *   **智能体名称：** 14px，中等字重

        *   **智能体描述：** 12px，常规字重

        *   **分组名称：** 14px，半粗体

        *   **状态文字：** 12px，浅色

        *   **版本信息：** 12px，浅色

    5.  **动画效果：**

        *   **智能体项选中：** 左侧渐变指示条从0到100%的缩放动画

        *   **智能体项悬停：** 轻微右移（2px），背景色渐变

        *   **在线状态：** 呼吸动画（2秒循环），阴影扩散效果

        *   **分组折叠/展开：** 平滑高度过渡动画（0.3秒）

        *   **侧边栏收缩/展开：** 宽度变化动画（0.3秒）

    6.  **响应式设计：**

        *   **移动端（≤768px）：** 侧边栏可滑出，默认隐藏，点击菜单按钮显示

        *   **平板端（768px-1024px）：** 侧边栏宽度自适应，最小200px

        *   **桌面端（≥1024px）：** 完整显示，支持拖拽调整宽度

    7.  **交互反馈：**

        *   **悬停效果：** 所有可交互元素悬停时都有视觉反馈

        *   **点击效果：** 智能体项点击时有轻微缩放效果（0.98倍）

        *   **工具提示：** 收缩状态下鼠标悬停显示工具提示

        *   **搜索反馈：** 无结果时显示友好提示和搜索图标

*   **UI元素：**

    1.  **侧边栏容器：**

        *   **id：** `sidebar`

        *   **默认宽度：** 280px

        *   **调整范围：** 200px-500px

        *   **收缩状态宽度：** 60px

        *   **样式类：** `sidebar-collapsed`（收缩状态）

        *   **过渡动画：** 宽度变化动画（0.3秒）

    2.  **搜索区域：**

        *   **搜索输入框：**

            *   **id：** `searchInput`

            *   **placeholder：** "搜索智能体..."

            *   **图标：** 搜索图标（SVG），位于左侧

            *   **聚焦效果：** 蓝色边框和阴影

            *   **样式：** 圆角，浅灰色背景

        *   **搜索清空按钮：**

            *   **id：** `searchClearBtn`

            *   **显示条件：** 搜索框内容非空时显示

            *   **图标：** 叉号图标（SVG）

            *   **样式类：** `search-clear-btn`

            *   **悬停效果：** 背景色变深

        *   **搜索高亮：**

            *   **样式类：** `search-highlight`

            *   **浅色主题：** 黄色背景（#fef08a 到 #fde047 渐变），棕色文本（#854d0e）

            *   **深色主题：** 深棕色背景（#713f12 到 #a16207 渐变），黄色文本（#fef08a）

            *   **边框半径：** 2px

        *   **无结果提示：**

            *   **样式类：** `search-no-results`

            *   **图标：** 搜索图标（SVG），48px × 48px 圆形背景

            *   **提示文本：** "未找到匹配的智能体"

            *   **提示信息：** "请尝试其他搜索词"

            *   **居中显示：** 文本和图标居中对齐

    3.  **智能体分组：**

        *   **分组头部：**

            *   **样式类：** `group-header`

            *   **折叠状态：** 添加 `collapsed` 类

            *   **图标：** Chevron 图标（SVG），折叠时旋转-90度

            *   **悬停效果：** 背景色变化，左侧蓝色边框

            *   **文本样式：** 14px，半粗体，灰色文本

        *   **分组内容：**

            *   **样式类：** `group-content`

            *   **展开状态：** `expanded` 类

            *   **折叠状态：** `collapsed` 类

            *   **动画：** 平滑高度过渡动画（0.3秒）

            *   **默认状态：** 展开

    4.  **智能体项：**

        *   **基本属性：**

            *   **样式类：** `agent-item`

            *   **选中状态：** 添加 `selected` 类

            *   **数据属性：** `data-agent-id`, `data-agent-name`, `data-agent-avatar`

            *   **点击效果：** 轻微缩放效果（0.98倍）

        *   **头像：**

            *   **尺寸：** 48px × 48px

            *   **样式：** 圆形渐变背景

            *   **图标：** SVG 图标（白色，7px × 7px）

            *   **悬停效果：** 轻微放大（1.05倍）

            *   **选中效果：** 蓝色阴影

        *   **在线状态：**

            *   **尺寸：** 12px × 12px

            *   **在线：** 绿色（#10b981）圆点，2px 白色边框

            *   **离线：** 红色圆点，2px 白色边框

            *   **动画：** 呼吸动画（2秒循环），阴影扩散效果

            *   **位置：** 头像右下角

        *   **文本信息：**

            *   **名称：** 14px，中等字重，蓝色文本（#1e40af）

            *   **描述：** 12px，常规字重，浅色文本（#6b7280）

            *   **状态文字：** 12px，绿色文本（#10b981）

            *   **截断：** 文本过长时显示省略号

        *   **选中效果：**

            *   **背景：** 线性渐变（135deg，#e0e7ff 0%，#dbeafe 50%，#ede9fe 100%）

            *   **左侧指示条：** 3px 宽，线性渐变，从0到100%的缩放动画

            *   **阴影：** 轻微阴影效果（0 2px 12px rgba(59, 130, 246, 0.15)）

        *   **悬停效果：**

            *   **背景：** 线性渐变（浅色主题）或半透明背景（深色主题）

            *   **位移：** 轻微右移（2px）

            *   **左侧指示条：** 缩放至60%

    5.  **底部设置区域：**

        *   **主题切换按钮：**

            *   **图标：** 太阳/月亮 SVG 图标（4px × 4px）

            *   **提示：** "主题"（tooltip）

            *   **悬停效果：** 背景色变化（#f9fafb）

            *   **样式：** 圆角，白色背景

        *   **设置按钮：**

            *   **图标：** 设置 SVG 图标（4px × 4px）

            *   **提示：** "设置"（tooltip）

            *   **悬停效果：** 背景色变化（#f9fafb）

            *   **样式：** 圆角，白色背景

        *   **版本信息：**

            *   **格式：** "v1.0.0"

            *   **样式：** 12px，浅色文本（#6b7280）

        *   **在线状态：**

            *   **图标：** 绿色圆点（2px × 2px）

            *   **文本：** "在线"

            *   **样式：** 12px，浅色文本（#6b7280）

    6.  **侧边栏控制元素：**

        *   **收缩按钮：**

            *   **id：** `sidebarToggle`

            *   **样式类：** `sidebar-toggle`

            *   **收缩状态：** 添加 `collapsed` 类

            *   **提示：** "收起/展开侧边栏"

            *   **悬停效果：** 宽度和高度增加，背景色变浅

        *   **宽度调整手柄：**

            *   **id：** `sidebarResizeHandle`

            *   **样式类：** `sidebar-resize-handle`

            *   **拖拽状态：** 添加 `dragging` 类

            *   **提示：** "拖拽调整宽度"

            *   **悬停效果：** 显示蓝色背景

    7.  **工具提示：**

        *   **容器类：** `tooltip-container`

        *   **提示类：** `tooltip`

        *   **显示条件：** 鼠标悬停在目标元素上

        *   **位置：** 侧边栏展开时在右侧，收缩时在左侧

        *   **样式：** 背景色 #1f2937，白色文本，12px 字体，圆角边框，带箭头

        *   **过渡动画：** 淡入淡出效果

    8.  **响应式元素：**

        *   **移动端菜单按钮：**

            *   **id：** `mobileMenuBtn`

            *   **图标：** 汉堡菜单 SVG 图标（6px × 6px）

            *   **显示条件：** 屏幕宽度 ≤ 768px 时显示

            *   **样式：** 40px × 40px，圆角，透明背景

        *   **移动端遮罩层：**

            *   **id：** `mobileOverlay`

            *   **样式类：** `mobile-overlay`

            *   **显示条件：** 移动端侧边栏打开时显示

            *   **样式：** 半透明黑色背景（rgba(0, 0, 0, 0.5)）

            *   **过渡动画：** 淡入淡出效果

    9.  **深色主题适配：**

        *   **所有UI元素：** 自动适配深色主题颜色

        *   **智能体项：**

            *   **背景：** 半透明深色背景

            *   **选中背景：** 线性渐变（135deg，rgba(37, 99, 235, 0.3) 0%，rgba(59, 130, 246, 0.4) 100%）

            *   **文本：** 浅蓝色（#93c5fd）和灰色（#9ca3af）

        *   **分组头部：**

            *   **悬停背景：** rgba(55, 65, 81, 0.6)

            *   **边框颜色：** #60a5fa

        *   **搜索框：**

            *   **背景：** 深色背景

            *   **边框：** #4b5563

        *   **工具提示：**

            *   **背景：** #1f2937

            *   **文本：** #f9fafb

*   **数据库表：**

    1.  **表结构：**

        *   **智能体配置：** 智能体信息以 JSON 格式存储，无需数据库表

        *   **相关日志表：**

            - **聊天消息日志表** (`chat_messages`)：存储用户和智能体之间的聊天消息

            - **技能调用日志表** (`skill_calls`)：存储智能体调用技能的记录

*   **数据逻辑：**

    1.  **智能体配置加载逻辑：**

        *   **触发场景：** 应用启动时（对应功能流程1：应用启动时自动加载）

        *   **数据来源：** 本地 JSON 配置文件（默认路径：`./config/agents.json`）

        *   **处理流程：**

            - 读取配置文件内容

            - 解析 JSON 格式数据

            - 按 `group_name` 字段对智能体进行分组

            - 验证配置格式的合法性

            - 生成智能体列表数据结构

        *   **数据去向：** 内存中的智能体管理对象，用于渲染左侧边栏

        *   **错误处理：**

            - 配置文件不存在：使用默认配置

            - 配置文件格式错误：显示错误位置并使用默认配置

            - 配置文件为空：显示"无智能体配置"提示

            - 权限不足：显示权限错误提示并使用默认配置



    2.  **智能体分组逻辑：**

        *   **触发场景：** 配置加载完成后、用户创建/删除/重命名分组时（对应功能流程3：智能体分组展示）

        *   **数据来源：** 解析后的智能体配置数据、用户操作输入

        *   **处理流程：**

            - 按 `group_name` 字段聚合智能体

            - 处理分组名称重复的情况（添加数字后缀）

            - 维护分组的展开/折叠状态

            - 保存分组状态到本地存储

        *   **数据去向：** 左侧边栏的分组展示、本地存储的分组状态

        *   **错误处理：**

            - 分组为空：显示"该分组无智能体"提示

            - 分组删除时包含智能体：提示用户移动智能体

            - 分组状态保存失败：显示错误提示并使用默认状态



    3.  **智能体搜索逻辑：**

        *   **触发场景：** 用户在搜索框输入内容时（对应功能流程4：智能体搜索）

        *   **数据来源：** 用户输入的搜索关键词、内存中的智能体列表

        *   **处理流程：**

            - 实时获取搜索框输入

            - 对输入进行清理和验证

            - 按名称、描述等字段进行匹配

            - 高亮匹配的文本内容

            - 限制搜索结果数量

        *   **数据去向：** 搜索结果列表的展示

        *   **错误处理：**

            - 搜索输入为空：显示全部智能体列表

            - 搜索词过长：限制搜索词长度

            - 搜索词包含特殊字符：自动转义

            - 无匹配结果：显示"未找到匹配的智能体"提示



    4.  **智能体选择逻辑：**

        *   **触发场景：** 用户点击智能体列表项时（对应功能流程7：智能体选择与状态）

        *   **数据来源：** 用户点击操作、内存中的智能体列表

        *   **处理流程：**

            - 识别点击的智能体 ID

            - 更新智能体选中状态

            - 切换主内容区显示的聊天窗口

            - 保存最后选中的智能体到本地存储

            - 加载智能体相关的技能列表

        *   **数据去向：** 主内容区的聊天窗口、本地存储的选中状态

        *   **错误处理：**

            - 智能体数据加载失败：显示错误提示和重试按钮

            - 状态保存失败：显示错误提示并使用默认状态



    5.  **智能体状态检查逻辑：**

        *   **触发场景：** 应用启动时、定期检查时（对应功能流程8：智能体状态展示）

        *   **数据来源：** 智能体配置、网络连接状态、`agent_status`表中的状态记录

        *   **处理流程：**

            - 检查智能体的在线状态

            - 计算响应时间

            - 更新`agent_status`表中的状态记录

            - 更新状态指示（绿色/红色状态点）

            - 记录最后在线时间

        *   **数据去向：** `agent_status`表、智能体列表项的状态显示

        *   **错误处理：**

            - 状态检查失败：保持上次状态并显示错误提示

            - 网络连接中断：显示离线提示并更新状态记录

            - 状态更新失败：记录错误并继续使用内存中的状态



### 3.2 聊天交互模块

*   **参考原型设计页面：**

    1. **《.\prototypes\MainLayout.html》**

*   **功能流程：**

    1.  **消息发送与接收：**

        *   **消息发送：** 用户可向智能体发送文本消息，支持回车发送

        *   **消息接收：** 智能体响应消息实时显示在聊天窗口

        *   **消息展示：** 支持消息气泡展示，区分用户和智能体消息

        *   **消息状态指示：** 显示消息发送状态（已发送、已送达、已读、失败）

        *   **打字指示器：** 智能体输入时显示打字动画效果

        *   **消息气泡效果：** 消息气泡悬停时的上浮和阴影效果

        *   **消息时间戳：** 统一的时间戳样式和悬停效果

        *   **滚动到底部按钮：** 聊天记录滚动时显示快速回到底部的按钮

        *   **消息复制功能：** 每条消息可复制，复制后有成功提示

        *   **边界条件处理：**

            *   **输入框为空：** 自动禁用发送按钮

            *   **发送失败：** 显示错误提示和重试按钮

            *   **网络连接中断：** 显示离线提示并缓存消息

            *   **消息过长：** 自动截断或显示"消息过长"提示

            *   **消息发送超时：** 显示超时提示和重试选项

            *   **消息加载失败：** 显示错误提示和重试按钮

    2.  **Skill调用与执行：**

        *   **Skill调用：** 智能体根据用户输入调用相应的skill执行任务

        *   **执行状态：** 显示skill执行过程和状态

        *   **结果展示：** 将skill执行结果返回给用户

        *   **边界条件处理：**

            *   **Skill执行失败：** 显示错误信息和重试选项

            *   **Skill执行超时：** 显示超时提示和取消按钮

            *   **Skill参数错误：** 显示参数错误提示

            *   **Skill不存在：** 显示"Skill不存在"提示

            *   **Skill权限不足：** 显示权限错误提示

    3.  **文件上传与处理：**

        *   **文件上传：** 支持用户上传文件给智能体

        *   **文件处理：** 智能体可调用相应skill处理上传的文件

        *   **文件预览：** 支持常见文件类型的预览

        *   **附件显示区：** 文件上传后的附件预览和管理

        *   **边界条件处理：**

            *   **上传文件为空：** 显示"请选择文件"提示

            *   **上传文件失败：** 显示错误原因和重试按钮

            *   **上传文件类型不支持：** 显示"文件类型不支持"提示

            *   **上传文件过大：** 显示"文件过大"提示和大小限制

            *   **上传进度：** 显示上传进度条和取消按钮

            *   **文件预览失败：** 显示"预览失败"提示和下载选项

            *   **文件删除：** 处理删除正在上传的文件的情况

    4.  **聊天记录管理：**

        *   **记录存储：** 聊天记录本地加密存储

        *   **记录查询：** 支持聊天记录的查询和检索

        *   **记录导出：** 支持聊天记录的导出功能

        *   **日期分割线：** 聊天记录中的日期分割线，带有日期标签

        *   **边界条件处理：**

            *   **聊天记录为空：** 显示欢迎页或"无消息"提示

            *   **记录加载失败：** 显示错误提示和重试按钮

            *   **记录导出失败：** 显示错误原因和重试按钮

            *   **记录查询无结果：** 显示"无匹配记录"提示

            *   **存储容量不足：** 显示"存储容量不足"提示和清理建议

    5.  **聊天界面交互：**

        *   **输入框自动调整：** 输入内容时自动调整输入框高度

        *   **发送按钮状态：** 根据输入内容自动启用/禁用发送按钮

        *   **输入框样式：** 输入框支持多行输入，带有滚动条

        *   **边界条件处理：**

            *   **输入框高度调整失败：** 显示错误提示并使用默认高度

            *   **滚动到底部失败：** 显示错误提示并自动调整

            *   **界面尺寸过小：** 自适应小屏幕尺寸，确保基本功能可用

*   **视觉设计：**

    1.  **页面布局：**

        *   **主内容区：** 全屏显示，占据右侧所有空间

        *   **顶部栏：** 固定高度64px，包含智能体头像、名称和操作按钮

        *   **聊天区域：** 可滚动区域，消息气泡对齐显示

        *   **输入区域：** 固定底部，包含附件按钮、输入框和发送按钮

    2.  **配色方案：**

        *   **浅色主题：**

            - 聊天背景：`#f9fafb`

            - 用户消息气泡：`#3b82f6`，文本 `#ffffff`

            - 智能体消息气泡：`#f3f4f6`，文本 `#1f2937`

            - 时间戳：`#6b7280`

            - 输入框背景：`#ffffff`，边框 `#e5e7eb`

        *   **深色主题：**

            - 聊天背景：`#111827`

            - 用户消息气泡：`#60a5fa`，文本 `#ffffff`

            - 智能体消息气泡：`#374151`，文本 `#f9fafb`

            - 时间戳：`#9ca3af`

            - 输入框背景：`#1f2937`，边框 `#4b5563`

    3.  **按钮样式：**

        *   **发送按钮：** 图标按钮，圆形，悬停时放大1.1倍，禁用时灰色

        *   **附件按钮：** 图标按钮，圆形，悬停时颜色变化

        *   **滚动到底部按钮：** 圆形渐变背景按钮，位于右下角，滚动时显示

        *   **消息复制按钮：** 小圆形按钮，位于消息气泡右上角，悬停时显示

    4.  **字体排版：**

        *   **消息内容：** 14px，常规字重

        *   **时间戳：** 11px，浅色，字间距0.02em

        *   **消息状态：** 10px，浅色

        *   **输入框占位符：** 14px，浅色

    5.  **动画效果：**

        *   **消息气泡悬停：** 上浮1px，阴影增强

        *   **打字指示器：** 三个点的弹跳动画（1.4秒循环）

        *   **滚动到底部按钮：** 平滑显示/隐藏动画

        *   **消息发送：** 气泡出现动画

        *   **附件上传：** 进度动画

    6.  **响应式设计：**

        *   **移动端（≤768px）：**

            - 聊天区域 padding 调整为1rem

            - 消息气泡最大宽度调整为85%

            - 输入区域 padding 调整为0.75rem

            - 输入框最小高度调整为80px

        *   **平板端（768px-1024px）：** 消息气泡最大宽度调整为75%

        *   **桌面端（≥1024px）：** 消息气泡最大宽度为500px

    7.  **交互反馈：**

        *   **消息复制：** 复制成功后按钮变为绿色，显示对勾图标

        *   **消息状态：** 不同状态显示不同图标（已发送✓、已送达✓✓、已读✓✓蓝色）

        *   **输入框：** 自动调整高度，支持多行输入

        *   **滚动条：** 自定义样式，浅色/深色主题适配

    8.  **特殊元素：**

        *   **日期分割线：** 居中显示，带有日期标签，两侧有横线

        *   **打字指示器：** 灰色背景，三个动画点

        *   **附件预览：** 小卡片样式，带有文件名和大小

        *   **滚动条：** 细滚动条（6px），圆角，悬停时颜色变深

*   **UI元素：**

    1.  **聊天窗口容器：**

        *   **样式类：** `chat-content-panel`

        *   **布局：** 垂直flex布局，占据主内容区全部空间

        *   **滚动条：** 自定义样式，6px宽度，圆角

        *   **浅色主题：** 轨道 #e5e7eb，滑块 #9ca3af

        *   **深色主题：** 轨道 #1f2937，滑块 #4b5563

    2.  **消息气泡：**

        *   **用户消息气泡：**

            *   **样式：** 蓝色背景（#3b82f6），白色文本，圆角（右上角小圆角）

            *   **最大宽度：** 500px（桌面端），85%（移动端）

            *   **悬停效果：** 上浮1px，阴影增强

            *   **定位：** 右对齐

        *   **智能体消息气泡：**

            *   **样式：** 浅灰色背景（#f3f4f6），深色文本，圆角（左下角小圆角）

            *   **最大宽度：** 500px（桌面端），85%（移动端）

            *   **悬停效果：** 上浮1px，阴影增强

            *   **定位：** 左对齐

    3.  **输入区域：**

        *   **输入框：**

            *   **id：** `message-input-{agent-id}`

            *   **placeholder：** "输入消息..."

            *   **样式：** 多行文本框，自动调整高度，无边框

            *   **最小高度：** 100px

            *   **最大高度：** 300px

            *   **滚动条：** 自定义样式

        *   **发送按钮：**

            *   **id：** `send-btn-{agent-id}`

            *   **图标：** 发送箭头SVG图标

            *   **尺寸：** 28px × 28px

            *   **禁用状态：** 灰色图标，不可点击

            *   **悬停效果：** 蓝色变深，放大1.1倍

        *   **附件按钮：**

            *   **id：** `attach-btn-{agent-id}`

            *   **图标：** 回形针SVG图标

            *   **尺寸：** 24px × 24px

            *   **悬停效果：** 颜色变深

    4.  **消息状态指示器：**

        *   **样式类：** `message-status`

        *   **已发送：** 绿色对勾（✓）

        *   **已送达：** 双绿色对勾（✓✓）

        *   **已读：** 双蓝色对勾（✓✓）

        *   **失败：** 红色感叹号

        *   **尺寸：** 10px字体

    5.  **打字指示器：**

        *   **样式类：** `typing-indicator`

        *   **样式：** 灰色背景，圆角，内边距

        *   **动画点：** 三个8px × 8px圆形，弹跳动画（1.4秒循环）

        *   **浅色主题：** 浅灰色背景（#f3f4f6 到 #e5e7eb 渐变）

        *   **深色主题：** 深灰色背景（#374151 到 #4b5563 渐变）

    6.  **滚动到底部按钮：**

        *   **样式类：** `scroll-to-bottom`

        *   **显示条件：** 聊天记录滚动时显示

        *   **样式：** 圆形渐变背景（#3b82f6 到 #8b5cf6），白色箭头图标

        *   **尺寸：** 40px × 40px

        *   **位置：** 右下角，距底部100px，距右侧24px

        *   **悬停效果：** 放大1.1倍，阴影增强

    7.  **消息复制按钮：**

        *   **样式类：** `message-copy-btn`

        *   **位置：** 消息气泡右上角

        *   **尺寸：** 24px × 24px

        *   **样式：** 圆形，白色背景，1px边框

        *   **图标：** 复制SVG图标

        *   **复制成功：** 背景变为绿色（#10b981），图标变为对勾

        *   **悬停效果：** 背景色变浅，放大1.1倍

    8.  **日期分割线：**

        *   **样式：** 居中显示，日期标签，两侧横线

        *   **文本：** 11px，浅色（#6b7280）

        *   **横线：** 1px高度，浅灰色

    9.  **附件预览：**

        *   **容器：**

            *   **id：** `attachments-{agent-id}`

            *   **样式：** 水平flex布局，自动换行

        *   **附件卡片：**

            *   **样式：** 小卡片，带有文件名、大小、类型图标

            *   **悬停效果：** 阴影增强

            *   **移除按钮：** 右上角叉号图标

    10. **响应式适配：**

        *   **移动端（≤768px）：**

            *   **聊天区域padding：** 1rem

            *   **消息气泡最大宽度：** 85%

            *   **输入区域padding：** 0.75rem

            *   **输入框最小高度：** 80px

        *   **平板端（768px-1024px）：**

            *   **消息气泡最大宽度：** 75%

        *   **桌面端（≥1024px）：**

            *   **消息气泡最大宽度：** 500px

*   **数据库表：**

    1.  **表结构：**

        *   **聊天消息日志表** (`chat_messages`)：

            | 字段名 | 数据类型 | 约束 | 描述 |

            | :--- | :--- | :--- | :--- |

            | `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 消息ID，主键，自增 |

            | `agent_id` | `VARCHAR(255)` | `NOT NULL` | 智能体ID |

            | `agent_name` | `VARCHAR(255)` | `NOT NULL` | 智能体名称 |

            | `user_id` | `VARCHAR(255)` | `NOT NULL` | 用户ID |

            | `user_name` | `VARCHAR(255)` | `NOT NULL` | 用户名称 |

            | `content` | `TEXT` | `NOT NULL` | 消息内容 |

            | `message_type` | `VARCHAR(50)` | `NOT NULL` | 消息类型（user/agent） |

            | `send_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 发送时间 |

            | `status` | `VARCHAR(50)` | `DEFAULT 'sent'` | 消息状态（sent/delivered/read/failed） |

            | `message_length` | `INTEGER` | `DEFAULT 0` | 消息长度 |

            | `has_attachment` | `BOOLEAN` | `DEFAULT FALSE` | 是否包含附件 |

            | `attachment_path` | `TEXT` | | 附件路径 |

            | `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

            | `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



        *   **技能调用日志表** (`skill_calls`)：

            | 字段名 | 数据类型 | 约束 | 描述 |

            | :--- | :--- | :--- | :--- |

            | `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 调用ID，主键，自增 |

            | `message_id` | `INTEGER` | `REFERENCES chat_messages(id)` | 消息ID，外键 |

            | `agent_id` | `VARCHAR(255)` | `NOT NULL` | 智能体ID |

            | `skill_name` | `VARCHAR(255)` | `NOT NULL` | 技能名称 |

            | `parameters` | `TEXT` | | 技能参数，JSON格式 |

            | `call_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 调用时间 |

            | `status` | `VARCHAR(50)` | `DEFAULT 'pending'` | 执行状态（pending/success/failed/timeout） |

            | `result` | `TEXT` | | 执行结果 |

            | `execution_time` | `INTEGER` | `DEFAULT 0` | 执行时间（毫秒） |

            | `error_message` | `TEXT` | | 错误信息 |

            | `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

            | `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



        *   **智能体状态表** (`agent_status`)：

            | 字段名 | 数据类型 | 约束 | 描述 |

            | :--- | :--- | :--- | :--- |

            | `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 状态ID，主键，自增 |

            | `agent_id` | `VARCHAR(255)` | `UNIQUE NOT NULL` | 智能体ID，唯一 |

            | `agent_name` | `VARCHAR(255)` | `NOT NULL` | 智能体名称 |

            | `online_status` | `BOOLEAN` | `DEFAULT FALSE` | 在线状态 |

            | `last_online_time` | `DATETIME` | | 最后在线时间 |

            | `response_time` | `INTEGER` | `DEFAULT 0` | 响应时间（毫秒） |

            | `status_message` | `TEXT` | | 状态消息 |

            | `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

            | `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



        *   **文件元数据表** (`file_metadata`)：

            | 字段名 | 数据类型 | 约束 | 描述 |

            | :--- | :--- | :--- | :--- |

            | `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 文件ID，主键，自增 |

            | `message_id` | `INTEGER` | `REFERENCES chat_messages(id) ON DELETE CASCADE` | 关联的消息ID，外键 |

            | `file_name` | `VARCHAR(255)` | `NOT NULL` | 文件名 |

            | `file_type` | `VARCHAR(100)` | `NOT NULL` | 文件类型 |

            | `file_size` | `INTEGER` | `NOT NULL` | 文件大小（字节） |

            | `storage_path` | `TEXT` | `NOT NULL` | 存储路径 |

            | `file_hash` | `VARCHAR(255)` | | 文件哈希值 |

            | `upload_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 上传时间 |

            | `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

            | `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



    2.  **索引设计：**

        *   **聊天消息日志表索引：**

            - `CREATE INDEX idx_chat_messages_agent_id ON chat_messages(agent_id);`

            - `CREATE INDEX idx_chat_messages_send_time ON chat_messages(send_time);`

            - `CREATE INDEX idx_chat_messages_agent_send_time ON chat_messages(agent_id, send_time);`

            - `CREATE INDEX idx_chat_messages_user_id ON chat_messages(user_id);`

            - `CREATE INDEX idx_chat_messages_message_type ON chat_messages(message_type);`

            - `CREATE INDEX idx_chat_messages_status ON chat_messages(status);`



        *   **技能调用日志表索引：**

            - `CREATE INDEX idx_skill_calls_message_id ON skill_calls(message_id);`

            - `CREATE INDEX idx_skill_calls_call_time ON skill_calls(call_time);`

            - `CREATE INDEX idx_skill_calls_message_call_time ON skill_calls(message_id, call_time);`

            - `CREATE INDEX idx_skill_calls_agent_id ON skill_calls(agent_id);`

            - `CREATE INDEX idx_skill_calls_skill_name ON skill_calls(skill_name);`

            - `CREATE INDEX idx_skill_calls_status ON skill_calls(status);`



        *   **智能体状态表索引：**

            - `CREATE INDEX idx_agent_status_agent_id ON agent_status(agent_id);`

            - `CREATE INDEX idx_agent_status_online_status ON agent_status(online_status);`

            - `CREATE INDEX idx_agent_status_last_online ON agent_status(last_online_time);`



        *   **文件元数据表索引：**

            - `CREATE INDEX idx_file_metadata_message_id ON file_metadata(message_id);`

            - `CREATE INDEX idx_file_metadata_file_type ON file_metadata(file_type);`

            - `CREATE INDEX idx_file_metadata_upload_time ON file_metadata(upload_time);`



    3.  **数据库初始化脚本：**

        ```sql

        -- 创建聊天消息日志表

        CREATE TABLE IF NOT EXISTS chat_messages (

            id INTEGER PRIMARY KEY AUTOINCREMENT,

            agent_id VARCHAR(255) NOT NULL,

            agent_name VARCHAR(255) NOT NULL,

            user_id VARCHAR(255) NOT NULL,

            user_name VARCHAR(255) NOT NULL,

            content TEXT NOT NULL,

            message_type VARCHAR(50) NOT NULL,

            send_time DATETIME DEFAULT CURRENT_TIMESTAMP,

            status VARCHAR(50) DEFAULT 'sent',

            message_length INTEGER DEFAULT 0,

            has_attachment BOOLEAN DEFAULT FALSE,

            attachment_path TEXT,

            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP

        );



        -- 创建技能调用日志表

        CREATE TABLE IF NOT EXISTS skill_calls (

            id INTEGER PRIMARY KEY AUTOINCREMENT,

            message_id INTEGER REFERENCES chat_messages(id) ON DELETE CASCADE ON UPDATE CASCADE,

            agent_id VARCHAR(255) NOT NULL,

            skill_name VARCHAR(255) NOT NULL,

            parameters TEXT,

            call_time DATETIME DEFAULT CURRENT_TIMESTAMP,

            status VARCHAR(50) DEFAULT 'pending',

            result TEXT,

            execution_time INTEGER DEFAULT 0,

            error_message TEXT,

            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP

        );



        -- 创建智能体状态表

        CREATE TABLE IF NOT EXISTS agent_status (

            id INTEGER PRIMARY KEY AUTOINCREMENT,

            agent_id VARCHAR(255) UNIQUE NOT NULL,

            agent_name VARCHAR(255) NOT NULL,

            online_status BOOLEAN DEFAULT FALSE,

            last_online_time DATETIME,

            response_time INTEGER DEFAULT 0,

            status_message TEXT,

            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP

        );



        -- 创建文件元数据表

        CREATE TABLE IF NOT EXISTS file_metadata (

            id INTEGER PRIMARY KEY AUTOINCREMENT,

            message_id INTEGER REFERENCES chat_messages(id) ON DELETE CASCADE,

            file_name VARCHAR(255) NOT NULL,

            file_type VARCHAR(100) NOT NULL,

            file_size INTEGER NOT NULL,

            storage_path TEXT NOT NULL,

            file_hash VARCHAR(255),

            upload_time DATETIME DEFAULT CURRENT_TIMESTAMP,

            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP

        );



        -- 创建索引

        CREATE INDEX IF NOT EXISTS idx_chat_messages_agent_id ON chat_messages(agent_id);

        CREATE INDEX IF NOT EXISTS idx_chat_messages_send_time ON chat_messages(send_time);

        CREATE INDEX IF NOT EXISTS idx_chat_messages_agent_send_time ON chat_messages(agent_id, send_time);

        CREATE INDEX IF NOT EXISTS idx_chat_messages_user_id ON chat_messages(user_id);

        CREATE INDEX IF NOT EXISTS idx_chat_messages_message_type ON chat_messages(message_type);

        CREATE INDEX IF NOT EXISTS idx_chat_messages_status ON chat_messages(status);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_message_id ON skill_calls(message_id);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_call_time ON skill_calls(call_time);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_message_call_time ON skill_calls(message_id, call_time);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_agent_id ON skill_calls(agent_id);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_skill_name ON skill_calls(skill_name);

        CREATE INDEX IF NOT EXISTS idx_skill_calls_status ON skill_calls(status);

        CREATE INDEX IF NOT EXISTS idx_agent_status_agent_id ON agent_status(agent_id);

        CREATE INDEX IF NOT EXISTS idx_agent_status_online_status ON agent_status(online_status);

        CREATE INDEX IF NOT EXISTS idx_agent_status_last_online ON agent_status(last_online_time);

        CREATE INDEX IF NOT EXISTS idx_file_metadata_message_id ON file_metadata(message_id);

        CREATE INDEX IF NOT EXISTS idx_file_metadata_file_type ON file_metadata(file_type);

        CREATE INDEX IF NOT EXISTS idx_file_metadata_upload_time ON file_metadata(upload_time);

        ```



    4.  **备注：**

        - 所有时间字段使用`DATETIME`类型，默认值为`CURRENT_TIMESTAMP`

        - 所有字符串字段使用`VARCHAR`或`TEXT`类型，根据实际需要设置长度

        - 所有数值字段使用`INTEGER`类型

        - 所有布尔字段使用`BOOLEAN`类型

        - 所有JSON字段使用`TEXT`类型存储

        - 外键约束确保数据一致性

        - 索引优化查询性能

*   **数据逻辑：**

    1.  **消息发送逻辑：**

        *   **触发场景：** 用户在输入框输入内容并点击发送按钮或按回车键时（对应功能流程1：消息发送与接收）

        *   **数据来源：** 用户输入的文本内容、当前选中的智能体信息

        *   **处理流程：**

            - 验证输入内容是否为空

            - 计算消息长度

            - 生成消息ID和时间戳

            - 将消息插入到`chat_messages`表，状态为"pending"

            - 显示消息到聊天窗口，显示发送中状态

            - 尝试发送消息到智能体

            - 发送成功：更新消息状态为"sent"

            - 等待智能体确认：收到确认后更新状态为"delivered"

            - 智能体阅读：智能体处理消息后更新状态为"read"

        *   **数据去向：** `chat_messages`表、聊天窗口的消息展示

        *   **错误处理：**

            - 输入框为空：自动禁用发送按钮

            - 发送失败：更新消息状态为"failed"，显示错误提示和重试按钮

            - 网络连接中断：缓存消息并显示离线提示，保持"pending"状态

            - 消息过长：显示"消息过长"提示

            - 消息发送超时：显示超时提示和重试选项，更新状态为"failed"



    2.  **消息状态更新逻辑：**

        *   **触发场景：** 消息发送过程中、智能体处理消息时（对应功能流程1：消息发送与接收）

        *   **数据来源：** 消息发送结果、智能体响应状态

        *   **处理流程：**

            - 监听消息发送状态变化

            - 原子更新消息状态

            - 记录状态变更时间

            - 实时更新界面显示

            - 处理状态流转的边界情况

        *   **数据去向：** `chat_messages`表、聊天窗口的状态显示

        *   **错误处理：**

            - 状态更新失败：重试更新，确保状态一致性

            - 状态不一致：检测并修复状态冲突

            - 状态流转错误：记录错误并恢复到正确状态



    3.  **消息状态流转定义：**

        *   **触发场景：** 消息生命周期中（对应功能流程1：消息发送与接收）

        *   **状态流转：**

            - pending → sent：消息成功发送到系统

            - sent → delivered：智能体确认收到消息

            - delivered → read：智能体已处理消息

            - 任何状态 → failed：消息处理失败

            - failed → pending：用户重试发送

        *   **数据去向：** `chat_messages`表、聊天窗口的状态显示

        *   **错误处理：**

            - 流转非法：阻止非法状态转换，保持数据一致性



    4.  **消息接收逻辑：**

        *   **触发场景：** 智能体生成响应消息时（对应功能流程1：消息发送与接收）

        *   **数据来源：** 智能体的响应数据、`chat_messages`表中的相关记录

        *   **处理流程：**

            - 接收智能体响应数据

            - 更新对应消息的状态

            - 将智能体消息插入到`chat_messages`表

            - 实时显示消息到聊天窗口

            - 滚动聊天窗口到底部

        *   **数据去向：** `chat_messages`表、聊天窗口的消息展示

        *   **错误处理：**

            - 消息接收失败：显示错误提示

            - 消息格式错误：显示格式错误提示

            - 消息加载超时：显示超时提示



    5.  **技能调用逻辑：**

        *   **触发场景：** 智能体需要调用技能执行任务时（对应功能流程2：Skill调用与执行）

        *   **数据来源：** 智能体的技能调用请求、`chat_messages`表中的消息记录

        *   **处理流程：**

            - 解析技能调用请求

            - 验证技能参数的合法性

            - 将技能调用记录插入到`skill_calls`表

            - 执行技能并监控执行状态

            - 更新技能调用记录的状态和执行结果

            - 将执行结果显示到聊天窗口

        *   **数据去向：** `skill_calls`表、聊天窗口的结果展示

        *   **错误处理：**

            - 技能执行失败：显示错误信息和重试选项

            - 技能执行超时：显示超时提示和取消按钮

            - 技能参数错误：显示参数错误提示

            - 技能不存在：显示"Skill不存在"提示

            - 技能权限不足：显示权限错误提示



    6.  **文件上传逻辑：**

        *   **触发场景：** 用户点击附件按钮并选择文件上传时（对应功能流程3：文件上传与处理）

        *   **数据来源：** 用户选择的本地文件、当前选中的智能体信息

        *   **处理流程：**

            - 验证文件类型和大小

            - 生成文件存储路径

            - 上传文件到本地存储

            - 计算文件哈希值

            - 将文件信息保存到`file_metadata`表

            - 更新`chat_messages`表的附件状态

            - 显示附件预览到聊天窗口

        *   **数据去向：** 本地文件系统、`file_metadata`表、`chat_messages`表、聊天窗口的附件预览

        *   **错误处理：**

            - 上传文件为空：显示"请选择文件"提示

            - 上传文件失败：显示错误原因和重试按钮

            - 上传文件类型不支持：显示"文件类型不支持"提示

            - 上传文件过大：显示"文件过大"提示和大小限制

            - 文件预览失败：显示"预览失败"提示和下载选项

            - 文件元数据保存失败：显示错误提示并重试



    7.  **聊天记录管理逻辑：**

        *   **触发场景：** 用户查看历史聊天记录、导出聊天记录时（对应功能流程4：聊天记录管理）

        *   **数据来源：** `chat_messages`表中的记录、用户的查询条件

        *   **处理流程：**

            - 根据智能体ID和时间范围查询聊天记录

            - 按时间顺序排序显示

            - 支持按关键词搜索聊天记录

            - 支持导出聊天记录为文件

        *   **数据去向：** 聊天窗口的历史记录展示、导出的文件

        *   **错误处理：**

            - 聊天记录为空：显示"无消息"提示

            - 记录加载失败：显示错误提示和重试按钮

            - 记录导出失败：显示错误原因和重试按钮

            - 记录查询无结果：显示"无匹配记录"提示

            - 存储容量不足：显示"存储容量不足"提示和清理建议



    8.  **数据清理和维护逻辑：**

        *   **触发场景：** 定期执行、系统启动时、存储容量不足时

        *   **数据来源：** 系统配置、数据库状态、存储使用情况

        *   **处理流程：**

            - 检查存储容量使用情况

            - 根据保留策略清理过期数据

            - 优化数据库索引和表结构

            - 执行数据库vacuum操作，回收空间

        *   **数据去向：** 清理过期数据，释放存储空间

        *   **错误处理：**

            - 清理失败：记录错误并继续执行其他清理任务

            - 存储容量不足：优先清理最旧的数据

            - 数据库锁定：等待锁定释放后重试



    9.  **数据保留策略：**

        *   **触发场景：** 系统配置中定义

        *   **保留策略：**

            - 聊天记录：默认保留30天

            - 技能调用日志：默认保留7天

            - 智能体状态：长期保留

            - 文件元数据：与关联的聊天记录同生命周期

        *   **数据清理：**

            - 定期执行清理任务

            - 按智能体维度清理数据

            - 清理前备份重要数据

        *   **错误处理：**

            - 清理策略执行失败：记录错误并重试

            - 备份失败：暂停清理，确保数据安全



### 3.3 主题模块

*   **参考原型设计页面：**

    1. **《.\prototypes\MainLayout.html》**

*   **功能流程：**

    1.  **主题切换：**

        *   **主题选择：** 支持系统主题和自定义主题切换

        *   **主题预览：** 提供主题预览功能

        *   **主题保存：** 保存用户主题偏好设置

        *   **主题切换按钮：** 底部设置区域提供主题切换按钮（太阳/月亮图标）

        *   **主题持久化：** 保存用户主题偏好到本地存储

        *   **主题同步：** 切换主题时同步更新所有界面元素

        *   **主题图标更新：** 根据当前主题显示对应的图标

        *   **边界条件处理：**

            *   **主题切换失败：** 显示错误提示并恢复到之前的主题

            *   **主题配置加载失败：** 使用默认主题配置

            *   **自定义主题保存失败：** 显示错误提示和重试选项

            *   **主题预览失败：** 显示错误提示并使用默认预览

    2.  **界面样式适配：**

        *   **滚动条样式：** 根据主题调整滚动条颜色和样式

        *   **边框和背景：** 主题切换时同步更新边框、背景等界面元素

        *   **动画效果：** 主题切换时的平滑过渡动画

        *   **字体设置：** 支持字体大小和字体类型设置

        *   **颜色设置：** 支持界面颜色自定义

        *   **布局设置：** 支持界面布局调整

        *   **边界条件处理：**

            *   **字体加载失败：** 显示错误提示并使用默认字体

            *   **颜色设置无效：** 显示错误提示并使用默认颜色

            *   **布局调整失败：** 显示错误提示并使用默认布局

            *   **响应式适配：** 处理不同屏幕尺寸的适配问题

            *   **移动端适配：** 处理屏幕尺寸过小的情况

            *   **平板端适配：** 处理中等屏幕尺寸的布局

            *   **桌面端适配：** 处理多显示器的情况

*   **视觉设计：**

    1.  **主题切换按钮：**

        *   **位置：** 位于左侧边栏底部设置区域，与设置按钮并列

        *   **样式：** 图标按钮，圆角，悬停时背景色变化

        *   **图标：** 浅色主题显示太阳图标，深色主题显示月亮图标

        *   **尺寸：** 图标大小16px，按钮尺寸32x32px

    2.  **配色系统：**

        *   **浅色主题：**

            - 主色调：`#3b82f6`（蓝色）

            - 辅助色：`#8b5cf6`（紫色）

            - 文本颜色：主文本 `#1f2937`，次要文本 `#6b7280`

            - 背景颜色：主背景 `#ffffff`，次要背景 `#f9fafb`

            - 边框颜色：`#e5e7eb`

        *   **深色主题：**

            - 主色调：`#60a5fa`（亮蓝色）

            - 辅助色：`#a78bfa`（亮紫色）

            - 文本颜色：主文本 `#f9fafb`，次要文本 `#9ca3af`

            - 背景颜色：主背景 `#111827`，次要背景 `#1f2937`

            - 边框颜色：`#4b5563`

    3.  **组件适配：**

        *   **按钮：** 根据主题自动调整背景色、边框色和文本色

        *   **输入框：** 根据主题自动调整背景色、边框色和文本色

        *   **滚动条：**

            - 浅色主题：轨道 `#e5e7eb`，滑块 `#9ca3af`

            - 深色主题：轨道 `#1f2937`，滑块 `#4b5563`

        *   **消息气泡：** 根据主题自动调整颜色

        *   **智能体项：** 根据主题自动调整背景色和文本色

    4.  **动画效果：**

        *   **主题切换：** 平滑过渡动画，所有界面元素颜色渐变

        *   **图标切换：** 太阳/月亮图标旋转动画

    5.  **响应式设计：**

        *   **移动端：** 主题切换按钮尺寸适配，图标大小保持清晰

        *   **桌面端：** 完整显示主题切换按钮和图标

    6.  **交互反馈：**

        *   **主题切换：** 按钮点击时有轻微缩放效果

        *   **主题应用：** 所有界面元素立即响应主题变化

        *   **持久化：** 主题设置保存后下次启动自动应用

    7.  **性能要求：**

        *   **主题切换速度：** 切换过程不超过300ms

        *   **内存占用：** 主题切换不增加额外内存占用

        *   **渲染性能：** 主题切换不影响界面渲染性能

*   **UI元素：**

    1.  **主题切换按钮：**

        *   **位置：** 左侧边栏底部设置区域

        *   **图标：** 太阳/月亮SVG图标

        *   **尺寸：** 图标16px × 16px，按钮32px × 32px

        *   **样式：** 圆角，悬停时背景色变化

        *   **浅色主题：** 显示太阳图标，深色文本

        *   **深色主题：** 显示月亮图标，浅色文本

        *   **交互效果：** 点击时有轻微缩放效果

    2.  **主题预览组件：**

        *   **布局：** 网格布局，展示不同主题的预览

        *   **样式：** 卡片式设计，带有主题名称和颜色预览

        *   **悬停效果：** 阴影增强，边框高亮

        *   **选中状态：** 蓝色边框，勾选标记

    3.  **配色方案选择器：**

        *   **主色调选择：** 颜色选择器控件

        *   **辅助色选择：** 颜色选择器控件

        *   **文本颜色选择：** 颜色选择器控件

        *   **背景颜色选择：** 颜色选择器控件

        *   **样式：** 圆形颜色预览，点击弹出颜色面板

    4.  **字体设置控件：**

        *   **字体大小选择：** 滑块或下拉选择器

        *   **字体类型选择：** 下拉选择器，显示字体预览

        *   **样式：** 简洁表单控件，带有标签

    5.  **布局设置控件：**

        *   **侧边栏宽度设置：** 滑块控件

        *   **消息气泡大小设置：** 滑块控件

        *   **间距设置：** 滑块控件

        *   **样式：** 简洁表单控件，带有标签和当前值显示

    6.  **主题应用动画：**

        *   **过渡效果：** 所有界面元素的颜色和样式渐变

        *   **持续时间：** 300ms

        *   **性能优化：** 使用CSS变量和高效的动画实现

    7.  **响应式适配：**

        *   **移动端：** 主题切换按钮尺寸适配，图标大小保持清晰

        *   **桌面端：** 完整显示主题设置面板，支持更多自定义选项

        *   **平板端：** 适配中等屏幕尺寸，布局合理

*   **数据库表：**

    1.  **表结构：**

        *   **主题配置：** 主题配置以本地存储（localStorage）方式保存，无需数据库表

        *   **存储方式：**

            - 主题偏好设置

            - 界面样式配置

            - 用户自定义主题

*   **数据逻辑：**

    1.  **主题切换逻辑：**

        *   **触发场景：** 用户点击主题切换按钮时（对应功能流程1：主题切换）

        *   **数据来源：** 用户的主题切换操作、当前主题状态

        *   **处理流程：**

            - 识别用户的主题切换意图

            - 切换主题状态（浅色/深色）

            - 更新界面元素的样式和颜色

            - 保存主题偏好到本地存储

            - 更新主题切换按钮的图标

        *   **数据去向：** 本地存储的主题偏好设置、界面元素的样式更新

        *   **错误处理：**

            - 主题切换失败：显示错误提示并恢复到之前的主题

            - 主题配置加载失败：使用默认主题配置



    2.  **主题配置保存逻辑：**

        *   **触发场景：** 用户修改主题设置时（对应功能流程1：主题切换）

        *   **数据来源：** 用户的主题设置输入、当前主题配置

        *   **处理流程：**

            - 收集用户的主题设置

            - 验证设置的合法性

            - 构建主题配置对象

            - 序列化并保存到本地存储

            - 应用新的主题配置

        *   **数据去向：** 本地存储的主题配置、界面元素的样式更新

        *   **错误处理：**

            - 配置保存失败：显示错误提示和重试选项

            - 配置格式错误：使用默认配置并显示错误提示

            - 本地存储容量不足：显示清理建议



    3.  **主题预览逻辑：**

        *   **触发场景：** 用户在主题设置中预览不同主题时（对应功能流程1：主题切换）

        *   **数据来源：** 用户的预览操作、主题配置数据

        *   **处理流程：**

            - 生成预览主题的样式

            - 应用预览样式到界面

            - 显示预览效果

            - 等待用户确认或取消

        *   **数据去向：** 临时的界面样式更新

        *   **错误处理：**

            - 预览失败：显示错误提示并恢复到当前主题

            - 预览性能问题：优化预览逻辑，减少资源占用



### 3.4 启动页模块

*   **参考原型设计页面：**

    1. **《.\prototypes\MainLayout.html》**

*   **功能流程：**

    1.  **应用启动流程：**

        *   **启动加载：** 应用启动时加载必要资源和配置

        *   **初始化：** 初始化智能体配置和系统状态

        *   **跳转逻辑：** 根据用户状态跳转到相应页面

        *   **边界条件处理：**

            *   **启动加载失败：** 显示错误提示和重试按钮

            *   **初始化失败：** 显示错误提示和重置选项

            *   **跳转逻辑异常：** 显示错误提示并跳转到默认页面

            *   **启动时间过长：** 显示加载进度条和预计剩余时间

    2.  **欢迎页展示：**

        *   **欢迎界面：** 首次启动或无选中智能体时显示欢迎页

        *   **功能介绍：** 展示系统主要功能和使用说明

        *   **快速入口：** 提供常用智能体快速访问入口

        *   **统计信息展示：** 显示可用智能体数量、可用技能数量、对话次数等统计信息

        *   **统计数字动画：** 统计数字的渐变色动画效果

        *   **统计卡片交互：** 统计卡片鼠标悬停时的上浮和阴影效果

        *   **快速开始引导：** 三步快速开始指南（选择智能体→输入问题→按Enter发送）

        *   **欢迎页主图标动画：** 主图标带有浮动动画效果

        *   **边界条件处理：**

            *   **无智能体选中：** 显示欢迎页和添加智能体的引导

            *   **智能体信息加载失败：** 显示默认头像和名称

            *   **统计数据加载失败：** 显示默认值和错误提示

            *   **统计数字为零：** 显示"暂无数据"提示

            *   **引导步骤完成：** 显示完成提示和开始使用按钮

            *   **引导步骤中断：** 保存引导进度，下次继续

    3.  **界面适配：**

        *   **主题适配：** 欢迎页背景和元素根据当前主题调整

*   **视觉设计：**

    1.  **页面布局：**

        *   **居中显示：** 所有元素垂直和水平居中

        *   **响应式网格：** 统计卡片使用网格布局，根据屏幕尺寸自适应

        *   **间距：** 适当的元素间距，确保视觉层次清晰

    2.  **配色方案：**

        *   **浅色主题：**

            - 背景：`linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)`

            - 统计卡片：`linear-gradient(to-br, #f3f4f6, #e5e7eb)`

            - 文本：标题 `#1f2937`，描述 `#6b7280`

            - 统计数字：渐变色 `linear-gradient(135deg, #3b82f6, #8b5cf6)`

        *   **深色主题：**

            - 背景：`linear-gradient(135deg, #111827 0%, #1f2937 100%)`

            - 统计卡片：`linear-gradient(to-br, #374151, #4b5563)`

            - 文本：标题 `#f9fafb`，描述 `#9ca3af`

            - 统计数字：渐变色 `linear-gradient(135deg, #60a5fa, #a78bfa)`

    3.  **按钮样式：**

        *   **快速开始引导：** 步骤编号圆形渐变背景，文本颜色白色

    4.  **字体排版：**

        *   **标题：** 24px，粗体

        *   **描述：** 14px，常规字重

        *   **统计数字：** 24px，粗体，渐变色

        *   **统计标签：** 12px，常规字重，浅色

        *   **快速开始步骤：** 14px，常规字重

    5.  **动画效果：**

        *   **主图标：** 浮动动画（3秒循环，上下浮动10px）

        *   **统计数字：** 渐变色动画效果

        *   **统计卡片：** 悬停时上浮4px，阴影增强

        *   **快速开始步骤：** 悬停时文本颜色变为主题色

    6.  **响应式设计：**

        *   **移动端（≤768px）：**

            - 主图标尺寸调整为80x80px

            - 统计卡片变为单列布局

            - 字体大小适当缩小

        *   **平板端（768px-1024px）：**

            - 统计卡片保持网格布局，间距适当调整

        *   **桌面端（≥1024px）：**

            - 完整布局，统计卡片三列显示

    7.  **特殊元素：**

        *   **主图标：** 圆形渐变背景，带有阴影效果

        *   **统计卡片：** 顶部3px渐变边框，悬停时显示

        *   **快速开始引导：** 背景半透明，圆角边框

        *   **步骤编号：** 圆形渐变背景，居中显示

*   **UI元素：**

    1.  **欢迎页容器：**

        *   **id：** `welcomeContent`

        *   **背景：** 线性渐变（浅色主题：#f9fafb 到 #f3f4f6；深色主题：#111827 到 #1f2937）

        *   **布局：** 垂直居中，flex布局

        *   **内容：** 主图标、标题、描述、统计卡片、快速开始引导

    2.  **主图标：**

        *   **尺寸：** 96px × 96px（桌面端），80px × 80px（移动端）

        *   **样式：** 圆形渐变背景（#3b82f6 到 #8b5cf6），带有阴影效果

        *   **图标：** 对话气泡SVG图标，白色，56px × 56px

        *   **动画：** 浮动动画（3秒循环，上下浮动10px）

*   **数据库表：**

    1.  **表结构：**

        *   **启动配置：** 启动配置以本地存储（localStorage）方式保存，无需数据库表

        *   **存储方式：**

            - 启动首选项

            - 欢迎页状态

            - 快速开始引导进度

*   **数据逻辑：**

    1.  **应用启动初始化逻辑：**

        *   **触发场景：** 应用启动时（对应功能流程1：应用启动流程）

        *   **数据来源：** 本地配置文件、本地存储的设置、系统环境

        *   **处理流程：**

            - 加载必要的资源文件

            - 读取本地存储的启动首选项

            - 初始化智能体配置

            - 检查系统状态和网络连接

            - 根据用户状态决定跳转逻辑

        *   **数据去向：** 应用的运行状态、本地存储的初始化状态

        *   **错误处理：**

            - 启动加载失败：显示错误提示和重试按钮

            - 初始化失败：显示错误提示和重置选项

            - 跳转逻辑异常：显示错误提示并跳转到默认页面

            - 启动时间过长：显示加载进度条和预计剩余时间



    2.  **欢迎页展示逻辑：**

        *   **触发场景：** 应用启动时无选中智能体、用户首次启动应用时（对应功能流程2：欢迎页展示）

        *   **数据来源：** 智能体配置、聊天记录统计、本地存储的欢迎页状态

        *   **处理流程：**

            - 计算可用智能体数量

            - 统计可用技能数量

            - 计算对话次数

            - 加载快速开始引导步骤

            - 展示统计信息和引导内容

        *   **数据去向：** 欢迎页的统计信息展示、引导步骤显示

        *   **错误处理：**

            - 智能体信息加载失败：显示默认头像和名称

            - 统计数据加载失败：显示默认值和错误提示

            - 统计数字为零：显示"暂无数据"提示



    3.  **快速开始引导逻辑：**

        *   **触发场景：** 用户在欢迎页点击快速开始按钮时（对应功能流程2：欢迎页展示）

        *   **数据来源：** 用户的引导步骤操作、本地存储的引导进度

        *   **处理流程：**

            - 跟踪引导步骤的完成状态

            - 保存引导进度到本地存储

            - 提供步骤间的导航

            - 引导用户完成智能体选择和消息发送

        *   **数据去向：** 本地存储的引导进度、界面的引导步骤显示

        *   **错误处理：**

            - 引导步骤中断：保存引导进度，下次继续

            - 引导步骤完成：显示完成提示和开始使用按钮



    4.  **统计卡片：**

        *   **布局：** 网格布局，3列（桌面端），1列（移动端）

        *   **样式：** 卡片式设计，顶部3px渐变边框

        *   **内容：** 统计数字、统计标签

        *   **统计数字：** 24px，粗体，渐变色文本

        *   **统计标签：** 12px，常规字重，浅色文本

        *   **悬停效果：** 上浮4px，阴影增强，顶部边框显示

    4.  **快速开始引导：**

        *   **容器：** 半透明背景，圆角边框

        *   **标题：** 14px，半粗体

        *   **步骤项：**

            *   **步骤编号：** 20px × 20px，圆形渐变背景，白色文本

            *   **步骤文本：** 14px，常规字重

            *   **悬停效果：** 文本颜色变为主题色

    5.  **响应式适配：**

        *   **移动端（≤768px）：**

            *   **主图标尺寸：** 80px × 80px

            *   **统计卡片：** 单列布局，间距调整

            *   **字体大小：** 适当缩小

        *   **平板端（768px-1024px）：**

            *   **统计卡片：** 网格布局，间距调整

        *   **桌面端（≥1024px）：**

            *   **完整布局：** 统计卡片三列显示

            *   **字体大小：** 标准尺寸

    6.  **主题适配：**

        *   **浅色主题：**

            *   **背景：** 浅色渐变

            *   **文本：** 深色文本

            *   **统计卡片：** 浅色背景渐变

        *   **深色主题：**

            *   **背景：** 深色渐变

            *   **文本：** 浅色文本

            *   **统计卡片：** 深色背景渐变



## 4. 技术架构



### 4.1 前端技术栈



- **React 18.2.0+**：使用函数组件和 Hooks 进行组件化开发，采用 React Context API 管理全局状态，使用 React.memo 和 useCallback 优化性能

- **TypeScript 5.0.0+**：提供类型安全，定义完整的接口类型和联合类型，使用泛型增强代码复用性，配置严格模式确保类型正确性

- **Tailwind CSS 3.3.0+**：使用自定义配置扩展默认主题，配置响应式断点，使用 @apply 指令封装常用样式，集成深色模式支持

- **Vite 4.4.0+**：配置开发服务器代理，使用 ES 模块按需加载，集成 TypeScript 和 Tailwind CSS，配置构建优化策略（如代码分割、tree-shaking）

- **React Router**：实现单页应用路由管理，支持嵌套路由和路由守卫

- **React Query**：管理服务器状态和数据缓存，优化数据获取和更新



### 4.2 后端技术栈



- **Tauri 1.5.0+**：基于 Rust 的桌面应用框架，通过自定义命令与 Python 后端集成，配置窗口大小和标题，实现系统托盘功能，集成文件系统 API，配置安全策略

- **Python 3.10.0+**：使用异步 IO（asyncio）实现并发处理，使用 pydantic 进行数据验证，使用 logging 库实现日志记录，使用 fastapi 构建高性能 API

- **Node.js 18.0.0+**：通过子进程调用执行智能体技能，管理 npm 依赖，提供技能运行环境

- **Playwright 1.36.0+**：配置浏览器自动化测试，实现网页截图、表单填写等操作，支持多浏览器环境

- **Python 库**：

  - fastapi：构建高性能 API

  - sqlalchemy：ORM 框架，简化数据库操作

  - pydantic：数据验证和序列化

  - aiosqlite：异步 SQLite 驱动

  - cryptography：提供加密功能



### 4.3 数据库



- **SQLite 3.40.0+**：配置数据库文件路径，设置 PRAGMA 优化参数（如 journal_mode=WAL），实现数据库备份和恢复

- **SQLAlchemy**：使用 ORM 框架管理数据库模型和操作，提供事务支持，处理数据库连接池，提供错误处理机制

- **Alembic**：使用数据库迁移工具管理数据库版本，实现结构变更的平滑过渡

- **aiosqlite**：提供异步 SQLite 操作，与 Python 异步 IO 集成



### 4.4 架构设计



- **模块划分**：

  - 前端：智能体模块、聊天交互模块、主题模块、启动页模块

  - 后端：核心服务（Python）、技能执行服务（Python/Node.js）、数据库服务（Python）、文件服务（Python）

- **前后端通信**：

  - 使用 Tauri 的 invoke API 调用 Python 后端函数

  - 使用 Tauri 的事件系统实现后端向前端推送消息

  - 可选：使用 WebSocket 实现实时通信

- **数据流**：

  - 用户输入 → 前端处理 → Tauri → Python 后端处理 → 结果返回 → 前端展示

  - 智能体配置 → 前端加载 → Python 后端验证 → 前端展示

- **安全架构**：

  - 前端：输入验证，防止 XSS 攻击

  - 后端：技能执行沙箱，权限控制，数据加密（使用 cryptography 库）

- **部署架构**：

  - 使用 Tauri 构建跨平台应用，内嵌 Python 运行时，支持 Windows、macOS、Linux

  - 打包优化，减少应用体积

  - 确保 Python 依赖的正确打包



### 4.5 技术选型理由



- **React + TypeScript**：提供类型安全的组件化开发，适合构建复杂的用户界面

- **Tailwind CSS**：快速构建响应式 UI，减少 CSS 代码量，提高开发效率

- **Vite**：快速的开发和构建体验，适合现代前端项目

- **Tauri**：轻量级桌面应用框架，相比 Electron 体积更小，性能更好

- **Python**：高级编程语言，语法简洁易读，生态丰富，适合快速开发后端服务，拥有强大的数据处理和 AI 相关库

- **SQLite**：轻量级嵌入式数据库，无需额外安装，适合桌面应用的数据存储，与 Python 集成良好

- **Playwright**：功能强大的浏览器自动化工具，适合智能体的网页操作需求







## 5. 非功能性需求



### 5.1 性能要求



- 应用启动时间 < 3 秒

- 界面操作响应时间 < 300ms

- 消息发送延迟 < 500ms

- 数据库查询响应时间 < 100ms（常规查询）

- 大文件上传不影响界面响应

- 支持断点续传（可选）



### 5.2 安全性要求



- 用户密码使用加密存储（如 bcrypt）

- 防止 SQL 注入和 XSS 攻击

- 用户数据本地化存储，不上传云端

- 文件传输的安全性保护

- 文件存储的安全性加密

- 支持文件访问权限控制



### 5.3 兼容性要求



- **Windows**：Windows 10 及以上版本

- **macOS**：macOS 10.15 (Catalina) 及以上版本

- **Linux**：麒麟V10（推荐）、统信UOS（推荐）

- 支持常见文件类型的预览（图片、文档等）



### 5.4 可用性要求



- 界面简洁直观，符合即时通讯软件的使用习惯

- 提供完善的错误提示和帮助文档

- 支持快捷键操作

- 支持主题切换（可选）

- 文件上传和下载操作简单易用



### 5.5 可维护性要求



- 模块化设计，降低模块间耦合度

- 完善的日志记录机制

- 代码注释和文档完善

- 支持插件化扩展



### 5.6 可扩展性要求



- 支持新增智能体类型

- 支持消息类型的扩展（如图片、文件等）

- 支持新增文件类型的预览

- 预留第三方集成接口

- 预留云存储集成接口



## 6. 数据模型



### 6.1 聊天消息表 (chat_messages)



| 字段名 | 数据类型 | 约束 | 描述 |

| :--- | :--- | :--- | :--- |

| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 消息ID，主键，自增 |

| `agent_id` | `VARCHAR(255)` | `NOT NULL` | 智能体ID |

| `agent_name` | `VARCHAR(255)` | `NOT NULL` | 智能体名称 |

| `user_id` | `VARCHAR(255)` | `NOT NULL` | 用户ID |

| `user_name` | `VARCHAR(255)` | `NOT NULL` | 用户名称 |

| `content` | `TEXT` | `NOT NULL` | 消息内容 |

| `message_type` | `VARCHAR(50)` | `NOT NULL` | 消息类型（user/agent） |

| `send_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 发送时间 |

| `status` | `VARCHAR(50)` | `DEFAULT 'sent'` | 消息状态（sent/delivered/read/failed） |

| `message_length` | `INTEGER` | `DEFAULT 0` | 消息长度 |

| `has_attachment` | `BOOLEAN` | `DEFAULT FALSE` | 是否包含附件 |

| `attachment_path` | `TEXT` | | 附件路径 |

| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



### 6.2 技能调用表 (skill_calls)



| 字段名 | 数据类型 | 约束 | 描述 |

| :--- | :--- | :--- | :--- |

| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 调用ID，主键，自增 |

| `message_id` | `INTEGER` | `REFERENCES chat_messages(id)` | 消息ID，外键 |

| `agent_id` | `VARCHAR(255)` | `NOT NULL` | 智能体ID |

| `skill_name` | `VARCHAR(255)` | `NOT NULL` | 技能名称 |

| `parameters` | `TEXT` | | 技能参数，JSON格式 |

| `call_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 调用时间 |

| `status` | `VARCHAR(50)` | `DEFAULT 'pending'` | 执行状态（pending/success/failed/timeout） |

| `result` | `TEXT` | | 执行结果 |

| `execution_time` | `INTEGER` | `DEFAULT 0` | 执行时间（毫秒） |

| `error_message` | `TEXT` | | 错误信息 |

| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



### 6.3 智能体状态表 (agent_status)



| 字段名 | 数据类型 | 约束 | 描述 |

| :--- | :--- | :--- | :--- |

| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 状态ID，主键，自增 |

| `agent_id` | `VARCHAR(255)` | `UNIQUE NOT NULL` | 智能体ID，唯一 |

| `agent_name` | `VARCHAR(255)` | `NOT NULL` | 智能体名称 |

| `online_status` | `BOOLEAN` | `DEFAULT FALSE` | 在线状态 |

| `last_online_time` | `DATETIME` | | 最后在线时间 |

| `response_time` | `INTEGER` | `DEFAULT 0` | 响应时间（毫秒） |

| `status_message` | `TEXT` | | 状态消息 |

| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



### 6.4 文件元数据表 (file_metadata)



| 字段名 | 数据类型 | 约束 | 描述 |

| :--- | :--- | :--- | :--- |

| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 文件ID，主键，自增 |

| `message_id` | `INTEGER` | `REFERENCES chat_messages(id) ON DELETE CASCADE` | 关联的消息ID，外键 |

| `file_name` | `VARCHAR(255)` | `NOT NULL` | 文件名 |

| `file_type` | `VARCHAR(100)` | `NOT NULL` | 文件类型 |

| `file_size` | `INTEGER` | `NOT NULL` | 文件大小（字节） |

| `storage_path` | `TEXT` | `NOT NULL` | 存储路径 |

| `file_hash` | `VARCHAR(255)` | | 文件哈希值 |

| `upload_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 上传时间 |

| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |



## 7. 智能体与技能配置格式



### 7.1 配置文件路径



智能体与技能的配置信息以JSON格式存储在项目根目录下的 `./config/agents.json` 文件中。系统启动时会自动加载该配置文件，初始化智能体列表和技能信息。



### 7.2 配置文件结构



配置文件包含两个主要部分：



1. **agents**：智能体分组和配置信息

   - 每个分组包含多个智能体

   - 每个智能体包含ID、名称、描述、头像、类型、配置和技能列表

   - 智能体配置包括模型URL、API密钥、模型名称等

   - 技能列表包含智能体可调用的技能及其版本和配置覆盖



2. **skills**：技能配置信息

   - 所有技能都存储在 `./skills/` 目录下，每个技能有一个子目录

   - 每个技能包含名称、描述、类型、存储相对路径和版本信息

   - 每个版本包含配置信息和创建时间

   - 技能类型包括信息获取、文件处理、数据分析、代码处理、生产力工具等



### 7.3 配置文件示例



配置文件的详细内容已移至 `./config/agents.json` 文件中，包含完整的智能体分组、智能体配置和技能配置信息。



### 7.4 配置加载流程



1. **系统启动**：应用启动时从 `./config/agents.json` 读取配置文件

2. **解析配置**：解析JSON配置，按 `group_name` 字段对智能体进行分组

3. **初始化智能体**：根据配置创建智能体实例，加载对应的技能

4. **渲染界面**：将分组信息和智能体列表渲染到左侧边栏

5. **错误处理**：处理配置文件不存在、格式错误等异常情况



### 7.5 配置管理



- **手动编辑**：直接编辑 `./config/agents.json` 文件修改配置

- **配置验证**：系统启动时会验证配置格式，确保所有必要字段存在

- **配置更新**：修改配置后重启应用即可生效

- **配置备份**：建议定期备份配置文件，防止意外丢失









