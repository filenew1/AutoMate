
## 2.1 智能体管理
### 2.1.1 参考原型设计页面
    MainLayout.html
### 2.1.2 功能流程

#### 搜索功能
- **搜索条件**：智能体名称、描述
- **搜索按钮**：放大镜图标按钮，点击后执行搜索
- **输入框**：placeholder为"搜索智能体..."，支持实时搜索

#### 智能体列表
- **表格列**：
  - 智能体头像：圆形渐变背景，显示智能体图标
  - 智能体名称：文本，支持截断显示
  - 状态：在线/离线标识（绿色圆点表示在线）
  - 描述：智能体功能描述文本
- **操作按钮**：无（点击智能体项进入对话）

#### 分组管理
- **分组头部**：包含分组名称和展开/折叠图标
- **分组内容**：显示该分组下的所有智能体
- **交互**：点击分组头部可展开/折叠分组

#### 智能体选择
- **选中状态**：选中的智能体项有特殊背景样式
- **交互**：点击智能体项切换当前选中的智能体

#### 底部操作
- **主题切换按钮**：切换浅色/深色主题
- **设置按钮**：打开系统设置页面
- **版本信息**：显示当前版本号
### 2.1.3 交互流程

#### 搜索功能交互流程
1. **初始状态**：搜索框显示placeholder"搜索智能体..."
2. **用户输入**：
   - 用户在搜索框中输入关键词
   - 系统实时监听input事件
   - 获取输入框的值并转换为小写
   - 去除首尾空格
   - **防抖机制**：输入停止300ms后执行搜索，避免频繁搜索导致性能问题
   - **输入长度限制**：最大输入长度限制为100字符，超过后禁止继续输入并显示提示"搜索内容过长"
   - **特殊字符处理**：自动过滤掉SQL注入字符（如'、"、;、--、/*、*/等），防止安全风险
   - **空输入处理**：如果用户只输入空格或制表符，视为空输入，不执行搜索
   - **输入框禁用状态**：如果智能体列表为空或正在加载中，搜索框自动禁用并显示"暂无数据可搜索"
3. **搜索执行**：
   - 如果搜索内容为空：
     - 显示所有智能体项
     - 移除所有智能体项的hidden类
     - 隐藏"无搜索结果"提示框
   - 如果搜索内容不为空：
     - 遍历所有智能体项
     - 获取每个智能体的名称（转换为小写）
     - 获取每个智能体的描述（转换为小写）
     - 判断智能体名称或描述是否包含搜索关键词
     - 如果包含：移除hidden类，显示智能体项
     - 如果不包含：添加hidden类，隐藏智能体项
   - **数据缺失处理**：如果智能体项缺少名称或描述字段，跳过该字段继续搜索，记录警告日志
   - **null/undefined处理**：如果智能体名称或描述为null或undefined，视为空字符串处理
   - **搜索超时处理**：如果搜索执行时间超过5秒，显示"搜索超时，请重试"提示，中断当前搜索
   - **搜索中断处理**：用户在搜索执行期间继续输入，取消当前未完成的搜索任务
4. **实时反馈**：
   - 用户每输入一个字符，立即更新搜索结果
   - 搜索结果实时显示/隐藏对应的智能体项
   - **搜索结果计数**：在搜索框下方显示"找到X个匹配项"
   - **搜索高亮**：匹配的关键词在智能体名称和描述中高亮显示（黄色背景）
   - **搜索加载状态**：搜索执行期间显示加载指示器，防止用户重复点击
   - **搜索性能监控**：记录搜索耗时，如果连续3次搜索超过2秒，提示用户"搜索较慢，建议精简关键词"
5. **无结果提示**：
   - 当搜索无结果时：
     - 显示"未找到匹配的智能体"提示信息
     - 提示信息居中显示，带图标和文字说明
     - 提供"清除搜索"按钮，点击可快速清空搜索框
     - 提供"搜索建议"：显示相似关键词或推荐搜索词
   - **空列表处理**：如果智能体列表本身为空，搜索无结果时显示"暂无智能体数据，请先添加智能体"
6. **清空搜索**：
   - 用户清空搜索框内容
   - 自动显示所有智能体项
   - 隐藏搜索结果计数
   - 隐藏无结果提示
   - **清空失败处理**：如果清空操作失败（如DOM操作异常），强制刷新页面或重新渲染列表
7. **快捷键支持**：
   - Ctrl+F或Cmd+F：自动聚焦到搜索框
   - Esc键：清空搜索内容并移除焦点
   - Enter键：执行搜索（当防抖延迟时）
   - **快捷键冲突处理**：如果浏览器或其他插件已占用快捷键，提供替代方案或提示用户
   - **焦点丢失处理**：如果搜索框失去焦点，5秒后自动隐藏搜索历史下拉列表
8. **搜索历史**：
   - 记录最近10次搜索关键词
   - 点击搜索框时显示搜索历史下拉列表
   - 点击历史项可快速填充搜索框
   - 历史记录支持单独删除（鼠标悬停显示删除按钮）
   - **历史记录存储失败处理**：如果localStorage不可用或已满，静默失败，不影响搜索功能
   - **历史记录去重**：相同关键词不重复记录，更新最后搜索时间
   - **敏感信息处理**：不记录包含密码、token等敏感信息的搜索历史
   - **历史记录清空**：提供"清空历史"按钮，清空前显示确认对话框

#### 分组展开/折叠交互流程
1. **初始状态**：
   - 分组头部显示展开状态（向下箭头图标）
   - 分组内容显示expanded类，内容可见
   - **数据异常处理**：如果分组数据为空或不完整，显示"分组数据异常，请刷新页面"错误提示
   - **分组不存在处理**：如果分组元素不存在，记录错误日志并尝试重新渲染分组
2. **用户点击分组头部**：
   - 触发click事件
   - **点击防抖**：使用300ms节流，防止快速连续点击
   - **点击区域验证**：验证点击事件来源，确保是用户主动点击而非脚本触发
   - **重复点击处理**：如果用户在动画执行期间点击，忽略后续点击直到动画完成
   - 获取该分组头部对应的分组内容元素
   - **DOM元素不存在处理**：如果分组内容元素不存在，记录错误日志并提示用户"分组加载失败"
3. **展开状态切换到折叠状态**：
   - 分组内容移除expanded类
   - 分组内容添加collapsed类
   - 分组头部移除expanded类
   - 分组头部添加collapsed类
   - 箭头图标旋转-90度（向上）
   - 分组内容max-height从500px过渡到0
   - 分组内容opacity从1过渡到0
   - **动画中断处理**：如果用户在动画执行期间切换分组，立即中断当前动画
   - **动画异常处理**：如果动画执行失败，直接更新DOM状态而不执行动画
   - **状态同步**：确保分组头部和内容的状态一致，避免状态不同步
4. **折叠状态切换到展开状态**：
   - 分组内容移除collapsed类
   - 分组内容添加expanded类
   - 分组头部移除collapsed类
   - 分组头部添加expanded类
   - 箭头图标恢复到0度（向下）
   - 分组内容max-height从0过渡到500px
   - 分组内容opacity从0过渡到1
   - **内容加载处理**：如果分组内容为空，显示"暂无智能体"提示
   - **高度自适应**：如果分组内容高度超过500px，使用实际高度而非固定值
   - **展开失败处理**：如果展开失败，记录错误日志并尝试重新加载分组内容
5. **动画效果**：
   - 过渡时间为0.3秒
   - 过渡效果为ease
   - 所有样式变化都有平滑过渡
   - **性能优化**：使用CSS transform和opacity属性优化动画性能
   - **动画禁用**：如果用户启用了"减少动画"系统设置，禁用所有展开/折叠动画
   - **动画回退**：如果浏览器不支持CSS过渡，直接更新DOM状态
6. **状态持久化**：
   - 将分组展开/折叠状态保存到localStorage
   - 键名为"groupStates-{分组ID}"
   - **保存失败处理**：如果localStorage保存失败，静默失败，不影响展开/折叠功能
   - **状态恢复**：刷新页面后自动恢复分组展开/折叠状态
   - **状态恢复失败处理**：如果保存的状态无效，使用默认展开状态
7. **快捷键支持**：
   - 点击分组头部时，按住Shift键：展开/折叠所有分组
   - **快捷键限制**：如果分组数量超过20个，不提供"展开所有"功能以避免性能问题
   - **快捷键冲突处理**：如果浏览器已占用快捷键，提示用户并提供替代方案
8. **特殊场景处理**：
   - **空分组处理**：如果分组内没有智能体，显示"此分组为空"并提供"删除分组"选项
   - **分组嵌套**：支持多级分组嵌套，展开父分组时自动展开子分组
   - **分组拖拽**：支持拖拽调整分组顺序，拖拽时显示预览效果
   - **分组重命名**：双击分组头部可重命名，重命名时验证名称唯一性
   - **分组删除**：右键点击分组头部显示"删除分组"选项，删除前显示确认对话框
   - **分组锁定**：管理员可锁定分组，锁定后用户无法展开/折叠
   - **批量操作**：提供"展开所有"/"折叠所有"按钮，批量操作时显示加载状态
   - **记忆功能**：记住每个用户的分组展开/折叠偏好

#### 智能体项点击交互流程
1. **初始状态**：
   - 显示欢迎页面内容
   - 所有聊天内容面板隐藏
   - 顶部栏显示默认信息
   - **数据异常处理**：如果智能体列表数据为空或加载失败，显示"智能体列表加载失败，请刷新页面重试"错误提示
   - **重复点击防护**：使用节流机制防止用户快速连续点击导致状态混乱
2. **用户点击智能体项**：
   - 触发click事件
   - **点击反馈**：智能体项立即显示点击波纹效果
   - **点击区域验证**：验证点击事件来源，确保是用户主动点击而非脚本触发
   - 获取被点击智能体项的data属性：
     - data-agent-id：智能体ID
     - data-agent-name：智能体名称
     - data-agent-avatar：智能体头像类型
   - **数据有效性检查**：
     - 如果智能体ID为空、null或undefined，显示"智能体数据异常，无法加载"错误提示
     - 如果智能体名称为空，显示默认名称"未命名智能体"
     - 如果智能体头像类型无效，使用默认头像
   - **重复选择处理**：如果点击的是当前已选中的智能体，不执行加载，只滚动到消息底部
3. **加载状态显示**：
   - 智能体项显示加载指示器（旋转圆环）
   - 顶部栏显示"正在连接..."状态提示
   - 顶部栏头像显示加载动画
   - 加载指示器持续时间：200-500ms（模拟连接过程）
   - **加载超时处理**：如果加载超过10秒仍未完成，自动中断并显示"连接超时，请检查网络后重试"
   - **加载中断处理**：如果用户在加载期间切换到其他智能体，取消当前加载任务
   - **多次点击处理**：加载期间禁用智能体项点击，防止重复加载
4. **数据加载**：
   - 从本地存储或服务器加载智能体的聊天历史
   - 加载进度条显示：从0%到100%，平滑过渡
   - 如果聊天历史超过100条，优先加载最近50条，剩余异步加载
   - **加载失败重试机制**：提供最多3次自动重试，每次间隔2秒
   - **本地存储异常处理**：如果localStorage不可用，显示"本地存储不可用，请检查浏览器设置"
   - **服务器异常处理**：如果服务器返回500/502/503错误，显示"服务器繁忙，请稍后重试"
   - **网络异常处理**：如果网络断开，显示"网络连接失败，请检查网络后重试"并显示离线模式提示
   - **数据格式验证**：验证聊天历史数据格式，格式错误时显示"数据格式异常，请联系管理员"
   - **数据完整性检查**：检查消息是否缺少必要字段（id、content、timestamp等），缺失时跳过该消息并记录日志
5. **错误处理**：
   - 如果智能体数据加载失败：
     - 显示错误提示框："加载智能体失败，请重试"
     - 提供"重试"和"返回"两个操作按钮
     - 错误提示框在5秒后自动消失
     - 错误信息记录到系统日志
     - **重试限制**：最多允许用户手动重试5次，超过后禁用重试按钮
   - 如果智能体离线：
     - 显示"智能体离线，无法建立连接"提示
     - 状态指示器显示为灰色
     - 禁用发送消息功能
     - 提供"查看历史消息"选项
     - **离线模式限制**：离线模式下只显示历史消息，不提供新建对话功能
   - **未知错误处理**：捕获所有未预期的错误，显示"发生未知错误，请稍后重试"通用提示
   - **错误上报**：关键错误自动上报到监控系统，包含错误堆栈和用户操作路径
6. **选中状态更新**：
   - 移除所有智能体项的selected类
   - 为被点击的智能体项添加selected类
   - 更新智能体项的背景样式
   - **选中动画**：背景色从透明过渡到选中色（0.2s）
   - **状态同步**：确保所有UI组件的状态一致性，避免状态不同步导致的视觉混乱
   - **状态持久化**：将选中智能体ID保存到localStorage，刷新页面后自动恢复
   - **状态恢复失败处理**：如果localStorage中的智能体ID不存在，显示欢迎页面并清空选中状态
7. **欢迎页面隐藏**：
   - 查找欢迎页面元素
   - 添加hidden类，隐藏欢迎页面
   - 隐藏动画：fade-out效果，持续0.3s
   - **DOM不存在处理**：如果欢迎页面元素不存在，静默忽略错误，继续执行后续步骤
8. **聊天内容切换**：
   - 查找所有聊天内容面板
   - 为所有聊天内容面板添加hidden类
   - 查找目标智能体的聊天内容面板（ID为chat-{agent-id}）
   - 移除hidden类，显示目标聊天内容
   - **内容入场动画**：slide-up效果，持续0.3s
   - **面板不存在处理**：如果目标聊天内容面板不存在，创建新面板并显示欢迎消息"开始新的对话"
   - **面板创建失败处理**：如果创建新面板失败，显示"无法创建对话面板，请刷新页面重试"
   - **旧数据清理**：清理超过30天的未选中智能体的聊天数据，释放内存空间
9. **顶部栏信息更新**：
   - 查找顶部栏的智能体头像元素
   - 根据智能体头像类型设置对应的渐变背景
   - 更新智能体图标SVG内容
   - 查找顶部栏的智能体名称元素
   - 更新智能体名称为选中的智能体名称
   - **名称长度处理**：如果智能体名称超过20字符，截断显示为"名称...前17字符"，悬停显示完整名称
   - 查找顶部栏的状态描述元素
   - 更新状态为"在线"（绿色指示灯）
   - **元素不存在处理**：如果顶部栏元素不存在，记录错误日志并尝试重新渲染顶部栏
   - **头像加载失败处理**：如果头像加载失败，显示默认头像并记录警告日志
10. **消息滚动**：
    - 自动滚动到聊天记录底部
    - **滚动失败处理**：如果滚动容器不存在，记录错误日志并尝试重新获取滚动容器
    - **滚动位置验证**：验证滚动是否成功，失败后使用备用滚动方法（scrollToView）
    - 显示"有新消息"提示（如果有未读消息）
    - **未读消息标记处理**：未读消息标记从智能体项移除，并更新服务器未读状态
    - **未读消息更新失败**：如果服务器更新失败，在本地暂存，下次成功时同步
    - **大量消息处理**：如果消息超过1000条，只显示最近500条，提供"加载更多历史消息"按钮
11. **快捷操作**：
    - 提供快捷键切换上一个/下一个智能体（↑/↓方向键）
    - **边界处理**：到达第一个智能体时，按上方向键不执行操作；到达最后一个智能体时，按下方向键不执行操作
    - 提供快捷键搜索（Ctrl/Cmd + K）
    - 提供快捷键新建对话（Ctrl/Cmd + N）
    - **快捷键冲突处理**：如果浏览器已占用快捷键，提示用户并提供替代方案
    - **快捷键禁用状态**：在输入框中输入时禁用快捷键，避免误触发
12. **界面响应**：
    - 界面平滑切换到选中的智能体对话界面
    - 所有更新立即生效
    - 整体切换时间不超过800ms
    - **性能监控**：记录切换耗时，如果连续3次超过1秒，提示用户"性能较差，建议清理缓存"
    - **内存监控**：监控内存使用情况，如果超过阈值，自动清理旧数据
    - **并发限制**：同时最多允许2个智能体加载任务，超过则排队等待
13. **特殊场景处理**：
    - **页面刷新**：刷新后恢复之前选中的智能体，如果智能体不存在则显示欢迎页面
    - **智能体删除**：如果选中的智能体被删除，自动切换到其他智能体或显示欢迎页面
    - **智能体更新**：如果智能体信息更新，实时更新顶部栏显示
    - **权限异常**：如果用户没有权限访问该智能体，显示"无权限访问此智能体"并提示联系管理员
    - **会话过期**：如果会话token过期，自动重新登录或提示用户重新登录

#### 主题切换按钮交互流程
1. **初始状态**：
   - 主题按钮显示当前主题对应的图标
   - 浅色主题：显示太阳图标
   - 深色主题：显示月亮图标
   - 按钮悬停时显示tooltip："切换主题"
   - 从localStorage读取保存的主题设置，键名为"theme"
   - 如果localStorage中没有保存的主题，默认使用浅色主题
2. **用户点击主题按钮**：
   - 触发click事件
   - 检查body元素的class列表
   - 判断当前主题类型
   - 如果body同时包含light-theme和dark-theme类，清除所有主题类，重新初始化
3. **主题类型判断**：
   - 如果body包含dark-theme类：当前为深色主题
   - 如果body包含light-theme类：当前为浅色主题
   - 如果body不包含任何主题类，默认识别为浅色主题并添加light-theme类
4. **确定新主题**：
   - 如果当前为浅色主题：新主题为深色主题
   - 如果当前为深色主题：新主题为浅色主题
5. **应用新主题**：
   - 调用setTheme函数
   - 传入新主题类型（'light'或'dark'）
   - 如果传入的主题类型不是'light'或'dark'，使用浅色主题作为默认值
6. **样式更新**（以切换到深色主题为例）：
   - 更新body背景和文字颜色：body.className = 'bg-gray-900 text-white h-screen overflow-hidden dark-theme'
   - 更新侧边栏样式：
     - 侧边栏背景：bg-gray-800
     - 边框：border-gray-700
     - 搜索框背景：bg-gray-700
     - 搜索框边框：border-gray-600
     - 搜索框文字：text-white
     - 分组头部背景：bg-gray-700/30
     - 分组标题文字：text-gray-200
     - 智能体项悬停：hover:bg-gray-700
   - 更新主内容区样式：
     - 主内容区背景：bg-gray-900
     - 顶部栏边框：border-gray-700
   - 更新聊天窗口样式：
     - 聊天窗口背景：bg-gray-900
     - 分割线：bg-gray-700
     - 智能助手消息气泡：bg-gray-800
     - 用户消息气泡：bg-blue-600
     - 输入区域背景：bg-gray-800
     - 输入框背景：bg-gray-700
     - 输入框文字：text-white
     - 按钮区域背景：bg-gray-700
     - 附件容器背景：bg-gray-700
     - 附件边框：border-gray-600
   - 更新欢迎页面样式：
     - 统计卡片背景：bg-gray-800
     - 统计数字颜色：text-blue-400、text-green-400、text-purple-400
     - 统计标签文字：text-gray-400
     - 描述文字：text-gray-400
   - 更新底部设置区域样式：
     - 边框：border-gray-700
     - 按钮悬停：hover:bg-gray-700
     - 按钮文字：text-gray-300
7. **图标更新**：
   - 更新主题按钮的SVG内容
   - 浅色主题：更新为太阳图标（太阳图标SVG路径）
   - 深色主题：更新为月亮图标（月亮图标SVG路径）
   - 图标颜色：浅色主题为text-gray-400，深色主题为text-gray-300
8. **数据保存**：
   - 将新主题保存到localStorage
   - 键名为"theme"
   - 值为"light"或"dark"
9. **即时反馈**：
   - 所有样式变化立即生效
   - 主题按钮图标立即更新

#### 设置按钮交互流程
1. **初始状态**：
   - 设置按钮显示齿轮图标
   - 设置按钮文本显示"设置"
   - 按钮悬停时显示tooltip："打开设置"
   - 按钮有未保存设置时，显示红色圆点提示
   - **设置加载失败处理**：如果设置数据加载失败，显示"设置加载失败，请刷新页面重试"错误提示
   - **权限检查**：检查用户是否有权限访问设置，无权限时禁用设置按钮并显示"无权限修改设置"
2. **用户点击设置按钮**：
   - 触发click事件
   - **点击反馈**：按钮显示按下效果（scale缩小至0.95）
   - **点击防抖**：使用300ms节流，防止快速连续点击
   - **重复打开检查**：如果设置面板已打开，直接聚焦到设置面板，不重复打开
   - 执行设置功能
3. **设置面板打开**：
   - 显示系统设置面板（具体设置功能根据需求实现）
   - 面板从右侧滑入（slide-in-right动画，0.3s）
   - 背景显示半透明遮罩（opacity 0.5）
   - 焦点自动定位到第一个设置项
   - 遮罩点击可关闭设置面板
   - **面板打开失败处理**：如果面板DOM不存在，记录错误日志并尝试重新创建面板
   - **动画异常处理**：如果动画执行失败，直接显示面板而不执行动画
   - **焦点定位失败处理**：如果焦点定位失败，记录警告日志但不影响面板打开
   - **内存限制**：同时只允许打开一个设置面板，如果已有面板打开，先关闭再打开新面板
4. **设置项交互**：
   - 显示系统配置选项
   - 用户可以在设置面板中修改系统参数
   - **实时预览**：部分设置项修改后立即显示预览效果（如字体大小、主题色）
   - **预览失败处理**：如果实时预览失败，静默忽略错误，不中断用户操作
   - **设置项禁用**：根据用户权限动态禁用不可修改的设置项，并显示禁用原因
   - **设置项缺失处理**：如果某个设置项的数据不存在，显示"该设置项不可用"并提供重新加载选项
   - **表单验证**：
     - 必填项标记为红色星号
     - 输入框失去焦点时进行验证
     - 验证失败显示红色边框和错误提示文字
     - 验证成功显示绿色边框
     - **验证异常处理**：如果验证逻辑执行失败，显示"验证失败，请稍后重试"并记录错误日志
     - **防抖验证**：使用500ms防抖，避免频繁验证导致性能问题
     - **邮箱验证**：验证邮箱格式，格式错误时显示"请输入有效的邮箱地址"
     - **URL验证**：验证URL格式，格式错误时显示"请输入有效的URL地址"
     - **数值范围验证**：如端口号（1-65535）、超时时间（100-60000ms）等，超出范围时显示具体错误提示
     - **字符限制**：文本输入框限制最大长度，超过后禁止输入并显示"超出最大长度限制"
     - **特殊字符过滤**：自动过滤SQL注入字符、XSS攻击字符等，显示"包含非法字符"
     - **重复值验证**：检查设置值是否重复（如API密钥、端口号等），重复时显示"该值已存在"
5. **设置保存**：
   - 用户点击"保存"按钮：
     - **保存防抖**：使用500ms节流，防止快速连续点击
     - 执行全局验证，检查所有设置项
     - 如果验证失败：
       - 高亮第一个错误项
       - 显示"请修正错误后再保存"提示
       - 滚动到错误项位置
       - 禁用保存按钮直到错误修正
       - **验证失败统计**：显示"共X个错误，请修正后再保存"详细错误统计
     - 如果验证成功：
       - 显示保存进度条（从0%到100%，0.5s）
       - 保存按钮显示加载指示器
       - 禁用保存按钮和关闭按钮
       - 将设置内容保存到相应存储位置
       - **保存超时处理**：如果保存超过10秒未完成，显示"保存超时，请重试"并中断保存
       - **保存进度异常处理**：如果进度条更新失败，继续保存操作但显示"正在保存..."静态提示
       - 保存成功后显示"设置已保存"提示框（持续2秒）
       - 按钮恢复正常状态
       - 移除未保存提示红点
       - **应用设置**：保存成功后自动应用新设置，应用失败时显示"设置已保存但应用失败，请重启应用"
   - 保存失败处理：
     - 显示错误提示："保存失败，请重试"
     - 提供"重试"和"取消"选项
     - 错误信息记录到系统日志
     - 保留当前设置面板，允许用户重试
     - **重试限制**：最多允许用户手动重试3次，超过后禁用重试按钮
     - **自动重试**：网络错误时自动重试1次，间隔2秒
     - **部分失败处理**：如果部分设置保存成功，显示"部分设置保存失败，请重试"并列出失败项
     - **冲突处理**：如果服务器返回版本冲突，显示"设置已被其他设备修改，请刷新后重试"
     - **localStorage异常**：如果localStorage不可用或已满，显示"本地存储不可用，请检查浏览器设置"
6. **设置重置**：
   - 提供"恢复默认"按钮
   - 点击后显示确认对话框："确定要恢复默认设置吗？此操作不可撤销"
   - **默认值加载失败处理**：如果默认值加载失败，显示"默认设置加载失败，请重试"
   - 确认后：
     - 加载默认设置值
     - 显示"已恢复默认设置"提示
     - 标记为未保存状态
     - **设置冲突处理**：如果默认值与当前设置冲突，提示用户并允许选择性恢复
   - 取消后关闭确认对话框
   - **重置限制**：提供"部分重置"选项，允许用户选择要重置的设置项
7. **设置关闭**：
   - 用户点击关闭按钮或遮罩：
     - **关闭防抖**：使用300ms节流，防止快速连续点击
     - 检查是否有未保存的更改
     - 如果有未保存更改：
       - 显示确认对话框："您有未保存的更改，确定要关闭吗？"
       - 提供"保存并关闭"、"不保存关闭"、"取消"三个选项
       - **更改详情**：在确认对话框中列出所有未保存的更改，方便用户确认
       - **自动保存选项**：提供"自动保存并关闭"选项，跳过验证直接保存
     - 如果没有未保存更改：
       - 直接关闭设置面板
       - 面板滑出动画（slide-out-right，0.3s）
       - 遮罩淡出动画（0.3s）
   - **面板关闭异常处理**：如果面板关闭失败，强制移除DOM元素并记录错误日志
   - **焦点恢复**：关闭后焦点自动恢复到设置按钮
8. **快捷键支持**：
   - Ctrl/Cmd + ,：快速打开设置面板
   - Esc：关闭设置面板（如果有未保存更改则显示确认对话框）
   - Ctrl/Cmd + S：在设置面板中保存设置
   - **快捷键冲突处理**：如果浏览器或其他插件已占用快捷键，提供替代方案或提示用户
   - **快捷键禁用状态**：在输入框中输入或模态框打开时，禁用设置相关快捷键
   - **快捷键防抖**：使用300ms节流，防止快速连续触发
   - **焦点丢失处理**：如果设置面板失去焦点，5秒后自动显示"您有未保存的更改"提示
9. **数据持久化**：
   - 设置自动保存到localStorage或配置文件
   - 下次打开应用时自动加载保存的设置
   - **加载失败处理**：如果设置加载失败，使用默认设置并显示"已加载默认设置"
   - **数据损坏处理**：如果设置数据格式错误，删除损坏数据并加载默认设置
   - **版本兼容性检查**：检查设置数据版本，版本不兼容时自动迁移或提示用户
   - 提供导入/导出设置功能（JSON格式）
   - **导出失败处理**：如果导出失败，显示"导出失败，请重试"并提供详细错误信息
   - **导出文件大小限制**：如果导出文件超过10MB，提示用户"文件过大，建议分批导出"
   - **导入失败处理**：导入时验证设置格式，格式错误时提示用户并提供错误详情
   - **导入冲突处理**：如果导入的设置与现有设置冲突，提示用户选择覆盖或合并
   - **导入安全检查**：验证导入文件是否包含恶意代码，发现异常时拒绝导入并警告用户
   - **导入备份**：导入前自动备份当前设置，导入失败时可恢复
   - **增量同步**：提供设置云同步功能，支持多设备间设置同步
   - **同步冲突处理**：多设备同时修改时，提供冲突解决策略（最新修改优先、手动选择等）
   - **同步失败处理**：同步失败时显示"同步失败，稍后将自动重试"并在后台重试3次
   - **离线模式**：离线时保存设置到本地，联网后自动同步到云端
10. **特殊场景处理**：
    - **权限变更**：如果用户权限变更，动态更新可修改的设置项
    - **设置锁定**：管理员可锁定某些设置项，锁定后用户无法修改
    - **批量操作**：支持批量导入/导出设置，批量操作失败时显示详细失败列表
    - **设置依赖**：某些设置项存在依赖关系，修改父项时自动更新子项
    - **设置验证规则**：复杂的验证规则（如正则表达式、自定义函数），验证失败时显示具体错误
    - **设置预览限制**：性能敏感的设置项（如动画、特效）不提供实时预览，只在保存后生效
    - **设置回滚**：提供"撤销上一次保存"功能，最多支持撤销10次
    - **设置对比**：提供设置对比功能，显示当前设置与默认设置的差异
    - **设置搜索**：提供设置项搜索功能，快速定位到目标设置项

#### 侧边栏收缩交互流程
1. **初始状态**：
   - 侧边栏宽度为320像素（w-80）
   - 侧边栏显示完整内容
   - 侧边栏收缩按钮在侧边栏右侧边缘
   - 收缩按钮悬停时显示tooltip："收起侧边栏"（展开时）/ "展开侧边栏"（收缩时）
   - **状态加载失败处理**：如果localStorage中的侧边栏状态数据损坏，使用默认展开状态
   - **按钮不存在处理**：如果收缩按钮DOM不存在，记录错误日志并尝试重新创建按钮
2. **用户点击收缩按钮**：
   - 触发click事件
   - **点击反馈**：按钮显示按下效果（scale缩小至0.95）
   - **点击防抖**：使用300ms节流，防止快速连续点击
   - **点击区域验证**：验证点击事件来源，确保是用户主动点击而非脚本触发
   - 切换侧边栏的sidebar-collapsed类
   - 禁用按钮点击（防止动画过程中重复点击）
   - **重复点击处理**：如果用户在动画执行期间点击，忽略后续点击直到动画完成
   - **状态冲突处理**：如果检测到sidebar-collapsed类状态异常，清除所有状态类，重新初始化
3. **收缩状态变化**：
   - 如果当前为展开状态：
     - 添加sidebar-collapsed类
     - 侧边栏宽度从320px过渡到60px
     - **内容渐隐**：文本内容opacity从1过渡到0（0.2s）
     - **按钮旋转**：收缩按钮图标旋转180度（0.3s）
     - **宽度异常处理**：如果侧边栏宽度无法正确设置，使用强制宽度并记录警告日志
     - **焦点转移**：收缩时如果焦点在侧边栏内，自动转移焦点到主内容区
   - 如果当前为收缩状态：
     - 移除sidebar-collapsed类
     - 侧边栏宽度从60px过渡到320px
     - **内容渐显**：文本内容opacity从0过渡到1（0.2s，延迟0.1s）
     - **按钮旋转**：收缩按钮图标旋转回0度（0.3s）
     - **展开延迟**：延迟显示内容，避免动画未完成时内容闪烁
     - **焦点恢复**：展开时如果之前焦点在侧边栏内，恢复焦点位置
   - **动画中断处理**：如果用户在动画执行期间再次点击，立即中断当前动画
   - **动画异常处理**：如果动画执行失败，直接更新DOM状态而不执行动画
   - **状态同步**：确保侧边栏类、宽度、按钮图标状态一致
4. **内容隐藏/显示**：
   - 搜索框容器隐藏（收缩时）/ 显示（展开时）
   - 分组头部文本隐藏（收缩时）/ 显示（展开时）
   - 分组头部背景色隐藏（收缩时）/ 显示（展开时）
   - 智能体项的flex-1部分隐藏（收缩时）/ 显示（展开时）
   - 智能体项的删除按钮隐藏（收缩时）/ 显示（展开时）
   - 底部设置区域的文本隐藏（收缩时）/ 显示（展开时）
   - **隐藏动画**：元素先缩小再隐藏（scale 1→0，然后display none）
   - **显示动画**：元素先显示再放大（display block，然后scale 0→1）
   - **元素不存在处理**：如果某个元素不存在，跳过该元素继续处理其他元素
   - **批量操作优化**：使用批量DOM操作提升性能，避免多次重排
   - **事件清理**：隐藏元素时清理相关事件监听器，避免内存泄漏
5. **布局调整**：
   - 分组头部内容居中显示（收缩时）
   - 智能体项内容居中显示（收缩时）
   - 底部按钮变为竖向排列（收缩时）/ 横向排列（展开时）
   - 底部按钮间距调整为8像素（收缩时）/ 默认间距（展开时）
   - 底部按钮变为方形（40x40像素，收缩时）/ 默认尺寸（展开时）
   - 底部按钮文本隐藏（收缩时）/ 显示（展开时）
   - **布局计算异常处理**：如果布局计算失败，使用固定布局作为回退方案
   - **滚动条处理**：收缩时隐藏侧边栏滚动条，展开时恢复
   - **内容溢出处理**：如果内容在收缩状态下溢出，自动隐藏溢出内容并显示省略号
6. **提示框显示**：
   - 收缩状态下，悬停按钮显示提示框
   - 提示框在按钮左侧显示
   - 提示框内容为按钮功能说明（如"搜索"、"设置"、"切换主题"）
   - **提示框动画**：fade-in效果，持续0.2s
   - **提示框延迟**：悬停0.5秒后显示（避免快速移动鼠标时频繁显示）
   - **提示框消失**：鼠标移开后0.3秒消失
   - **提示框边界处理**：如果提示框超出视口边界，自动调整位置
   - **提示框创建失败**：如果提示框创建失败，静默忽略错误
   - **提示框防抖**：使用200ms防抖，避免快速移动鼠标时频繁创建销毁提示框
7. **动画效果**：
   - 过渡时间为0.3秒
   - 过渡效果为ease-in-out
   - 所有变化都有平滑过渡
   - **缓动曲线**：使用贝塞尔曲线cubic-bezier(0.4, 0, 0.2, 1)实现更自然的动画效果
   - **主内容区响应**：侧边栏收缩时，主内容区宽度自动调整（flex-grow）
   - **动画禁用**：如果用户启用了"减少动画"系统设置，禁用所有侧边栏动画
   - **性能优化**：使用CSS transform和opacity属性优化动画性能
   - **动画降级**：如果浏览器不支持CSS过渡，直接更新DOM状态
   - **动画帧丢失处理**：如果检测到动画帧丢失，降低动画复杂度
8. **响应式行为**：
   - 用户可以随时点击收缩按钮切换状态
   - 切换不影响智能体的选择和对话功能
   - **状态记忆**：记住用户最后的收缩状态，下次打开应用时恢复
   - **状态保存**：将收缩状态保存到localStorage，键名为"sidebarCollapsed"
   - **状态保存失败处理**：如果localStorage保存失败，静默失败，不影响收缩功能
   - **状态恢复**：刷新页面后自动恢复收缩状态
   - **状态恢复失败处理**：如果保存的状态无效，使用默认展开状态
   - **状态不一致处理**：如果localStorage中的状态与实际DOM状态不一致，以DOM状态为准
9. **快捷键支持**：
   - Ctrl/Cmd + [ 或 Ctrl/Cmd + ]：收起/展开侧边栏
   - 快捷键触发时显示"侧边栏已收起"/"侧边栏已展开"提示
   - **快捷键冲突处理**：如果浏览器或其他插件已占用快捷键，提供替代方案或提示用户
   - **快捷键禁用状态**：在输入框中输入或模态框打开时，禁用侧边栏快捷键
   - **快捷键防抖**：使用300ms节流，防止快速连续触发
   - **快捷键焦点管理**：使用快捷键时，自动将焦点移到侧边栏
10. **触摸屏支持**：
    - 在触摸屏设备上，支持左右滑动手势收起/展开侧边栏
    - 从左边缘向右滑动：展开侧边栏
    - 从左边缘向左滑动：收起侧边栏
    - 滑动距离超过50px时触发动作
    - 提供视觉反馈（半透明侧边栏预览）
    - **手势识别失败**：如果手势识别失败，回退到按钮点击方式
    - **手势冲突处理**：如果手势与浏览器原生手势冲突，优先使用原生手势
    - **多点触控处理**：如果检测到多点触控，禁用手势功能避免误操作
    - **手势防抖**：使用100ms防抖，避免快速滑动时频繁触发
11. **响应式断点**：
    - 屏幕宽度小于768px时，侧边栏默认收缩
    - 屏幕宽度大于768px时，恢复用户之前的收缩状态
    - 响应式切换时显示过渡动画
    - **断点切换异常处理**：如果断点切换失败，强制更新DOM状态
    - **断点监听失败处理**：如果媒体查询监听失败，使用resize事件作为回退方案
    - **断点状态冲突**：如果响应式状态与用户手动设置的状态冲突，优先使用响应式状态
    - **断点切换防抖**：使用200ms防抖，避免窗口快速调整大小时频繁触发
12. **错误处理**：
    - 如果localStorage保存失败：
      - 在控制台记录警告信息
      - 不影响侧边栏收缩功能
      - 下次打开时使用默认展开状态
    - 如果动画执行异常：
      - 强制更新DOM状态
      - 确保UI始终可用
    - **DOM操作异常处理**：捕获所有DOM操作异常，记录错误日志并尝试恢复
    - **状态不一致处理**：定期检查侧边栏状态一致性，发现异常时自动修复
    - **内存泄漏检查**：监控侧边栏相关事件监听器，避免内存泄漏
    - **性能降级**：如果检测到设备性能较差，禁用动画并简化交互
13. **无障碍支持**：
    - 收缩按钮添加aria-label属性，说明当前状态（"收起侧边栏"/"展开侧边栏"）
    - 使用ARIA状态属性aria-expanded指示当前展开/收缩状态
    - 支持键盘Tab键导航收缩按钮
    - 支持Enter或Space键触发收缩动作
    - **焦点可见性**：确保按钮在所有状态下都可见且可聚焦
    - **屏幕阅读器支持**：提供详细的ARIA描述，方便屏幕阅读器理解
    - **焦点陷阱**：侧边栏展开时，将焦点限制在侧边栏内，直到用户按Esc键
    - **焦点顺序**：确保键盘焦点顺序符合逻辑，从上到下、从左到右
14. **特殊场景处理**：
    - **最小宽度限制**：侧边栏最小宽度设置为60px，避免完全消失导致无法展开
    - **最大宽度限制**：侧边栏最大宽度设置为400px，避免占用过多屏幕空间
    - **自定义宽度**：支持用户拖拽调整侧边栏宽度，拖拽时显示当前宽度提示
    - **宽度持久化**：将用户自定义的宽度保存到localStorage，刷新后恢复
    - **固定模式**：提供"固定侧边栏"选项，固定后无法收缩，适合大屏设备
    - **自动隐藏**：提供"鼠标离开自动隐藏"选项，鼠标离开侧边栏3秒后自动收缩
    - **全屏模式**：全屏模式下自动收缩侧边栏，退出全屏后恢复原状态
    - **多显示器支持**：在多显示器环境下，每个显示器独立保存侧边栏状态
    - **嵌入模式**：如果应用嵌入到iframe中，自动收缩侧边栏以节省空间
### 2.1.4 视觉设计要求

#### 整体布局设计
- **布局结构**：Flexbox弹性布局
- **侧边栏定位**：左侧固定区域，宽度320px
- **主内容区**：右侧弹性区域，占满剩余空间
- **响应式断点**：根据屏幕宽度自适应调整
- **滚动条设计**：自定义滚动条样式，细滚动条（6px宽）

#### 侧边栏视觉设计
- **容器尺寸**：
  - 展开状态：宽度320px（w-80）
  - 收缩状态：宽度60px
  - 高度：100vh，占满整个视口高度
- **背景色**：
  - 浅色主题：纯白色背景（bg-white）
  - 深色主题：深灰色背景（bg-gray-800）
- **边框设计**：
  - 浅色主题：右侧灰色边框（border-r border-gray-300）
  - 深色主题：右侧深灰色边框（border-r border-gray-700）
- **圆角设计**：无圆角，直角边框
- **阴影设计**：无阴影，扁平化设计

#### 搜索框视觉设计
- **容器设计**：
  - 内边距：上下左右各16px（p-4）
  - 底部边框：1px灰色边框（border-b）
  - 边框颜色：浅色主题border-gray-200，深色主题border-gray-700
- **输入框样式**：
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-700
  - 文字颜色：浅色主题text-gray-900，深色主题text-white
  - 占位符颜色：浅色主题placeholder-gray-400，深色主题placeholder-gray-400
  - 圆角：圆角8px（rounded-lg）
  - 内边距：水平40px，垂直8px（px-4 py-2），左侧留10px给图标
  - 边框：浅色主题border border-gray-200，深色主题无边框
  - 焦点效果：2px蓝色圆环（focus:ring-2 focus:ring-blue-500）
- **搜索图标**：
  - 位置：绝对定位，左侧10px，垂直居中
  - 尺寸：20x20px（w-5 h-5）
  - 颜色：灰色（text-gray-400）
  - 图标类型：放大镜SVG图标

#### 分组头部视觉设计
- **容器设计**：
  - 内边距：上下12px，左右16px（px-4 py-3）
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-700/30
  - 边框设计：左侧3px透明边框（border-l-3 border-transparent）
  - 圆角：无圆角
- **布局方式**：Flexbox水平排列，两端对齐
- **分组标题**：
  - 字体大小：14px（text-sm）
  - 字体粗细：粗体（font-semibold）
  - 颜色：浅色主题text-gray-700，深色主题text-gray-200
  - 间距：与箭头图标间距12px（gap-3）
- **箭头图标**：
  - 尺寸：20x20px（w-5 h-5）
  - 颜色：灰色（text-gray-400）
  - 图标类型：向下箭头SVG图标
  - 过渡效果：transform 0.3s ease
  - 收缩状态：旋转-90度

#### 智能体项视觉设计
- **容器设计**：
  - 外边距：上下4px，左右8px（mx-2）
  - 内边距：上下8px，左右12px（px-3 py-2）
  - 圆角：圆角8px（rounded-lg）
  - 间距：智能体项之间间距4px（space-y-1）
  - 过渡效果：all 0.2s ease
- **背景色**：
  - 默认状态：无背景
  - 悬停状态：浅色主题hover:bg-gray-200，深色主题hover:bg-gray-700
  - 选中状态：浅色主题渐变bg-gradient-to-r from-e0e7ff to-dbeafe，深色主题渐变bg-gradient-to-r from-2563eb to-3b82f6
- **布局方式**：Flexbox水平排列
- **智能体头像**：
  - 容器尺寸：48x48px（w-12 h-12）
  - 圆形设计：完全圆角（rounded-full）
  - 渐变背景：根据avatar类型设置
    - 蓝色：from-blue-400 to-blue-600
    - 紫色：from-purple-400 to-purple-600
    - 橙色：from-orange-400 to-orange-600
  - 相对定位：相对定位
  - 图标尺寸：28x28px（w-7 h-7）
  - 图标颜色：白色（text-white）
- **在线状态指示器**：
  - 尺寸：12x12px（w-3 h-3）
  - 圆形设计：完全圆角（rounded-full）
  - 背景色：绿色（bg-green-500）
  - 边框：2px白色边框（border-2 border-white）
  - 定位：绝对定位，右下角
- **智能体信息区**：
  - 布局：垂直排列，占用剩余空间（flex-1）
  - 最小宽度：0，允许文本截断（min-w-0）
- **智能体名称**：
  - 字体大小：14px（text-sm）
  - 字体粗细：粗体（font-medium）
  - 颜色：继承父元素
  - 截断处理：超出部分用省略号（truncate）
- **在线状态标签**：
  - 字体大小：12px（text-xs）
  - 颜色：绿色（text-green-400）
  - 与名称间距：8px（gap-2）
- **智能体描述**：
  - 字体大小：12px（text-xs）
  - 颜色：灰色（text-gray-400）
  - 截断处理：超出部分用省略号（truncate）

#### 底部操作区视觉设计
- **容器设计**：
  - 内边距：上下左右各16px（p-4）
  - 顶部边框：1px灰色边框（border-t）
  - 边框颜色：浅色主题border-gray-200，深色主题border-gray-700
  - 布局方式：Flexbox水平排列，两端对齐
- **按钮组布局**：
  - 间距：按钮之间间距8px（gap-2）
  - 布局方式：Flexbox水平排列
- **按钮设计**：
  - 容器设计：
    - 内边距：上下8px，左右12px（px-3 py-2）
    - 圆角：圆角8px（rounded-lg）
    - 过渡效果：transition-colors
    - 布局方式：Flexbox水平排列
  - 悬停背景：浅色主题hover:bg-gray-200，深色主题hover:bg-gray-700
  - 图标尺寸：16x16px（w-4 h-4）
  - 图标颜色：浅色主题text-gray-400，深色主题text-gray-300
  - 文本设计：
    - 字体大小：14px（text-sm）
    - 颜色：浅色主题text-gray-600，深色主题text-gray-300
    - 间距：与图标间距8px（gap-2）
- **状态信息区**：
  - 布局方式：Flexbox水平排列
  - 间距：元素之间间距16px（gap-4）
- **在线状态指示器**：
  - 圆点尺寸：8x8px（w-2 h-2）
  - 圆形设计：完全圆角（rounded-full）
  - 背景色：绿色（bg-green-500）
  - 文本设计：
    - 字体大小：12px（text-xs）
    - 颜色：灰色（text-gray-500）
    - 间距：与圆点间距4px（gap-1）
- **版本信息**：
  - 字体大小：12px（text-xs）
  - 颜色：灰色（text-gray-500）

#### 侧边栏收缩按钮视觉设计
- **位置设计**：
  - 绝对定位：right: -6px, top: 33.33%
  - 尺寸：12x40px
  - 圆角：6px
  - 背景色：灰色（bg-gray-600）
  - 边框：1px深灰色边框（border border-gray-700）
  - 光标：指针（cursor: pointer）
  - 过渡效果：all 0.3s ease
  - z-index：10，确保在最上层
- **悬停效果**：
  - 尺寸变化：宽度从12px扩展到16px
  - 高度变化：高度从40px扩展到60px
  - 右边距变化：从-6px调整到-8px
  - 背景色变化：变为浅灰色（bg-gray-800）
- **图标设计**：
  - 使用伪元素::before创建
  - 尺寸：默认4x16px
  - 悬停尺寸：6x24px
  - 背景色：浅灰色（bg-gray-500）
  - 圆角：2px

#### 提示框视觉设计
- **容器设计**：
  - 相对定位容器（tooltip-container）
  - 定位方式：相对定位
- **提示框设计**：
  - 绝对定位（tooltip）
  - 位置：右侧100%，垂直居中
  - 变换：translateY(-50%)，垂直居中
  - 外边距：右侧8px（margin-right: 8px）
  - 背景色：深灰色（bg-gray-800）
  - 文字颜色：白色（text-white）
  - 内边距：上下4px，左右8px（px-1 py-2）
  - 圆角：4px
  - 字体大小：12px（text-xs）
  - 边框：1px深灰色边框（border border-gray-700）
  - 过渡效果：all 0.3s ease
  - z-index：1000，确保在所有元素之上
  - 透明度：默认0，visibility: hidden
  - 显示条件：侧边栏收缩且悬停时opacity: 1, visibility: visible
- **箭头设计**：
  - 使用伪元素::after创建
  - 位置：绝对定位，left: 100%, top: 50%
  - 变换：translateY(-50%)
  - 边框样式：8px实线边框，颜色透明
  - 边框颜色：与提示框背景色相同（border-color: transparent transparent transparent transparent #1f2937）
- **侧边栏收缩时提示框位置调整**：
  - 位置：左侧100%（left: 100%）
  - 外边距：左侧8px（margin-left: 8px）
  - 箭头方向：右侧箭头（border-color: transparent transparent transparent #1f2937）

#### 配色方案
- **浅色主题配色**：
  - 主背景色：白色（#ffffff）
  - 次要背景色：浅灰色（#f3f4f6）
  - 深色背景色：深灰色（#e5e7eb）
  - 边框色：灰色（#d1d5db）
  - 主要文字色：深灰色（#111827）
  - 次要文字色：灰色（#4b5563）
  - 辅助文字色：灰色（#9ca3af）
  - 蓝色：#3b82f6（主色）、#2563eb（深色）
  - 绿色：#10b981（主色）、#059669（深色）
  - 紫色：#8b5cf6（主色）、#7c3aed（深色）
  - 橙色：#f97316（主色）、#ea580c（深色）
  - 红色：#ef4444（状态）、#dc2626（深色）
- **深色主题配色**：
  - 主背景色：深灰色（#111827）
  - 次要背景色：深灰色（#1f2937）
  - 深色背景色：深灰色（#374151）
  - 边框色：深灰色（#374151）
  - 主要文字色：白色（#ffffff）
  - 次要文字色：浅灰色（#d1d5db）
  - 辅助文字色：浅灰色（#9ca3af）
  - 蓝色：#3b82f6（主色）、#2563eb（浅色）
  - 绿色：#10b981（主色）、#059669（浅色）
  - 紫色：#8b5cf6（主色）、#7c3aed（浅色）
  - 橙色：#f97316（主色）、#ea580c（浅色）

#### 字体系统
- **主字体**：系统默认无衬线字体（sans-serif）
- **字体大小体系**：
  - 超大号：text-2xl（24px）
  - 大号：text-xl（20px）
  - 中号：text-lg（18px）
  - 标准号：text-base（16px）
  - 小号：text-sm（14px）
  - 超小号：text-xs（12px）
- **字体粗细**：
  - 粗体：font-bold
  - 半粗体：font-semibold
  - 中等：font-medium
  - 正常：font-normal
- **字体样式**：无斜体，无装饰线

#### 间距系统
- **间距单位**：使用4px基准单位
- **内边距体系**：
  - p-1：4px
  - p-2：8px
  - p-3：12px
  - p-4：16px
  - p-6：24px
- **外边距体系**：
  - m-1：4px
  - m-2：8px
  - m-3：12px
  - m-4：16px
- **间距应用**：保持一致的间距节奏

#### 阴影系统
- **阴影强度**：
  - 无阴影：shadow-none
  - 轻微阴影：shadow-sm（小阴影）
  - 中等阴影：shadow-md
  - 大阴影：shadow-lg
  - 超大阴影：shadow-xl
- **阴影颜色**：浅色主题浅灰色阴影，深色主题深色阴影
- **阴影应用**：仅在需要强调的元素上使用阴影

#### 过渡动画
- **过渡属性**：transition-all或transition-colors
- **过渡时间**：
  - 快速：0.1s
  - 标准：0.2s
  - 缓慢：0.3s
- **过渡效果**：ease（缓动函数）
- **过渡应用**：所有交互元素都有平滑过渡效果

#### 可访问性设计
- **对比度**：符合WCAG 2.1标准，对比度至少4.5:1
- **焦点状态**：所有可交互元素都有明显的焦点指示器
- **键盘导航**：支持Tab键导航
- **屏幕阅读器**：使用语义化HTML标签
- **文字缩放**：支持浏览器文字缩放功能（200%）
- **触摸目标**：触摸目标至少44x44px，符合移动端标准

#### 响应式设计
- **桌面端**：侧边栏固定320px宽度
- **平板端**：侧边栏可能自动收缩或调整
- **移动端**：侧边栏默认收缩状态
- **断点设计**：根据屏幕宽度自动调整布局
- **弹性布局**：使用Flexbox和Grid实现弹性布局

## 2.2 智能体对话
### 2.2.1参考原型设计页面
    MainLayout.html
### 2.2.2 功能流程

#### 对话界面头部
- **智能体头像**：圆形渐变背景，显示智能体图标（10x10像素）
- **智能体名称**：文本显示，大号字体
- **状态显示**：显示"在线"状态
- **用户信息**：显示"欢迎回来，用户"和用户头像

#### 消息显示区
- **时间分割线**：水平线条+时间标签（如"今天"）
- **用户消息**：
  - 背景色：蓝色背景（浅色主题）/ 深蓝色背景（深色主题）
  - 消息内容：文本，小号字体
  - 发送时间：右对齐，小号灰色字体
  - 最大宽度：限制宽度，避免过宽
- **智能体消息**：
  - 背景色：灰色背景（浅色主题）/ 深灰色背景（深色主题）
  - 头像：圆形渐变背景，显示智能体图标（8x8像素）
  - 消息内容：文本，小号字体
  - 发送时间：左对齐，小号灰色字体
  - 最大宽度：限制宽度，避免过宽
- **滚动特性**：支持垂直滚动，显示滚动条

#### 输入区域
- **消息输入框**：
  - 类型：textarea多行文本输入
  - 占位符："输入消息..."
  - 最小高度：100像素
  - 最大高度：300像素
  - 自动调整高度：根据内容自动调整
  - 支持粘贴：支持粘贴文本内容
- **附件功能**：
  - 附件按钮：回形针图标按钮，点击打开文件选择器
  - 文件类型：支持多文件选择
  - 附件显示：圆形背景，显示文件预览或文件图标
  - 文件大小：显示文件大小信息
  - 删除功能：每个附件有删除按钮
  - 容器：支持横向排列多个附件

#### 操作按钮
- **发送按钮**：
  - 图标：纸飞机图标（7x7像素）
  - 默认状态：灰色，禁用状态
  - 激活状态：蓝色，可点击
  - 禁用条件：输入框为空时禁用
  - 点击效果：发送消息，清空输入框
- **附件按钮**：
  - 图标：回形针图标（6x6像素）
  - 默认状态：灰色
  - 悬停状态：深灰色
  - 点击效果：打开文件选择器

#### 交互特性
- **主题切换**：支持浅色/深色主题切换
  - 浅色主题：白色背景，灰色文字
  - 深色主题：深灰色背景，白色文字
- **响应式设计**：根据屏幕大小自动调整布局
- **动画效果**：按钮悬停、消息发送等有过渡动画
- **数据持久化**：主题设置保存到localStorage
### 2.2.3 交互流程

#### 消息输入框交互流程
1. **初始状态**：
   - 输入框显示placeholder"输入消息..."
   - 输入框高度为100像素（最小高度）
   - 输入框内容为空
   - 发送按钮为禁用状态（灰色）
   - **自动聚焦**：智能体切换完成后，输入框自动获得焦点，光标闪烁提示用户可以输入
   - **占位符提示**：根据上下文动态显示占位符，如"输入消息..."、"继续输入..."、"描述您的问题..."
   - **快捷键提示**：在输入框右下角显示"Enter发送，Shift+Enter换行"的小字提示，首次使用3秒后淡出
2. **用户输入文本**：
   - 触发input事件
   - 监听输入框的内容变化
   - 调用adjustTextareaHeight函数
   - **实时字数统计**：在输入框右下角显示字数统计"已输入X字"，超过500字时显示红色警告
   - **智能提示**：输入超过10个字符后，显示"输入中..."的微动画指示器（三个点依次闪烁）
   - **输入防抖**：输入停止500ms后自动保存草稿到localStorage，防止意外丢失
   - **草稿恢复**：页面加载时自动检查并恢复上次未发送的草稿内容，显示"已恢复草稿"提示（3秒后消失）
3. **高度自动调整**：
   - 将输入框高度设置为auto
   - 获取输入框的scrollHeight（内容的实际高度）
   - 判断scrollHeight与最小高度（100px）和最大高度（300px）的关系：
     - 如果scrollHeight < 100px：高度设置为100px
     - 如果scrollHeight > 300px：高度设置为300px
     - 如果100px ≤ scrollHeight ≤ 300px：高度设置为scrollHeight
   - 输入框平滑过渡到新高度（transition: height 0.2s ease）
   - **高度限制提示**：当达到最大高度300px时，输入框内部显示"已达到最大高度，内容可继续输入"的淡色提示
   - **平滑过渡**：高度变化使用贝塞尔曲线cubic-bezier(0.4, 0, 0.2, 1)，避免突兀的跳跃感
   - **响应式调整**：高度变化时，输入区域布局自动重新计算，确保界面不抖动
4. **发送按钮状态更新**：
   - 检查输入框内容是否为空
   - 如果为空：发送按钮保持禁用状态（灰色）
   - 如果不为空：发送按钮启用（蓝色）
   - **按钮动画**：从禁用到启用状态有渐变动画（opacity 0.3→1，scale 0.95→1，持续0.2s）
   - **触觉反馈**：启用按钮时，显示"可以发送了"的微动画提示（按钮轻微放大0.95→1.05→1，持续0.3s）
   - **快捷键状态**：当有内容时，Enter键发送提示高亮显示，提示用户可以快速发送
5. **用户粘贴内容**：
   - 触发paste事件
   - 延迟执行高度调整（setTimeout，0ms）
   - 确保粘贴内容插入后再调整高度
   - 自动调整到合适的高度
   - **粘贴反馈**：粘贴成功时显示"已粘贴X个字符"的临时提示，持续1秒后淡出
   - **大内容警告**：粘贴内容超过2000字时，显示"内容较长，建议分段发送"的警告提示
   - **格式保留**：自动检测并提示用户是否保留原文格式（代码块、链接、列表等），3秒内可点击"保留格式"按钮
   - **图片粘贴支持**：检测到剪贴板中有图片时，自动创建图片预览，显示"是否将图片作为附件发送？"的确认对话框
   - **粘贴历史**：记录最近5次粘贴内容，按Ctrl+Shift+V可快速粘贴历史内容
6. **文本输入完成**：
   - 用户完成消息输入
   - 可以点击发送按钮发送消息
   - **自动保存**：输入完成后自动保存到草稿，标记为"待发送"
   - **输入建议**：如果输入内容过短（少于3个字），显示"输入内容太短，建议补充细节"的提示
   - **预览功能**：鼠标悬停在输入框边缘时，显示"预览消息"按钮，点击可预览发送后的消息样式
   - **敏感词检测**：实时检测敏感词汇，发现时显示"检测到敏感内容，建议修改"的警告
7. **异常处理**：
   - **输入框异常**：当输入框无法获取焦点时，显示"输入框异常，请刷新页面重试"的错误提示
   - **高度计算异常**：当高度计算失败时，强制重置为最小高度，并在控制台记录错误
   - **内容丢失防护**：页面刷新前检查是否有未发送内容，显示"有未发送的消息，确定要离开吗？"的确认对话框
   - **自动恢复**：当输入框意外清空时，自动尝试从localStorage恢复最近的内容，显示"已自动恢复内容"的提示
8. **性能优化**：
   - **输入节流**：高度调整函数使用节流（throttle），限制每100ms最多执行一次
   - **虚拟滚动**：当输入内容超过1000行时，启用虚拟滚动优化性能
   - **内存管理**：定期清理超过24小时的草稿数据，避免localStorage溢出

#### 发送按钮交互流程
1. **初始状态**：
   - 发送按钮显示纸飞机图标
   - 按钮为禁用状态（灰色）
   - 禁用状态下不可点击
   - **禁用提示**：鼠标悬停在禁用按钮上时，显示tooltip"请输入消息后发送"（延迟0.5秒后显示）
   - **按钮位置**：按钮始终固定在输入框右侧边缘，确保用户视线自然聚焦
   - **视觉层次**：禁用按钮使用50%透明度，启用按钮使用100%不透明度，清晰区分状态
2. **输入内容验证**：
   - 用户在输入框中输入内容
   - 系统实时检查输入框内容
   - 如果输入框内容为空：按钮保持禁用
   - 如果输入框内容不为空：按钮启用（蓝色）
   - **验证动画**：从禁用到启用状态有渐变动画（opacity 0.5→1，scale 1→1.05→1，持续0.3s ease）
   - **声音反馈**：按钮启用时播放轻微的"叮"声效（仅在首次启用时播放，避免打扰）
   - **颜色过渡**：按钮颜色从灰色（#9CA3AF）过渡到蓝色（#3B82F6），使用transition-colors 0.2s ease
3. **用户点击发送按钮**：
   - 触发click事件
   - 检查按钮是否为禁用状态
   - 如果禁用：不执行任何操作，显示抖动动画（shake效果，0.3s）提示用户需要输入内容
   - 如果启用：执行发送操作
   - **点击反馈**：按钮显示按下效果（scale缩小至0.95），同时播放点击音效
   - **禁用重复点击**：点击后立即禁用按钮，防止重复发送，按钮显示加载指示器
   - **加载动画**：按钮图标从纸飞机变为旋转的圆环动画（持续0.5-2s，直到发送完成）
4. **消息发送**：
   - 获取输入框中的文本内容
   - 获取附件列表（如果有）
   - **内容验证**：检查消息内容是否包含敏感词，如果包含显示"消息包含敏感内容，是否继续发送？"的确认对话框
   - **附件验证**：检查附件是否超过大小限制（单个文件10MB），如果超过显示"文件过大，无法发送"的错误提示
   - **附件数量限制**：检查附件数量是否超过限制（最多10个），如果超过显示"附件数量过多，请删除部分附件"的警告
   - **创建用户消息元素**：
     - 背景色：蓝色（浅色主题）或深蓝色（深色主题）
     - 内容：用户输入的文本
     - 时间：当前时间
     - 布局：右对齐
     - **入场动画**：消息从右侧滑入（slide-in-right动画，0.3s ease-out）
     - **消息ID**：为每条消息生成唯一ID，用于后续的撤回和引用功能
   - **显示发送状态**：在用户消息旁边显示"发送中..."的加载指示器（旋转圆环）
   - **将用户消息添加到消息显示区**：使用insertBefore插入到消息显示区底部
   - **滚动到最新消息位置**：使用scrollIntoView({ behavior: 'smooth', block: 'end' })平滑滚动
5. **发送进度提示**：
   - **网络延迟显示**：当网络延迟超过1秒时，显示"网络较慢，正在发送..."的提示
   - **进度条**：在消息下方显示发送进度条（从0%到100%，持续0.5s），提供视觉反馈
   - **附件上传进度**：如果有附件，显示"正在上传附件 X/Y..."的进度提示
   - **上传速度**：显示当前上传速度（如"上传速度：2.5MB/s"），让用户了解发送进度
   - **预计剩余时间**：根据上传速度计算并显示预计剩余时间（如"预计剩余：3秒"）
6. **发送成功处理**：
   - 移除"发送中..."加载指示器
   - 显示"已发送"的成功图标（绿色对勾，持续1秒后消失）
   - 播放发送成功音效（轻微的"嗖"声）
   - **消息持久化**：将消息保存到本地存储或数据库
   - **草稿清理**：清理与该消息相关的草稿数据
   - **统计更新**：更新今日发送消息计数，显示在用户信息区域
   - **未读标记**：如果智能体离线，在消息旁边显示"已离线，稍后发送"的标记
7. **发送失败处理**：
   - 显示"发送失败"的红色错误图标
   - 在消息下方显示"发送失败，点击重试"的按钮
   - 播放失败音效（低沉的"咚"声）
   - **重试机制**：自动重试3次，每次间隔2秒，重试时显示"正在重试（X/3）..."
   - **失败原因提示**：显示具体的失败原因（如"网络连接失败"、"服务器错误"、"内容审核不通过"）
   - **消息保存**：即使发送失败，也将消息保存到本地，标记为"发送失败"
   - **离线缓存**：当网络断开时，将消息缓存到本地，网络恢复后自动发送
8. **清空输入框**：
   - 清空输入框的文本内容
   - 将输入框高度重置为最小高度（100px）
   - 清空附件列表（如果有）
   - 隐藏附件容器
   - **清空动画**：输入框内容淡出（opacity 1→0，0.2s），然后清空内容
   - **高度动画**：高度从当前值平滑过渡到100px（transition: height 0.3s ease）
   - **焦点管理**：清空后重新聚焦到输入框，光标闪烁提示可以继续输入
   - **快捷键重置**：重置所有快捷键状态，确保下次发送正常工作
9. **按钮状态重置**：
   - 发送按钮恢复为禁用状态（灰色）
   - **重置动画**：按钮图标从加载状态恢复为纸飞机图标（0.3s rotate动画）
   - **透明度过渡**：按钮透明度从100%过渡到50%（disabled状态）
   - **颜色过渡**：按钮颜色从蓝色过渡到灰色（transition-colors 0.2s ease）
10. **智能体响应**：
    - 系统发送用户消息给智能体
    - **智能体状态提示**：在对话头部显示"智能体正在思考..."的加载状态，显示呼吸动画
    - **响应超时**：如果智能体响应超过10秒，显示"智能体响应较慢，请稍候..."的提示
    - **响应超时处理**：如果超过30秒无响应，显示"智能体暂时无响应，请稍后再试"的提示，并提供"重试"按钮
    - 智能体处理消息并生成回复
    - **打字机效果**：智能体回复使用打字机效果逐字显示，每字间隔20-50ms，营造真实对话感
    - **流式输出**：支持流式输出，边生成边显示，用户可实时看到回复内容
    - **创建智能体消息元素**：
      - 头像：智能体头像
      - 背景色：灰色（浅色主题）或深灰色（深色主题）
      - 内容：智能体的回复文本
      - 时间：当前时间
      - 布局：左对齐
      - **入场动画**：消息从左侧滑入（slide-in-left动画，0.3s ease-out）
    - **内容格式化**：自动识别并格式化Markdown内容（代码块、链接、列表、引用等）
    - **代码高亮**：代码块自动添加语法高亮，提升可读性
    - **链接预览**：自动识别链接并显示链接预览卡片（如果链接支持）
    - 将智能体消息添加到消息显示区
    - 滚动到最新消息位置（使用平滑滚动）
    - **语音朗读**：提供"朗读回复"按钮，点击后使用TTS技术朗读智能体回复
    - **复制功能**：鼠标悬停在智能体消息上时，显示"复制"按钮，点击可复制消息内容
11. **消息保存**：
    - 将对话记录保存到本地存储或数据库
    - 用于后续的对话历史恢复
    - **增量保存**：每收到一条新消息就增量保存，避免一次性保存大量数据
    - **保存提示**：显示"消息已保存"的临时提示（0.5秒），确认数据已持久化
    - **备份机制**：定期备份对话记录到云端（如果用户开启云同步功能）
    - **同步状态**：显示同步状态图标（已同步/同步中/同步失败）
12. **快捷键支持**：
    - Enter：发送消息（当输入框不为空时）
    - Shift+Enter：换行
    - Ctrl/Cmd + Enter：强制发送（即使内容较短）
    - Esc：取消当前输入，清空输入框（需要确认）
    - Ctrl/Cmd + K：快速输入常用短语
    - Ctrl/Cmd + ↑：快速引用上一条消息
    - **快捷键提示**：在输入框下方显示当前可用的快捷键列表（按?键显示/隐藏）
13. **撤销发送**：
    - 在发送成功后5秒内，用户可以点击"撤销"按钮撤销消息
    - 撤销后消息从界面中移除，但保留在本地历史记录中
    - 显示"消息已撤销"的提示
    - 提供"重新发送"按钮，点击可快速重新发送该消息
14. **消息编辑**：
    - 用户可以编辑已发送的消息（发送后10分钟内）
    - 点击"编辑"按钮后，消息内容回显到输入框
    - 修改后发送，原消息被标记为"已编辑"
    - 编辑历史记录保存，用户可以查看编辑记录
15. **异常处理**：
    - **网络异常**：检测到网络断开时，显示"网络已断开，消息将在网络恢复后发送"的提示
    - **发送队列**：消息进入发送队列，网络恢复后按顺序自动发送
    - **并发控制**：限制同时发送的消息数量（最多3条），避免消息顺序混乱
    - **内存保护**：当发送队列过长时（超过100条），显示"发送队列已满，请稍后再试"的警告

#### 附件按钮交互流程
1. **初始状态**：
   - 附件按钮显示回形针图标
   - 附件容器为隐藏状态
   - 没有已选择的文件
   - **按钮提示**：鼠标悬停在附件按钮上时，显示tooltip"添加附件（最多10个文件）"（延迟0.5秒后显示）
   - **支持格式提示**：点击附件按钮时，在文件选择对话框中显示支持的文件类型说明（如"支持：图片、文档、视频、音频"）
   - **拖拽提示**：在附件按钮旁边显示"或拖拽文件到此处"的提示文字，引导用户使用拖拽功能
2. **用户点击附件按钮**：
   - 触发click事件
   - **点击反馈**：按钮显示按下效果（scale缩小至0.95），同时播放点击音效
   - 创建隐藏的文件输入元素（input type="file"）
   - 设置文件输入元素为多文件选择（multiple="true"）
   - **文件类型限制**：设置accept属性限制可选择的文件类型（如".jpg,.png,.pdf,.doc,.docx,.mp4,.mp3"）
   - 将聊天ID存储到文件输入元素的dataset中
   - 调用文件输入元素的click()方法
3. **打开文件选择器**：
   - 系统打开文件选择对话框
   - 用户可以选择一个或多个文件
   - **最近文件**：文件选择器默认显示最近使用过的文件夹，方便用户快速找到文件
   - **文件预览**：在文件选择器中显示文件预览（如果操作系统支持）
4. **用户选择文件**：
   - 触发change事件
   - 获取用户选择的文件列表
   - 检查是否有文件被选中
   - **取消选择**：如果用户取消选择（未选择任何文件），不执行任何操作，不显示附件容器
5. **文件验证**：
   - **文件类型验证**：检查每个文件是否在允许的类型范围内
     - 如果文件类型不支持：显示"不支持的文件类型：XXX"的错误提示，并跳过该文件
     - 显示支持的文件类型列表，引导用户选择正确的文件
   - **文件大小验证**：检查每个文件是否超过大小限制（单个文件10MB）
     - 如果文件过大：显示"文件过大（XX MB），无法上传。最大支持10MB"的错误提示，并跳过该文件
     - 显示文件大小和限制，让用户了解原因
   - **文件数量验证**：检查附件数量是否超过限制（最多10个）
     - 如果超过：显示"附件数量过多（XX个），最多支持10个附件，请删除部分附件"的警告
     - 显示当前附件数量和剩余可添加数量
   - **重复文件检测**：检测是否选择了重复的文件（文件名和大小相同）
     - 如果有重复：显示"文件已存在，是否覆盖？"的确认对话框
     - 用户选择覆盖则替换原附件，否则跳过新文件
   - **文件名验证**：检查文件名是否包含非法字符
     - 如果包含：显示"文件名包含非法字符，请重命名后上传"的错误提示
   - **病毒扫描**：如果系统支持，自动对文件进行病毒扫描
     - 发现病毒时：显示"文件包含病毒，无法上传"的严重错误提示，并阻止上传
6. **处理选中的文件**：
   - 显示附件容器（移除hidden类）
   - **容器动画**：附件容器从底部滑入（slide-up动画，0.3s ease-out）
   - 遍历每个选中的文件
   - **文件预览生成**：对于图片文件，生成缩略图预览（最大尺寸120x120px）
   - 对于视频文件，生成视频第一帧作为预览图
   - 对于其他文件，显示对应的文件类型图标
   - 为每个文件创建附件元素：
     - 文件图标：根据文件类型显示对应图标
     - 文件名：显示文件名（超过20个字符时截断，显示完整文件名的tooltip）
     - 文件大小：格式化显示文件大小（如1.5MB）
     - 删除按钮：删除按钮图标
     - **上传状态**：显示"等待上传"的状态标记
     - **附件ID**：为每个附件生成唯一ID，用于后续的上传和删除操作
   - **入场动画**：每个附件元素依次淡入（stagger动画，每个延迟0.1s）
   - 将附件元素添加到附件容器
   - **播放音效**：添加附件时播放轻微的"滴"声
7. **附件显示**：
   - 附件容器横向排列所有附件
   - 每个附件为圆角矩形背景
   - 附件之间有间距
   - **响应式布局**：附件过多时自动换行，确保在小屏幕上也能正常显示
   - **附件排序**：支持拖拽调整附件顺序，拖拽时显示半透明预览
   - **附件统计**：在附件容器右上角显示"已选择X个附件，总大小XX MB"的统计信息
   - **进度提示**：如果有附件正在上传，在附件容器顶部显示"正在上传附件..."的进度条
8. **附件上传**：
   - **自动上传**：选择文件后自动开始上传，无需用户手动操作
   - **上传队列**：附件按选择顺序进入上传队列，逐个上传
   - **上传进度**：每个附件显示独立的上传进度条（从0%到100%）
   - **上传速度**：显示当前上传速度（如"上传速度：3.2MB/s"）
   - **预计剩余时间**：根据上传速度计算并显示预计剩余时间（如"预计剩余：5秒"）
   - **并发上传**：支持最多3个文件同时上传，提升上传效率
   - **断点续传**：支持断点续传功能，网络中断后可从断点继续上传
   - **上传成功**：附件显示绿色对勾图标，显示"上传完成"状态
   - **上传失败**：附件显示红色叉号图标，显示"上传失败"状态和"重试"按钮
   - **重试机制**：自动重试失败的附件3次，每次间隔2秒
   - **暂停/继续**：提供"暂停上传"和"继续上传"按钮，用户可以控制上传过程
9. **拖拽上传**：
   - 用户可以直接将文件拖拽到输入区域上传
   - **拖拽区域高亮**：当文件拖拽到输入区域时，整个输入区域显示蓝色边框和半透明背景
   - **拖拽提示**：显示"释放以上传文件"的提示文字
   - **释放检测**：检测释放位置，如果是有效的上传区域则开始处理文件
   - **批量拖拽**：支持同时拖拽多个文件
   - **拖拽音效**：文件释放时播放轻微的"嗖"声
10. **后续操作**：
    - 用户可以继续添加更多附件
    - 用户可以删除不需要的附件
    - 点击发送按钮时，附件随消息一起发送
    - **附件预览**：鼠标悬停在附件上时，显示大图预览（如果是图片或视频）
    - **附件下载**：提供"下载附件"按钮，用户可以下载已上传的附件
    - **附件重命名**：支持在发送前重命名附件，点击文件名即可编辑
    - **附件描述**：支持为附件添加描述文字，鼠标悬停时显示描述
    - **快捷操作**：按Ctrl+A全选附件，按Delete删除选中的附件
11. **异常处理**：
    - **文件读取失败**：如果文件读取失败（如文件损坏、权限不足），显示"文件读取失败，请检查文件是否正常"的错误提示
    - **上传中断**：如果网络中断导致上传失败，自动保存已上传的进度，网络恢复后自动继续
    - **服务器错误**：如果服务器返回错误（如存储空间不足、服务器繁忙），显示具体的错误原因和建议
    - **超时处理**：如果上传超过5分钟未完成，显示"上传超时，请检查网络连接或重试"的警告
    - **内存限制**：如果附件总大小超过500MB，显示"附件总大小过大，请减少附件数量"的警告
    - **重复上传**：如果检测到重复上传（相同的文件已存在），显示"文件已存在，是否跳过？"的确认对话框
12. **性能优化**：
    - **分块上传**：对于大文件（>5MB），使用分块上传技术，每个分块1MB
    - **压缩优化**：对于图片文件，自动压缩到合理大小（最大1920x1080，质量85%），节省带宽
    - **缓存机制**：上传成功的附件缓存到本地，下次上传相同文件时直接使用缓存，避免重复上传
    - **预加载**：上传完成后立即预加载附件，确保发送时能快速显示
13. **安全提示**：
    - **隐私提醒**：上传前显示"请确保文件不包含敏感信息"的隐私提醒
    - **版权提示**：上传前显示"请确保您拥有该文件的版权"的版权提示
    - **安全扫描**：自动扫描附件是否包含恶意代码，发现时阻止上传并提示用户

#### 附件删除交互流程
1. **初始状态**：
   - 附件显示在附件容器中
   - 每个附件都有删除按钮
   - **删除按钮位置**：删除按钮固定在附件右上角，使用半透明背景确保不影响内容查看
   - **删除按钮样式**：显示"×"或垃圾桶图标，悬停时变为红色，提示删除操作
   - **悬停效果**：鼠标悬停在删除按钮上时，按钮放大至1.2倍，显示红色边框，提供视觉反馈
   - **删除提示**：鼠标悬停在删除按钮上时，显示tooltip"删除此附件"（延迟0.5秒后显示）
2. **用户点击删除按钮**：
   - 触发click事件
   - **点击反馈**：删除按钮显示按下效果（scale缩小至0.9），同时播放轻微的"滴"声
   - 获取附件元素
   - **确认对话框**：显示"确定要删除此附件吗？"的确认对话框
     - 对话框包含附件预览（如果是图片或视频）
     - 显示附件名称和大小
     - 提供"确定"和"取消"两个按钮
     - 对话框居中显示，带半透明遮罩
   - **批量删除**：如果用户按住Ctrl或Shift键点击删除，进入批量删除模式
     - 显示"批量删除模式"的提示
     - 附件显示选中状态（蓝色边框）
     - 用户可以继续点击其他附件进行多选
     - 显示"已选择X个附件"的计数器
     - 点击"确定删除"按钮后一次性删除所有选中的附件
   - **快速删除**：提供"不再提示"选项，勾选后不再显示确认对话框，直接删除
   - 用户确认后，执行删除操作
3. **删除动画**：
   - **淡出动画**：附件元素透明度从1过渡到0（duration 0.2s）
   - **缩小动画**：附件元素从原始尺寸缩小到0（scale 1→0，duration 0.2s）
   - **位移动画**：附件元素向下位移10px，增强删除的视觉反馈
   - **组合动画**：使用CSS transform组合动画，确保动画流畅自然
   - **播放音效**：删除时播放轻微的"嗖"声（仅在音效开启时）
   - **动画回调**：动画完成后执行实际的DOM移除操作
4. **从附件容器中移除该附件元素**：
   - **DOM操作**：使用remove()方法从DOM中移除附件元素
   - **内存清理**：清理与该附件相关的JavaScript对象和事件监听器
   - **缓存清理**：如果附件已上传，清理服务器上的缓存（标记为待删除）
   - **上传取消**：如果附件正在上传，立即取消上传操作，释放网络资源
5. **附件容器更新**：
   - **附件计数更新**：更新"已选择X个附件，总大小XX MB"的统计信息
   - **布局重排**：附件容器自动重新排列剩余附件，确保布局整齐
   - **间距调整**：如果删除后只剩一个附件，自动调整间距以填充容器
   - 检查附件容器中是否还有附件
   - 如果没有附件了：
     - 隐藏附件容器（添加hidden类）
     - **隐藏动画**：附件容器从高度auto过渡到0（duration 0.3s），然后隐藏
     - **清理操作**：清空附件容器内部的所有元素，释放内存
   - 如果还有附件：
     - 保持显示状态
     - **容器高度调整**：容器高度根据剩余附件数量自动调整（transition: height 0.3s ease）
     - **重排动画**：剩余附件依次移动到新位置（stagger动画，每个延迟0.1s）
6. **界面反馈**：
   - **删除成功提示**：显示"附件已删除"的临时提示（持续1秒后淡出）
   - **撤销功能**：在删除后3秒内，用户可以点击"撤销"按钮恢复删除的附件
     - 撤销时附件重新添加到容器中
     - 撤销动画：从左侧滑入（slide-in-left，duration 0.3s）
     - 显示"附件已恢复"的提示
   - 附件立即从界面中移除
   - 不影响其他附件的显示
   - **其他附件状态**：剩余附件保持选中/未选中状态不变
   - **焦点管理**：删除后焦点返回到输入框，确保用户可以继续输入
7. **删除历史记录**：
   - **删除日志**：记录删除操作到系统日志，包括附件ID、删除时间、删除原因
   - **恢复功能**：提供"恢复已删除附件"功能，用户可以查看和恢复最近删除的附件
     - 显示最近24小时内删除的附件列表
     - 提供"恢复"和"永久删除"两个操作按钮
     - 恢复后附件重新添加到附件容器
     - 永久删除后附件无法再恢复
   - **批量恢复**：支持批量恢复多个附件
8. **异常处理**：
   - **删除失败**：如果删除操作失败（如网络错误、服务器错误），显示"删除失败，请重试"的错误提示
   - **重试机制**：提供"重试"按钮，点击后重新执行删除操作
   - **状态回滚**：删除失败时，附件保持原状，不会从界面中移除
   - **错误上报**：将删除失败的原因记录到系统日志，便于排查问题
   - **服务器同步**：如果附件已上传到服务器，删除操作需要与服务器同步
     - 删除成功后向服务器发送删除请求
     - 如果服务器删除失败，在本地标记为"待删除"，下次同步时再次尝试
9. **快捷键支持**：
   - Delete键：删除选中的附件（需要确认）
   - Ctrl+Delete：快速删除选中的附件（无需确认）
   - Esc键：取消批量删除模式
   - Ctrl+A：全选所有附件（在批量删除模式下）
   - **快捷键提示**：在附件容器下方显示当前可用的快捷键列表（按?键显示/隐藏）
10. **性能优化**：
    - **虚拟滚动**：当附件数量超过20个时，启用虚拟滚动优化渲染性能
    - **懒加载**：附件预览图使用懒加载，只有可见的附件才加载预览
    - **内存管理**：删除附件后立即释放相关内存，避免内存泄漏
    - **事件委托**：使用事件委托处理删除事件，减少事件监听器数量
11. **无障碍支持**：
    - **ARIA标签**：删除按钮添加aria-label="删除附件"
    - **键盘导航**：支持Tab键导航到删除按钮，Enter或Space键触发删除
    - **焦点可见**：删除按钮获得焦点时显示明显的焦点环
    - **屏幕阅读器**：删除操作提供屏幕阅读器友好的提示信息
12. **用户引导**：
    - **首次使用提示**：首次使用删除功能时，显示"点击右上角的×按钮可以删除附件"的引导提示
    - **批量删除提示**：首次进入批量删除模式时，显示"按住Ctrl或Shift键可以多选附件"的引导提示
    - **撤销功能提示**：删除后显示"可以点击撤销恢复删除的附件"的提示
    - **引导动画**：使用动画效果引导用户操作，如删除按钮闪烁提示

#### 消息滚动交互流程
1. **初始状态**：
   - 消息显示区显示历史消息
   - 滚动条显示在右侧
   - **滚动位置记忆**：记住用户上次离开时的滚动位置，再次打开时恢复到该位置
   - **平滑入场**：消息显示区内容从底部滑入（slide-up动画，0.3s），营造流畅的进入效果
   - **未读标记**：如果有未读消息，在滚动条上显示蓝色圆点提示
   - **快捷滚动**：双击滚动条顶部/底部可快速滚动到最顶部/最底部
   - **滚动预览**：鼠标悬停在滚动条上时，显示当前位置的百分比（如"50%"）
2. **新消息到达**：
   - 新消息添加到消息显示区
   - **新消息提示**：如果有新消息到达，在消息显示区顶部显示"有X条新消息"的提示按钮
     - 提示按钮带有蓝色背景和闪烁动画
     - 点击提示按钮可快速滚动到最新消息
     - 提示按钮3秒后自动淡出，或者用户滚动后消失
   - **滚动行为判断**：
     - 如果用户当前查看的是最新消息（滚动位置在底部50px范围内）：自动滚动到最新消息
     - 如果用户正在查看历史消息（滚动位置不在底部）：不自动滚动，保留用户当前位置
   - **自动滚动动画**：使用smooth behavior实现平滑滚动到新消息（duration: 0.5s）
   - **滚动到最新消息**：滚动位置设置为消息显示区的底部，使用scrollIntoView({ behavior: 'smooth', block: 'end' })
   - **新消息高亮**：新消息添加后显示高亮动画（背景色闪烁2次，持续1秒），吸引用户注意
   - **声音提示**：新消息到达时播放轻微的"叮"声（仅在用户查看最新消息时播放，避免打扰）
   - **桌面通知**：如果窗口最小化或失焦，显示桌面通知："收到新消息：XXX"（需要用户授权）
   - **未读计数**：更新未读消息计数，在侧边栏智能体项上显示红色圆点和数字标记
3. **用户手动滚动**：
   - 用户可以手动滚动查看历史消息
   - 滚动条跟随用户操作移动
   - **触摸支持**：在触摸屏设备上，支持滑动滚动和惯性滚动（momentum scrolling）
   - **滚轮加速**：快速滚动时启用滚轮加速，滚动速度逐渐提升（最高3倍速度）
   - **平滑滚动**：手动滚动时使用smooth behavior，确保滚动流畅
   - **滚动边界**：滚动到顶部/底部时显示弹性效果（rubber band effect），提示用户已到达边界
   - **滚动阻尼**：快速滚动时添加阻尼效果，避免滚动过快导致眩晕
   - **滚动节流**：滚动事件使用节流（throttle），限制每100ms最多执行一次，优化性能
   - **虚拟滚动**：当消息数量超过100条时，启用虚拟滚动技术，只渲染可见区域的消息
   - **滚动位置保存**：每隔5秒保存一次滚动位置，防止页面崩溃后丢失位置
4. **滚动条样式**：
   - **滚动条宽度**：6px（细滚动条，节省空间）
   - **滚动条位置**：距离右边缘4px，不与内容重叠
   - **滚动条圆角**：完全圆角（rounded-full），视觉更柔和
   - 浅色主题：
     - 滚动条轨道：浅灰色背景（bg-gray-200）
     - 滚动条滑块：深灰色背景（bg-gray-400）
     - 悬停时：滑块变为更深的灰色（bg-gray-600）
     - 活动时：滑块变为蓝色（bg-blue-500），表示正在滚动
   - 深色主题：
     - 滚动条轨道：深灰色背景（bg-gray-700）
     - 滚动条滑块：浅灰色背景（bg-gray-500）
     - 悬停时：滑块变为更浅的灰色（bg-gray-300）
     - 活动时：滑块变为蓝色（bg-blue-400），表示正在滚动
   - **滚动条动画**：滑块颜色变化使用transition，持续0.2s ease
   - **滚动条显示**：鼠标移入消息显示区时显示滚动条，移出后延迟2秒自动隐藏（避免干扰阅读）
   - **拖拽高亮**：拖拽滚动条时，滑块变为蓝色并显示当前位置的百分比提示
5. **平滑滚动**：
   - 使用scrollIntoView或scrollTop实现平滑滚动
   - 提供良好的用户体验
   - **滚动参数**：使用{ behavior: 'smooth', block: 'end' }参数实现平滑滚动到底部
   - **滚动速度**：根据滚动距离动态调整滚动速度，短距离快速滚动，长距离慢速滚动
   - **滚动缓动**：使用ease-in-out缓动曲线，滚动开始和结束时速度较慢，中间速度较快
   - **滚动完成回调**：滚动完成后触发回调函数，执行后续操作（如标记已读、更新UI等）
6. **滚动位置指示**：
   - **位置标记**：在滚动条上显示当前位置的小圆点（蓝色）
   - **未读位置标记**：如果有未读消息，在滚动条上显示红色小圆点，指示未读消息的位置
   - **时间戳标记**：在滚动条上显示时间戳标记（如"昨天"、"今天"、"更早"），方便用户快速定位
   - **快速跳转**：点击时间戳标记可快速滚动到对应时间段的消息
   - **标记提示**：鼠标悬停在标记上时，显示该位置的消息摘要和时间
7. **滚动历史记录**：
   - **滚动足迹**：记录用户的滚动足迹（最近10个滚动位置），按时间倒序排列
   - **快速返回**：提供"返回上次位置"按钮，点击可快速返回到上一个滚动位置
   - **足迹可视化**：在滚动条上显示滚动足迹的小圆点（灰色），点击可跳转到该位置
   - **自动清理**：超过1小时的滚动足迹自动清理，避免堆积过多
8. **键盘滚动支持**：
   - **方向键滚动**：
     - ↑/↓方向键：向上/向下滚动一行
     - PageUp/PageDown：向上/向下滚动一页
     - Home/End：滚动到顶部/底部
   - **滚动速度**：按住方向键时，滚动速度逐渐提升（最高2倍速度）
   - **滚动平滑**：键盘滚动使用smooth behavior，确保流畅
   - **快捷键提示**：在消息显示区下方显示可用的键盘快捷键（按?键显示/隐藏）
   - **焦点管理**：消息显示区获得焦点时，方向键可直接滚动，无需点击
9. **滚动加载更多**：
   - **懒加载**：当滚动到顶部时，自动加载更多历史消息
   - **加载指示器**：在顶部显示"正在加载更多消息..."的加载指示器（旋转圆环）
   - **加载进度**：显示加载进度（如"已加载X条消息"）
   - **加载完成提示**：加载完成后显示"已加载全部历史消息"的提示（2秒后消失）
   - **加载失败处理**：如果加载失败，显示"加载失败，点击重试"的错误提示
   - **缓存机制**：已加载的消息缓存到本地，下次滚动时直接使用缓存，避免重复加载
   - **预加载**：当滚动到距离顶部200px时，提前加载更多消息，确保用户不会看到空白
   - **虚拟滚动优化**：结合虚拟滚动技术，即使有数千条消息也能流畅滚动
10. **智能滚动**：
    - **用户行为分析**：分析用户的滚动习惯，如平均滚动速度、停留时间等
    - **预测滚动**：根据用户习惯预测下一步滚动操作，提前预加载相关内容
    - **自动暂停**：当用户滚动速度过快时，自动暂停图片加载，避免浪费带宽
    - **恢复加载**：滚动停止后，立即恢复图片加载
    - **滚动节能**：当窗口最小化或失焦时，暂停所有滚动相关操作，节省资源
11. **滚动异常处理**：
    - **滚动卡顿**：检测到滚动卡顿时（帧率低于30fps），自动降低虚拟滚动渲染密度
    - **滚动失败**：如果滚动操作失败（如滚动位置无效），重置到安全位置（顶部或底部）
    - **内存保护**：当消息数量过多导致内存不足时，自动清理最早加载的消息，释放内存
    - **错误上报**：将滚动异常记录到系统日志，便于排查问题
    - **恢复机制**：提供"恢复默认滚动"按钮，点击后重置所有滚动设置
12. **无障碍支持**：
    - **ARIA标签**：消息显示区添加aria-label="消息列表"
    - **焦点可见**：消息显示区获得焦点时显示明显的焦点环
    - **键盘导航**：支持Tab键导航到消息显示区，方向键滚动消息
    - **屏幕阅读器**：滚动位置变化时提供屏幕阅读器友好的提示信息（如"滚动到第50条消息"）
    - **高对比度**：支持高对比度模式，滚动条使用更明显的颜色
13. **性能优化**：
    - **虚拟滚动**：当消息数量超过100条时，启用虚拟滚动，只渲染可见区域的消息
    - **图片懒加载**：只有滚动到可见区域时才加载图片，减少初始加载时间
    - **节流防抖**：滚动事件使用节流和防抖，避免频繁触发导致性能问题
    - **requestAnimationFrame**：使用requestAnimationFrame优化滚动动画，确保60fps流畅度
    - **will-change**：对滚动容器使用CSS will-change属性，提示浏览器优化滚动性能
    - **GPU加速**：使用transform和opacity实现滚动动画，触发GPU加速

#### 主题切换交互流程（对话界面）
1. **初始状态**：
   - 对话界面显示当前主题的样式
   - 浅色主题：白色/浅灰色背景，深色文字
   - 深色主题：深灰色背景，浅色文字
   - **主题按钮显示**：主题按钮显示当前主题对应的图标（浅色主题显示太阳图标，深色主题显示月亮图标）
   - **按钮位置**：主题按钮固定在对话界面头部右侧，确保用户随时可见
   - **按钮提示**：鼠标悬停在主题按钮上时，显示tooltip"切换主题（浅色/深色）"（延迟0.5秒后显示）
   - **快捷键提示**：在主题按钮下方显示"Ctrl/Cmd + Shift + T 快速切换"的小字提示，首次使用3秒后淡出
2. **用户点击主题按钮**：
   - 触发click事件
   - **点击反馈**：按钮显示按下效果（scale缩小至0.95），同时播放轻微的"滴"声
   - **点击动画**：按钮图标旋转180度（duration 0.3s），提供视觉反馈
   - **禁用重复点击**：主题切换过程中禁用按钮，防止重复点击导致主题错乱
   - **加载状态**：按钮显示加载指示器（旋转圆环），按钮透明度降低至0.7
   - **切换提示**：显示"正在切换主题..."的临时提示，持续0.5秒
   - 执行主题切换功能（与2.1章节相同）
3. **主题预览**：
   - **实时预览**：主题切换前显示主题预览窗口，用户可以在切换前预览新主题效果
   - **预览窗口**：预览窗口显示新主题的头部、消息显示区、输入区域的样式
   - **预览动画**：预览窗口从右侧滑入（slide-in-right动画，0.3s）
   - **确认切换**：预览窗口包含"确认切换"和"取消"两个按钮
   - **快速切换**：提供"不再显示预览"选项，勾选后不再显示预览窗口，直接切换主题
   - 用户确认后，执行主题切换操作
4. **对话界面样式更新**：
   - **批量更新**：使用CSS变量批量更新所有相关样式，避免逐个更新元素导致性能问题
   - **更新头部样式**：
     - 背景色：浅色主题bg-white，深色主题bg-gray-800
     - 边框颜色：浅色主题border-gray-200，深色主题border-gray-700
     - 文字颜色：浅色主题text-gray-900，深色主题text-white
     - 智能体头像背景：根据主题调整渐变色
   - **更新消息显示区样式**：
     - 背景色：浅色主题bg-gray-100，深色主题bg-gray-900
     - 用户消息背景色：浅色主题bg-blue-500，深色主题bg-blue-600
     - 智能体消息背景色：浅色主题bg-white，深色主题bg-gray-800
     - 消息文字颜色：浅色主题text-gray-900，深色主题text-white
     - 时间文字颜色：浅色主题text-gray-500，深色主题text-gray-400
     - 分割线颜色：浅色主题border-gray-300，深色主题border-gray-700
     - 代码块背景色：浅色主题bg-gray-200，深色主题bg-gray-700
     - 链接颜色：浅色主题text-blue-600，深色主题text-blue-400
   - **更新输入区域样式**：
     - 输入框背景色：浅色主题bg-white，深色主题bg-gray-800
     - 输入框文字颜色：浅色主题text-gray-900，深色主题text-white
     - 输入框占位符颜色：浅色主题placeholder-gray-400，深色主题placeholder-gray-500
     - 输入框边框颜色：浅色主题border-gray-300，深色主题border-gray-600
     - 输入框焦点边框：浅色主题focus:ring-blue-500，深色主题focus:ring-blue-400
     - 附件容器背景色：浅色主题bg-gray-50，深色主题bg-gray-700/50
     - 附件背景色：浅色主题bg-white，深色主题bg-gray-800
     - 附件文字颜色：浅色主题text-gray-700，深色主题text-gray-200
     - 附件边框颜色：浅色主题border-gray-300，深色主题border-gray-600
   - **更新按钮区域样式**：
     - 按钮背景色：浅色主题bg-gray-100，深色主题bg-gray-700
     - 按钮文字颜色：浅色主题text-gray-700，深色主题text-gray-200
     - 按钮悬停颜色：浅色主题hover:bg-gray-200，深色主题hover:bg-gray-600
     - 发送按钮背景色：浅色主题bg-blue-500，深色主题bg-blue-600
     - 发送按钮悬停：浅色主题hover:bg-blue-600，深色主题hover:bg-blue-700
   - **更新滚动条样式**：
     - 滚动条轨道：浅色主题bg-gray-200，深色主题bg-gray-700
     - 滚动条滑块：浅色主题bg-gray-400，深色主题bg-gray-500
     - 滚动条悬停：浅色主题hover:bg-gray-600，深色主题hover:bg-gray-300
   - **更新图标样式**：
     - 图标颜色：浅色主题text-gray-600，深色主题text-gray-300
     - 图标悬停：浅色主题hover:text-gray-900，深色主题hover:text-white
5. **动画过渡**：
   - **全局过渡**：所有样式变化都有transition-colors过渡效果
   - **过渡时长**：颜色变化使用0.3s ease-in-out过渡
   - **贝塞尔曲线**：使用cubic-bezier(0.4, 0, 0.2, 1)实现更自然的动画效果
   - **分批过渡**：元素按批次过渡，避免同时过渡导致性能问题
     - 头部区域：0ms延迟
     - 消息显示区：50ms延迟
     - 输入区域：100ms延迟
   - **平滑过渡**：所有颜色变化平滑过渡到新主题，避免突变
   - **动画完成回调**：所有动画完成后触发回调，执行后续操作（如保存主题设置）
6. **切换完成反馈**：
   - **成功提示**：显示"主题已切换到浅色/深色主题"的成功提示，持续2秒后淡出
   - **按钮恢复**：按钮图标恢复为正常状态，停止加载指示器，恢复透明度
   - **播放音效**：切换完成时播放轻微的"嗖"声
   - **主题图标更新**：按钮图标更新为新主题对应的图标（太阳/月亮）
   - **焦点管理**：切换完成后，焦点返回到主题按钮，方便用户再次切换
7. **主题设置保存**：
   - **自动保存**：主题切换完成后自动保存到localStorage
   - **保存键名**："theme"，值为"light"或"dark"
   - **保存成功提示**：显示"主题设置已保存"的临时提示，持续1秒
   - **保存失败处理**：如果localStorage不可用或保存失败：
     - 显示错误提示："主题保存失败，将使用默认主题"
     - 回退到原主题
     - 错误信息记录到系统日志
   - **下次加载**：下次打开应用时自动加载保存的主题设置
8. **系统主题跟随**：
   - **自动检测**：监听系统主题变化（prefers-color-scheme媒体查询）
   - **自动切换**：系统主题变化时，自动切换应用主题
   - **跟随选项**：提供"跟随系统主题"选项，开启后自动跟随系统主题
   - **通知用户**：系统主题变化时，显示"已切换到系统主题"的提示
   - **手动覆盖**：用户手动切换主题后，临时关闭"跟随系统主题"选项
   - **重新开启**：用户可以随时重新开启"跟随系统主题"选项
9. **快捷键支持**：
   - Ctrl/Cmd + Shift + T：快速切换主题
   - 快捷键触发时显示"主题已切换"提示
   - 快捷键触发时播放切换音效
   - **快捷键冲突检测**：检测快捷键是否与其他应用冲突，冲突时显示警告
   - **自定义快捷键**：支持用户自定义主题切换快捷键
10. **主题预设**：
    - **内置主题**：提供多种内置主题供用户选择
      - 浅色主题：白色背景，深色文字
      - 深色主题：深灰背景，浅色文字
      - 护眼模式：浅黄绿色背景，降低蓝光
      - 高对比度：黑白对比度最高，适合视力障碍用户
    - **主题预览**：每个主题都有预览图，鼠标悬停时显示
    - **快速切换**：提供主题切换面板，用户可以快速切换到任意主题
    - **主题收藏**：支持收藏常用主题，方便快速切换
    - **主题导入导出**：支持导入导出自定义主题配置（JSON格式）
11. **自定义主题**：
    - **主题编辑器**：提供主题编辑器，用户可以自定义主题颜色
    - **实时预览**：编辑主题时实时预览效果
    - **颜色选择器**：提供专业的颜色选择器，支持HEX、RGB、HSL格式
    - **主题模板**：提供主题模板，用户可以基于模板快速创建自定义主题
    - **主题分享**：支持分享自定义主题到社区
    - **主题同步**：支持同步自定义主题到云端，多设备同步
12. **动画效果**：
    - **主题切换动画**：主题切换时显示淡入淡出动画（fade-in-out，0.5s）
    - **图标动画**：主题按钮图标旋转180度，持续0.3s
    - **元素动画**：消息、输入框等元素依次淡入，营造流畅的切换效果
    - **波纹效果**：从点击位置扩散的波纹效果，增强交互反馈
    - **动画可配置**：支持用户关闭动画效果，提升性能
13. **性能优化**：
    - **CSS变量**：使用CSS变量管理主题颜色，减少重复代码
    - **避免重绘**：使用transform和opacity实现动画，避免触发重绘
    - **GPU加速**：使用will-change属性提示浏览器优化动画性能
    - **按需加载**：只加载当前主题需要的资源，减少初始加载时间
    - **主题缓存**：缓存已加载的主题资源，下次切换时直接使用
14. **异常处理**：
    - **切换失败**：如果主题切换失败（如资源加载失败），显示"主题切换失败，请重试"的错误提示
    - **回退机制**：切换失败时自动回退到原主题，避免界面混乱
    - **资源加载失败**：如果主题资源加载失败，使用默认资源替代
    - **错误上报**：将主题切换失败的原因记录到系统日志，便于排查问题
    - **恢复默认**：提供"恢复默认主题"按钮，点击后重置为系统默认主题
15. **无障碍支持**：
    - **ARIA标签**：主题按钮添加aria-label="切换主题"
    - **焦点可见**：主题按钮获得焦点时显示明显的焦点环
    - **键盘导航**：支持Tab键导航到主题按钮，Enter或Space键触发切换
    - **屏幕阅读器**：主题切换时提供屏幕阅读器友好的提示信息（如"已切换到深色主题"）
    - **高对比度**：支持高对比度模式，确保视力障碍用户也能清晰看到内容
### 2.2.4 视觉设计要求

#### 对话界面整体布局
- **布局结构**：Flexbox垂直布局
- **区域划分**：
  - 头部区域：固定高度，顶部显示
  - 消息显示区：弹性区域，占用剩余空间
  - 输入区域：固定高度，底部显示
- **响应式设计**：根据屏幕宽度自适应调整布局
- **滚动设计**：消息显示区支持垂直滚动，自定义滚动条样式

#### 对话界面头部视觉设计
- **容器设计**：
  - 内边距：上下左右各16px（p-4）
  - 背景色：浅色主题bg-white，深色主题bg-gray-800
  - 边框：底部1px灰色边框（border-b）
  - 边框颜色：浅色主题border-gray-200，深色主题border-gray-700
  - 布局方式：Flexbox水平排列，两端对齐
- **智能体信息区**：
  - 布局：Flexbox水平排列
  - 间距：元素之间间距8px（gap-2）
- **智能体头像**：
  - 容器尺寸：40x40px（w-10 h-10）
  - 圆形设计：完全圆角（rounded-full）
  - 渐变背景：根据智能体类型设置（蓝色/紫色/橙色）
  - 相对定位：相对定位
  - 图标尺寸：20x20px（w-5 h-5）
  - 图标颜色：白色（text-white）
- **智能体名称**：
  - 字体大小：18px（text-lg）
  - 字体粗细：粗体（font-bold）
  - 颜色：浅色主题text-gray-900，深色主题text-white
- **在线状态标签**：
  - 字体大小：12px（text-xs）
  - 字体粗细：正常（font-normal）
  - 颜色：绿色（text-green-500）
  - 间距：与名称间距4px（gap-1）
- **用户信息区**：
  - 布局：Flexbox水平排列
  - 间距：元素之间间距8px（gap-2）
- **欢迎文本**：
  - 字体大小：14px（text-sm）
  - 颜色：灰色（text-gray-600）
- **用户头像**：
  - 容器尺寸：32x32px（w-8 h-8）
  - 圆形设计：完全圆角（rounded-full）
  - 背景色：浅色主题bg-gray-200，深色主题bg-gray-700
  - 图标尺寸：16x16px（w-4 h-4）
  - 图标颜色：灰色（text-gray-600）

#### 消息显示区视觉设计
- **容器设计**：
  - 内边距：上下16px，左右24px（px-6 py-4）
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-900
  - 弹性区域：flex-1，占用剩余垂直空间
  - 滚动：垂直滚动（overflow-y-auto）
  - 滚动条样式：自定义细滚动条（6px宽）
- **时间分割线**：
  - 容器设计：
    - 外边距：上下16px（my-4）
    - 布局：Flexbox水平排列，居中对齐
    - 间距：元素之间间距8px（gap-2）
  - 分割线：
    - 高度：1px（h-px）
    - 背景：灰色（bg-gray-300）
    - 弹性：flex-1，占用剩余空间
  - 时间标签：
    - 字体大小：12px（text-xs）
    - 颜色：灰色（text-gray-500）
    - 内边距：上下4px，左右8px（px-2 py-1）
    - 圆角：4px（rounded）

#### 用户消息视觉设计
- **消息容器**：
  - 外边距：上下8px（my-2）
  - 布局：Flexbox水平排列，右对齐
- **消息气泡**：
  - 最大宽度：70%（max-w-[70%]）
  - 内边距：上下8px，左右12px（px-3 py-2）
  - 圆角：圆角8px（rounded-lg）
  - 背景色：浅色主题bg-blue-100，深色主题bg-blue-900
  - 边框：1px浅蓝色边框（border border-blue-200）
  - 位置：右对齐
- **消息内容**：
  - 字体大小：14px（text-sm）
  - 颜色：浅色主题text-gray-900，深色主题text-white
  - 换行：自动换行
- **发送时间**：
  - 字体大小：10px（text-[10px]）
  - 颜色：灰色（text-gray-400）
  - 对齐：右对齐
  - 间距：与消息内容间距4px（mt-1）

#### 智能体消息视觉设计
- **消息容器**：
  - 外边距：上下8px（my-2）
  - 布局：Flexbox水平排列，左对齐
  - 间距：头像与消息间距8px（gap-2）
- **智能体头像**：
  - 容器尺寸：32x32px（w-8 h-8）
  - 圆形设计：完全圆角（rounded-full）
  - 渐变背景：根据智能体类型设置（蓝色/紫色/橙色）
  - 图标尺寸：16x16px（w-4 h-4）
  - 图标颜色：白色（text-white）
  - 相对定位：相对定位
- **消息气泡**：
  - 最大宽度：70%（max-w-[70%]）
  - 内边距：上下8px，左右12px（px-3 py-2）
  - 圆角：圆角8px（rounded-lg）
  - 背景色：浅色主题bg-gray-200，深色主题bg-gray-700
  - 边框：1px灰色边框（border border-gray-300）
  - 位置：左对齐
- **消息内容**：
  - 字体大小：14px（text-sm）
  - 颜色：浅色主题text-gray-900，深色主题text-white
  - 换行：自动换行
- **发送时间**：
  - 字体大小：10px（text-[10px]）
  - 颜色：灰色（text-gray-400）
  - 对齐：左对齐
  - 间距：与消息内容间距4px（mt-1）

#### 输入区域视觉设计
- **容器设计**：
  - 内边距：上下左右各16px（p-4）
  - 背景色：浅色主题bg-white，深色主题bg-gray-800
  - 边框：顶部1px灰色边框（border-t）
  - 边框颜色：浅色主题border-gray-200，深色主题border-gray-700
  - 布局方式：Flexbox垂直排列
- **输入框设计**：
  - 外边距：底部8px（mb-2）
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-700
  - 文字颜色：浅色主题text-gray-900，深色主题text-white
  - 占位符颜色：灰色（placeholder-gray-400）
  - 圆角：圆角8px（rounded-lg）
  - 内边距：上下左右各12px（px-3 py-3）
  - 边框：浅色主题border border-gray-200，深色主题无边框
  - 焦点效果：2px蓝色圆环（focus:ring-2 focus:ring-blue-500）
  - 最小高度：100px（min-h-[100px]）
  - 最大高度：300px（max-h-[300px]）
  - 重置大小：resize-none，禁止用户手动调整
  - 过渡效果：高度变化有平滑过渡
  - 字体：14px无衬线字体
  - 行高：1.5

#### 附件容器视觉设计
- **容器设计**：
  - 外边距：底部8px（mb-2）
  - 布局：Flexbox水平排列，自动换行（flex-wrap）
  - 间距：附件之间间距8px（gap-2）
  - 过渡效果：隐藏/显示有平滑过渡
- **附件项设计**：
  - 内边距：上下6px，左右10px（px-2 py-1.5）
  - 圆角：圆角6px（rounded-md）
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-700
  - 边框：1px灰色边框（border border-gray-200）
  - 布局：Flexbox水平排列
  - 间距：元素之间间距6px（gap-1.5）
  - 过渡效果：all 0.2s ease
- **附件图标**：
  - 尺寸：14x14px（w-3.5 h-3.5）
  - 颜色：灰色（text-gray-400）
- **文件名**：
  - 字体大小：12px（text-xs）
  - 颜色：浅色主题text-gray-700，深色主题text-gray-200
  - 截断处理：超出部分用省略号（truncate）
  - 最大宽度：150px（max-w-[150px]）
- **删除按钮**：
  - 尺寸：14x14px（w-3.5 h-3.5）
  - 颜色：灰色（text-gray-400）
  - 悬停颜色：红色（hover:text-red-500）
  - 过渡效果：颜色变化有平滑过渡

#### 按钮区域视觉设计
- **容器设计**：
  - 布局：Flexbox水平排列，右对齐
  - 间距：按钮之间间距8px（gap-2）
- **发送按钮**：
  - 容器设计：
    - 内边距：上下8px，左右12px（px-3 py-2）
    - 圆角：圆角8px（rounded-lg）
    - 过渡效果：all 0.2s ease
    - 布局：Flexbox水平排列，居中对齐
  - 默认状态：
    - 背景色：灰色（bg-gray-300）
    - 禁用状态：pointer-events-none
    - 图标颜色：深灰色（text-gray-500）
  - 激活状态：
    - 背景色：蓝色（bg-blue-500）
    - 悬停背景：深蓝色（hover:bg-blue-600）
    - 图标颜色：白色（text-white）
    - 光标：指针（cursor: pointer）
  - 图标尺寸：16x16px（w-4 h-4）
- **附件按钮**：
  - 容器设计：
    - 内边距：上下8px，左右12px（px-3 py-2）
    - 圆角：圆角8px（rounded-lg）
    - 过渡效果：all 0.2s ease
    - 布局：Flexbox水平排列，居中对齐
  - 背景色：浅色主题bg-gray-100，深色主题bg-gray-700
  - 悬停背景：浅色主题hover:bg-gray-200，深色主题hover:bg-gray-600
  - 图标尺寸：16x16px（w-4 h-4）
  - 图标颜色：浅色主题text-gray-600，深色主题text-gray-300
  - 光标：指针（cursor: pointer）

#### 滚动条视觉设计
- **滚动条宽度**：6px
- **滚动条轨道**：
  - 背景色：透明（transparent）
  - 圆角：3px
- **滚动条滑块**：
  - 浅色主题：
    - 背景色：灰色（#d1d5db）
    - 悬停背景：深灰色（#9ca3af）
  - 深色主题：
    - 背景色：灰色（#4b5563）
    - 悬停背景：浅灰色（#9ca3af）
  - 圆角：3px
  - 过渡效果：background-color 0.2s ease
- **滚动行为**：平滑滚动（scroll-behavior: smooth）

#### 配色方案
- **浅色主题配色**：
  - 主背景色：浅灰色（#f3f4f6）
  - 次要背景色：白色（#ffffff）
  - 用户消息背景：浅蓝色（#dbeafe）
  - 智能体消息背景：灰色（#e5e7eb）
  - 输入框背景：浅灰色（#f3f4f6）
  - 按钮主色：蓝色（#3b82f6）
  - 按钮悬停：深蓝色（#2563eb）
  - 边框色：灰色（#d1d5db）
  - 主要文字色：深灰色（#111827）
  - 次要文字色：灰色（#4b5563）
  - 辅助文字色：灰色（#9ca3af）
  - 在线状态：绿色（#10b981）
- **深色主题配色**：
  - 主背景色：深灰色（#111827）
  - 次要背景色：深灰色（#1f2937）
  - 用户消息背景：深蓝色（#1e3a8a）
  - 智能体消息背景：深灰色（#374151）
  - 输入框背景：深灰色（#374151）
  - 按钮主色：蓝色（#3b82f6）
  - 按钮悬停：浅蓝色（#60a5fa）
  - 边框色：深灰色（#374151）
  - 主要文字色：白色（#ffffff）
  - 次要文字色：浅灰色（#d1d5db）
  - 辅助文字色：浅灰色（#9ca3af）
  - 在线状态：绿色（#10b981）

#### 字体系统
- **主字体**：系统默认无衬线字体（sans-serif）
- **字体大小体系**：
  - 超大号：text-lg（18px）- 智能体名称
  - 大号：text-base（16px）- 标准文字
  - 中号：text-sm（14px）- 消息内容
  - 小号：text-xs（12px）- 附件、时间标签
  - 超小号：text-[10px]（10px）- 发送时间
- **字体粗细**：
  - 粗体：font-bold - 智能体名称
  - 正常：font-normal - 大部分文字
- **字体样式**：无斜体，无装饰线
- **行高**：1.5 - 确保文字可读性

#### 间距系统
- **间距单位**：使用4px基准单位
- **消息间距**：
  - 垂直间距：上下8px（my-2）
  - 消息内部：上下8px，左右12px（px-3 py-2）
- **区域间距**：
  - 头部内边距：上下左右各16px（p-4）
  - 消息区内边距：上下16px，左右24px（px-6 py-4）
  - 输入区内边距：上下左右各16px（p-4）

#### 阴影系统
- **消息气泡**：
  - 浅色主题：无阴影（shadow-none）
  - 深色主题：无阴影（shadow-none）
- **附件项**：
  - 浅色主题：无阴影（shadow-none）
  - 深色主题：无阴影（shadow-none）
- **整体风格**：扁平化设计，减少阴影使用

#### 过渡动画
- **过渡属性**：transition-all或transition-colors
- **过渡时间**：
  - 快速：0.1s - 按钮交互
  - 标准：0.2s - 大部分交互
  - 缓慢：0.3s - 布局变化
- **过渡效果**：ease（缓动函数）
- **过渡应用**：
  - 按钮悬停效果
  - 输入框高度调整
  - 消息发送动画
  - 附件添加/删除
  - 主题切换

#### 可访问性设计
- **对比度**：符合WCAG 2.1标准，对比度至少4.5:1
- **焦点状态**：所有可交互元素都有明显的焦点指示器（focus:ring-2 focus:ring-blue-500）
- **键盘导航**：支持Tab键导航，Enter发送消息
- **屏幕阅读器**：使用语义化HTML标签
- **文字缩放**：支持浏览器文字缩放功能（200%）
- **触摸目标**：触摸目标至少44x44px，符合移动端标准
- **消息标识**：使用aria-label为消息添加描述

#### 响应式设计
- **桌面端**：
  - 侧边栏宽度：320px
  - 消息最大宽度：70%
  - 输入框最小高度：100px
- **平板端**：
  - 侧边栏可能自动收缩
  - 消息最大宽度：80%
  - 调整内边距和间距
- **移动端**：
  - 侧边栏默认收缩状态
  - 消息最大宽度：90%
  - 减小字体大小
  - 调整触摸目标大小
- **断点设计**：根据屏幕宽度自动调整布局和样式
5. **功能保持**：
   - 主题切换不影响消息输入功能
   - 主题切换不影响消息发送功能
   - 主题切换不影响附件功能


## 2.3 欢迎页面
### 2.3.1 参考原型设计页面
    MainLayout.html
### 2.3.2 功能流程

#### 页面布局
- **容器结构**：居中显示的最大宽度容器
- **垂直对齐**：垂直居中布局
- **显示状态**：默认显示，选择智能体后隐藏

#### 欢迎图标区域
- **图标容器**：
  - 尺寸：24x24像素
  - 背景：蓝色到紫色渐变背景
  - 圆角：圆角矩形（rounded-2xl）
  - 内边距：自动水平边距，底部6像素边距
- **图标内容**：
  - 类型：SVG图标（聊天图标）
  - 尺寸：14x14像素
  - 颜色：白色

#### 欢迎文本区域
- **主标题**：
  - 文本内容："欢迎使用 AutoMate"
  - 字体大小：2xl（超大号字体）
  - 字体粗细：粗体（bold）
  - 底部边距：3像素
- **描述文本**：
  - 文本内容："选择左侧的智能体开始对话，体验智能化的任务处理"
  - 颜色：灰色（text-gray-600）
  - 底部边距：6像素

#### 统计卡片区域
- **布局**：3列网格布局（grid-cols-3）
- **间距**：卡片之间间距为4像素

#### 统计卡片1：可用智能体
- **卡片样式**：
  - 内边距：4像素（p-4）
  - 背景：浅灰色到深灰色渐变（bg-gradient-to-br from-gray-100 to-gray-200）
  - 圆角：圆角矩形（rounded-lg）
  - 阴影：轻微阴影（shadow-sm）
- **数字显示**：
  - 数值："3"
  - 字体大小：2xl（超大号字体）
  - 字体粗细：粗体（bold）
  - 颜色：蓝色（text-blue-600）
- **标签文本**：
  - 文本："可用智能体"
  - 字体大小：xs（超小号字体）
  - 颜色：灰色（text-gray-600）
  - 顶部边距：1像素

#### 统计卡片2：可用技能
- **卡片样式**：
  - 内边距：4像素（p-4）
  - 背景：浅灰色到深灰色渐变（bg-gradient-to-br from-gray-100 to-gray-200）
  - 圆角：圆角矩形（rounded-lg）
  - 阴影：轻微阴影（shadow-sm）
- **数字显示**：
  - 数值："9"
  - 字体大小：2xl（超大号字体）
  - 字体粗细：粗体（bold）
  - 颜色：绿色（text-green-600）
- **标签文本**：
  - 文本："可用技能"
  - 字体大小：xs（超小号字体）
  - 颜色：灰色（text-gray-600）
  - 顶部边距：1像素

#### 统计卡片3：对话次数
- **卡片样式**：
  - 内边距：4像素（p-4）
  - 背景：浅灰色到深灰色渐变（bg-gradient-to-br from-gray-100 to-gray-200）
  - 圆角：圆角矩形（rounded-lg）
  - 阴影：轻微阴影（shadow-sm）
- **数字显示**：
  - 数值："∞"（无限符号）
  - 字体大小：2xl（超大号字体）
  - 字体粗细：粗体（bold）
  - 颜色：紫色（text-purple-600）
- **标签文本**：
  - 文本："对话次数"
  - 字体大小：xs（超小号字体）
  - 颜色：灰色（text-gray-600）
  - 顶部边距：1像素

#### 主题适配
- **浅色主题**：
  - 卡片背景：灰色渐变背景
  - 文字颜色：深灰色
  - 统计数字：对应的彩色（蓝色、绿色、紫色）
- **深色主题**：
  - 卡片背景：深灰色背景（bg-gray-800）
  - 文字颜色：浅灰色（text-gray-400）
  - 统计数字：对应的浅彩色（蓝色、绿色、紫色，颜色更浅）

#### 交互特性
- **显示/隐藏**：根据是否选择智能体动态切换
- **居中布局**：始终保持垂直和水平居中
- **响应式设计**：根据屏幕大小自动调整卡片布局
- **数据展示**：实时显示当前系统的统计数据
### 2.3.3 交互流程

#### 欢迎页面显示交互流程
1. **页面初始加载**：
   - 页面加载完成
   - 检查是否有选中的智能体
   - 如果没有选中智能体：显示欢迎页面
   - 如果已选中智能体：隐藏欢迎页面，显示对应聊天内容
   - **用户体验增强**：
     - 显示页面加载骨架屏或加载动画（Loading Spinner）
     - 加载时间超过500ms时显示"正在加载..."提示文字
     - 加载时间超过2秒时显示进度条或环形进度指示器
     - 加载完成后平滑淡入欢迎页面内容，过渡时间300-500ms
     - 首次加载时显示引导提示："选择一个智能体开始对话"
2. **欢迎页面显示状态**：
   - 欢迎页面元素移除hidden类
   - 欢迎页面可见
   - 聊天内容面板保持隐藏
   - 统计卡片显示当前数据
   - **用户体验增强**：
     - 欢迎页面以淡入动画显示（opacity: 0 → 1，duration: 400ms）
     - 统计卡片依次延迟显示，创建阶梯式动画效果（staggered animation）
     - 卡片显示时配合轻微的缩放动画（scale: 0.95 → 1）
     - 如果数据未加载完成，显示加载占位符（Skeleton UI）
3. **数据加载**：
   - 从系统获取统计数据
   - 更新"可用智能体"数量
   - 更新"可用技能"数量
   - 显示"对话次数"为无限符号
   - 所有数据实时更新到对应的卡片
   - **用户体验增强**：
     - 数据加载时显示骨架屏占位符
     - 加载成功后数字以计数动画显示（count-up animation，duration: 1000ms）
     - 数据更新时显示刷新图标指示数据正在更新
     - 加载失败时显示错误提示："数据加载失败，点击重试"并提供重试按钮
     - 支持下拉刷新功能，用户可手动刷新统计数据
     - 刷新时显示"正在刷新..."提示，禁用刷新按钮防止重复点击

#### 选择智能体后隐藏交互流程
1. **用户点击智能体项**：
   - 触发智能体项的click事件
   - 执行智能体选择逻辑（见2.1.3章节）
   - **用户体验增强**：
     - 点击时显示按下反馈效果（scale: 0.98，duration: 100ms）
     - 显示选中状态指示器（勾选图标或边框高亮）
     - 如果智能体未就绪，显示提示："智能体正在准备中，请稍候..."
     - 点击后立即禁用智能体项，防止重复点击（duration: 500ms）
     - 显示加载指示器："正在加载对话历史..."
2. **欢迎页面隐藏**：
   - 查找欢迎页面元素（ID为welcomeContent）
   - 为欢迎页面元素添加hidden类
   - 欢迎页面从界面中消失
   - **用户体验增强**：
     - 欢迎页面以淡出动画隐藏（opacity: 1 → 0，duration: 300ms）
     - 配合translateY动画，向上滑动消失（translateY: 0 → -20px）
     - 动画完成后移除元素，避免占用DOM空间
     - 如果加载时间较长，显示进度指示："正在切换到对话模式..."
3. **聊天内容显示**：
   - 查找对应的聊天内容面板
   - 移除聊天内容面板的hidden类
   - 聊天内容面板显示在界面中
   - **用户体验增强**：
     - 聊天内容以淡入动画显示（opacity: 0 → 1，duration: 400ms）
     - 配合translateY动画，从下方滑入（translateY: 20px → 0）
     - 如果聊天历史加载时间超过1秒，显示骨架屏占位符
     - 加载完成后，消息气泡依次显示（staggered animation，间隔100ms）
     - 如果加载失败，显示错误提示："对话历史加载失败，请重试"并提供重试按钮
4. **界面状态更新**：
   - 顶部栏更新为选中的智能体信息
   - 侧边栏更新选中状态
   - 界面切换到对话模式
   - **用户体验增强**：
     - 顶部栏智能体信息以淡入动画更新（duration: 300ms）
     - 侧边栏选中项显示背景色渐变过渡
     - 显示状态提示："已切换到 [智能体名称]"
     - 提示信息3秒后自动消失（toast notification）
     - 如果智能体有在线状态，显示在线/离线指示器
5. **动画效果**：
   - 页面切换平滑过渡
   - 无突兀的显示/隐藏效果
   - **用户体验增强**：
     - 使用CSS transition实现所有动画（duration: 300-500ms）
     - 采用ease-out缓动函数，提供自然的运动效果
     - 支持减少动画选项（prefers-reduced-motion），尊重用户系统设置
     - 页面切换时锁定滚动，避免内容跳动
     - 切换完成后自动滚动到最新消息位置

#### 主题切换交互流程（欢迎页面）
1. **初始状态**：
   - 欢迎页面显示当前主题的样式
   - 浅色主题：
     - 统计卡片背景：灰色渐变背景（bg-gradient-to-br from-gray-100 to-gray-200）
     - 主标题颜色：深灰色
     - 描述文本颜色：灰色（text-gray-600）
     - 统计数字：深彩色（蓝色、绿色、紫色）
     - 标签文字：灰色（text-gray-600）
   - 深色主题：
     - 统计卡片背景：深灰色背景（bg-gray-800）
     - 主标题颜色：白色
     - 描述文本颜色：浅灰色（text-gray-400）
     - 统计数字：浅彩色（蓝色、绿色、紫色，颜色更浅）
     - 标签文字：浅灰色（text-gray-400）
2. **用户点击主题按钮**：
   - 触发click事件
   - 执行主题切换功能（与2.1章节相同）
   - **用户体验增强**：
     - 点击时显示按下反馈效果（scale: 0.95，duration: 150ms）
     - 按钮显示旋转动画（旋转180度，duration: 300ms）
     - 显示加载状态：按钮禁用，防止快速重复切换
     - 显示提示："正在切换主题..."（切换时间超过300ms时显示）
3. **欢迎页面样式更新**：
   - 更新主标题颜色
   - 更新描述文本颜色
   - 更新统计卡片背景：
     - 浅色主题：更新为灰色渐变背景
     - 深色主题：更新为深灰色背景
   - 更新统计数字颜色：
     - 可用智能体：蓝色（text-blue-600 ↔ text-blue-400）
     - 可用技能：绿色（text-green-600 ↔ text-green-400）
     - 对话次数：紫色（text-purple-600 ↔ text-purple-400）
   - 更新标签文字颜色（text-gray-600 ↔ text-gray-400）
   - **用户体验增强**：
     - 所有颜色变化使用CSS transition（duration: 300ms）
     - 背景色变化使用ease-in-out缓动函数
     - 文字颜色变化使用ease-out缓动函数
     - 统计卡片数字变化配合轻微的缩放效果（scale: 1.05 → 1，duration: 200ms）
     - 如果主题切换失败，显示错误提示："主题切换失败，请重试"并恢复原主题
4. **动画过渡**：
   - 所有样式变化都有transition-colors过渡效果
   - 平滑过渡到新主题
   - **用户体验增强**：
     - 使用CSS自定义属性（CSS Variables）实现主题切换
     - 过渡时间设置为300ms，确保视觉连贯性
     - 支持用户自定义过渡时间（可访问性设置）
     - 主题切换时显示全屏遮罩层（opacity: 0.1，duration: 200ms），避免闪烁
     - 遮罩层在过渡完成后自动消失
5. **欢迎图标**：
   - 欢迎图标保持不变
   - 蓝色到紫色渐变背景始终显示
   - 白色图标始终显示
   - **用户体验增强**：
     - 图标容器显示轻微的脉冲动画（pulse animation，仅在主题切换时）
     - 图标渐变背景保持一致性，不受主题影响
     - 主题切换成功后显示成功提示："已切换到 [深色/浅色] 模式"
     - 提示信息2秒后自动消失（toast notification）

#### 统计卡片交互流程
1. **初始状态**：
   - 统计卡片显示静态数据
   - 三个卡片横向排列
   - 卡片之间有间距
   - **用户体验增强**：
     - 卡片以淡入动画依次显示（staggered animation，间隔150ms）
     - 初始加载时显示骨架屏占位符（duration: 800ms）
     - 数据加载完成后，数字以计数动画显示（count-up animation，duration: 1000ms）
     - 如果数据加载失败，显示错误图标和"数据加载失败"提示
     - 提供重试按钮，点击后重新加载数据
2. **数据更新**：
   - 系统统计数据变化时
   - 自动更新对应卡片的数字显示
   - 数字立即更新，无需用户操作
   - **用户体验增强**：
     - 数据更新时显示刷新图标指示器（旋转动画）
     - 新旧数字以过渡动画切换（fade out → fade in，duration: 300ms）
     - 如果数据增加，数字显示绿色向上箭头指示器（↑）
     - 如果数据减少，数字显示红色向下箭头指示器（↓）
     - 箭头指示器3秒后自动消失
     - 显示"数据已更新"提示（toast notification，2秒后消失）
3. **卡片悬停效果**：
   - 用户将鼠标悬停在卡片上
   - 卡片可能有轻微的阴影加深效果
   - 鼠标移开后恢复原样
   - **用户体验增强**：
     - 阴影效果平滑过渡（box-shadow transition，duration: 200ms）
     - 卡片轻微上浮（translateY: -4px，duration: 200ms）
     - 卡片背景色轻微加深（opacity: 0.95 → 1）
     - 显示工具提示（tooltip），显示数据详细说明
     - 工具提示延迟300ms显示，避免误触发
     - 鼠标移开后，工具提示延迟100ms消失，提供流畅体验
4. **卡片点击效果**（如果支持）：
   - 如果卡片支持点击跳转
   - 用户点击卡片
   - 跳转到对应的功能页面
   - 如点击"可用智能体"跳转到智能体管理页面
   - **用户体验增强**：
     - 点击时显示按下反馈效果（scale: 0.97，duration: 100ms）
     - 显示涟漪效果（ripple effect），从点击位置扩散
     - 涟漪效果持续400ms后消失
     - 如果卡片可点击，显示鼠标指针样式（cursor: pointer）
     - 点击后显示加载状态："正在跳转..."
     - 如果跳转时间超过1秒，显示进度条指示器
     - 跳转失败时显示错误提示："页面跳转失败，请重试"
     - 提供重试按钮，点击后重新尝试跳转
5. **卡片加载状态**：
   - **用户体验增强**：
     - 数据加载时显示骨架屏占位符
     - 占位符使用脉冲动画（shimmer effect），模拟内容加载
     - 加载时间超过2秒时显示进度条
     - 进度条显示在卡片底部，宽度随加载进度变化
     - 加载完成后，骨架屏平滑淡出，实际内容淡入（duration: 300ms）
     - 如果加载超时（超过5秒），显示"加载超时"提示并提供重试选项

#### 响应式布局交互流程
1. **大屏幕显示**：
   - 屏幕宽度大于断点
   - 三个卡片横向排列（grid-cols-3）
   - 卡片保持较大尺寸
   - 字体大小为2xl
   - **用户体验增强**：
     - 使用CSS Grid实现灵活布局
     - 卡片间距设置为1.5rem，提供舒适的视觉空间
     - 卡片最小宽度280px，确保内容可读性
     - 鼠标悬停时显示更明显的阴影效果
     - 支持键盘导航（Tab键切换焦点）
     - 焦点显示清晰的边框轮廓（outline: 2px solid blue）
2. **中等屏幕显示**：
   - 屏幕宽度在中等范围
   - 三个卡片可能调整为2列布局
   - 卡片尺寸相应调整
   - 字体大小保持合适比例
   - **用户体验增强**：
     - 使用CSS媒体查询（@media）实现断点切换
     - 断点设置为768px（中等屏幕）
     - 布局切换时使用平滑过渡（transition: all 300ms ease）
     - 卡片间距调整为1rem，适应屏幕空间
     - 字体大小调整为xl，保持可读性
     - 显示"已切换到中等屏幕布局"提示（仅在调试模式下）
3. **小屏幕显示**：
   - 屏幕宽度小于断点
   - 三个卡片调整为1列布局
   - 卡片垂直排列
   - 卡片占满容器宽度
   - 字体大小适当调整
   - **用户体验增强**：
     - 断点设置为480px（小屏幕）
     - 卡片间距调整为0.75rem，最大化利用空间
     - 字体大小调整为lg，确保移动端可读性
     - 卡片高度自适应内容，避免内容溢出
     - 卡片最小触摸区域48x48px，符合移动端设计规范
     - 显示"已切换到移动端布局"提示（仅在调试模式下）
4. **自动切换**：
   - 浏览器窗口大小变化时
   - 自动检测屏幕宽度
   - 自动调整布局
   - 无需用户手动操作
   - **用户体验增强**：
     - 使用ResizeObserver API监听窗口变化
     - 防抖处理（debounce，延迟300ms执行），避免频繁重绘
     - 布局切换时显示加载骨架屏（duration: 200ms）
     - 骨架屏淡出后，新布局淡入（duration: 300ms）
     - 如果布局切换失败，显示错误提示："布局切换失败，请刷新页面"
     - 提供刷新按钮，点击后重新加载页面
     - 支持手动刷新布局（快捷键Ctrl/Cmd + R）
5. **触摸设备适配**：
   - 在触摸设备上适当调整间距
   - 确保触摸操作便捷
   - 卡片大小适合手指点击
   - **用户体验增强**：
     - 检测触摸设备（使用window.navigator.maxTouchPoints）
     - 增大可点击区域（padding增加到16px）
     - 移除hover效果，避免误触发
     - 点击时显示明显的反馈效果（scale: 0.98，duration: 100ms）
     - 支持长按操作（长按500ms显示上下文菜单）
     - 防止双击缩放（touch-action: manipulation）
     - 优化滚动性能（-webkit-overflow-scrolling: touch）
     - 显示"已优化为触摸操作模式"提示（仅在首次检测到触摸设备时）

#### 欢迎页面返回交互流程
1. **用户返回欢迎页面**：
   - 用户在对话界面操作
   - 可以通过某种方式返回欢迎页面（如取消选择智能体）
   - **用户体验增强**：
     - 提供返回按钮，点击后触发返回操作
     - 支持快捷键返回（Esc键或Ctrl/Cmd + K）
     - 点击返回按钮时显示确认对话框："确定要返回欢迎页面吗？"
     - 如果有未保存的对话，显示提示："检测到未保存的对话，是否继续？"
     - 提供选项："继续返回"或"留在当前页面"
     - 确认后禁用返回按钮，防止重复点击（duration: 500ms）
     - 显示加载状态："正在返回欢迎页面..."
2. **隐藏聊天内容**：
   - 查找所有聊天内容面板
   - 为所有聊天内容面板添加hidden类
   - 聊天内容从界面中消失
   - **用户体验增强**：
     - 聊天内容以淡出动画隐藏（opacity: 1 → 0，duration: 300ms）
     - 配合translateY动画，向下滑动消失（translateY: 0 → 20px）
     - 消息气泡依次隐藏，创建阶梯式动画效果（staggered animation，间隔100ms）
     - 隐藏完成后移除元素，避免占用DOM空间
     - 如果聊天内容加载未完成，取消加载请求，避免资源浪费
     - 显示清理提示："正在清理对话数据..."
3. **显示欢迎页面**：
   - 查找欢迎页面元素
   - 移除欢迎页面的hidden类
   - 欢迎页面重新显示在界面中
   - **用户体验增强**：
     - 欢迎页面以淡入动画显示（opacity: 0 → 1，duration: 400ms）
     - 配合translateY动画，从上方滑入（translateY: -20px → 0）
     - 统计卡片依次延迟显示（staggered animation，间隔150ms）
     - 如果统计数据已缓存，直接显示，无需重新加载
     - 如果统计数据已过期，显示加载指示器："正在更新统计数据..."
     - 加载完成后，数字以计数动画显示（count-up animation，duration: 1000ms）
     - 显示返回成功提示："已返回欢迎页面"（toast notification，2秒后消失）
4. **状态重置**：
   - 顶部栏恢复默认信息
   - 侧边栏清除选中状态
   - 界面返回到初始状态
   - **用户体验增强**：
     - 顶部栏信息以淡出动画重置（duration: 300ms）
     - 侧边栏选中状态以渐变动画清除（background-color transition，duration: 200ms）
     - 清理所有临时状态和缓存数据
     - 重置滚动位置到顶部
     - 如果有未完成的异步操作，取消这些操作
     - 显示状态重置提示："界面状态已重置"（仅在调试模式下）
5. **动画效果**：
   - 页面切换平滑过渡
   - 提供良好的用户体验
   - **用户体验增强**：
     - 使用CSS transition实现所有动画（duration: 300-500ms）
     - 采用ease-out缓动函数，提供自然的运动效果
     - 支持减少动画选项（prefers-reduced-motion），尊重用户系统设置
     - 页面切换时锁定滚动，避免内容跳动
     - 动画完成后自动解锁滚动
     - 如果动画失败（浏览器不支持），显示静态内容作为降级方案
     - 记录动画性能数据，用于优化（仅在调试模式下）
6. **异常处理**：
   - **用户体验增强**：
     - 如果返回操作失败，显示错误提示："返回失败，请重试"
     - 提供重试按钮，点击后重新尝试返回操作
     - 如果重试3次后仍失败，显示"请联系技术支持"提示
     - 提供技术支持联系方式或链接
     - 错误信息记录到日志，便于问题排查
     - 显示错误码和错误详情（仅在调试模式下）

#### 全局用户体验设计
1. **网络状态监控**：
   - **网络连接检测**：
     - 页面加载时检测网络连接状态
     - 使用navigator.onLine API检测在线/离线状态
     - 监听online/offline事件，实时更新网络状态
   - **网络状态提示**：
     - 网络离线时显示警告提示："网络已断开，部分功能可能不可用"
     - 提示显示在页面顶部，使用醒目的颜色（黄色或橙色）
     - 提示包含网络图标和状态文字
     - 网络恢复时显示成功提示："网络已恢复"
     - 提示3秒后自动消失
   - **离线模式处理**：
     - 离线时禁用需要网络的功能按钮（如数据刷新、上传等）
     - 显示"离线模式"指示器，提示用户当前状态
     - 支持离线缓存，已加载的数据可继续使用
     - 离线时显示最近一次数据更新时间
     - 提供"重试连接"按钮，点击后尝试重新连接
   - **网络慢速检测**：
     - 检测网络速度，慢速时显示提示："网络速度较慢，加载可能需要较长时间"
     - 慢速时优先加载核心内容，延迟加载非关键内容
     - 显示加载进度条，让用户了解加载进度
     - 超过30秒未响应时，显示"加载超时"提示并提供重试选项

2. **全局加载状态管理**：
   - **加载指示器**：
     - 全局加载时显示全屏遮罩层（opacity: 0.5）
     - 显示旋转加载动画（Loading Spinner）
     - 加载文字提示："正在加载..."或具体操作描述
     - 加载时间超过2秒时显示进度条或环形进度指示器
     - 加载完成后平滑淡出（duration: 300ms）
   - **局部加载状态**：
     - 局部区域加载时显示骨架屏占位符
     - 骨架屏使用脉冲动画（shimmer effect）
     - 加载完成后内容淡入（duration: 300ms）
     - 支持多个局部加载同时进行
   - **加载超时处理**：
     - 设置加载超时时间（默认5秒）
     - 超时后显示"加载超时"提示
     - 提供"重试"和"取消"两个选项
     - 用户选择"重试"时重新发起加载请求
     - 用户选择"取消"时取消加载并恢复原状态

3. **全局异常处理**：
   - **错误提示机制**：
     - 错误发生时显示友好的错误提示
     - 提示包含错误图标和错误描述
     - 错误提示显示3-5秒后自动消失
     - 提供错误详情展开功能，用户可查看更多信息
     - 错误信息记录到日志，便于问题排查
   - **错误分类处理**：
     - 网络错误：显示"网络连接失败，请检查网络设置"并提供重试按钮
     - 服务器错误：显示"服务器暂时不可用，请稍后再试"并提供重试按钮
     - 数据错误：显示"数据加载失败，请刷新页面"并提供刷新按钮
     - 权限错误：显示"您没有权限执行此操作"并提供帮助链接
     - 未知错误：显示"发生未知错误，请联系技术支持"并提供联系方式
   - **错误恢复机制**：
     - 自动重试机制：对于临时性错误，自动重试3次（间隔1秒）
     - 重试失败后，显示手动重试按钮
     - 提供降级方案：关键功能失败时，提供备用方案
     - 错误恢复后，显示"操作已恢复"提示
   - **错误上报**：
     - 自动上报错误信息到错误监控系统
     - 收集错误堆栈、用户操作路径、环境信息
     - 匿名处理用户数据，保护用户隐私
     - 提供用户反馈渠道，收集更多错误细节

4. **用户操作反馈**：
   - **成功提示**：
     - 操作成功时显示绿色成功提示
     - 提示包含成功图标和操作描述
     - 提示2秒后自动消失
     - 例如："保存成功"、"删除成功"等
   - **警告提示**：
     - 操作需要用户注意时显示黄色警告提示
     - 提示包含警告图标和警告描述
     - 提示5秒后自动消失
     - 例如："检测到未保存的更改"、"操作不可撤销"等
   - **信息提示**：
     - 提供用户需要了解的信息时显示蓝色信息提示
     - 提示包含信息图标和信息描述
     - 提示3秒后自动消失
     - 例如："已切换到深色模式"、"数据已更新"等
   - **确认对话框**：
     - 重要操作前显示确认对话框
     - 对话框包含操作描述、"确定"和"取消"按钮
     - "确定"按钮显示为主按钮（高亮样式）
     - "取消"按钮显示为次按钮（普通样式）
     - 支持Enter键确认，Esc键取消
     - 例如："确定要删除此项目吗？"

5. **无障碍访问支持**：
   - **键盘导航**：
     - 支持Tab键在可交互元素间切换焦点
     - 焦点显示清晰的边框轮廓（outline: 2px solid blue）
     - 支持Enter/Space键激活按钮和链接
     - 支持方向键在列表中导航
     - 提供焦点跳过链接（Skip to main content）
   - **屏幕阅读器支持**：
     - 所有交互元素提供ARIA属性
     - 图片提供alt描述
     - 表单元素提供label关联
     - 动态内容变化提供aria-live通知
     - 错误提示使用aria-live="polite"
   - **高对比度模式**：
     - 支持系统高对比度设置
     - 自动调整颜色对比度
     - 提供高对比度主题选项
     - 确保文本和背景对比度符合WCAG AA标准（至少4.5:1）
   - **文字大小调整**：
     - 支持系统字体大小设置
     - 文字大小可调整（100%-200%）
     - 布局自适应文字大小变化
     - 提供字体大小设置选项

6. **性能优化体验**：
   - **懒加载**：
     - 图片和内容使用懒加载
     - 滚动到可视区域时才加载内容
     - 显示加载占位符，提升视觉连续性
   - **缓存策略**：
     - 静态资源使用缓存，减少重复加载
     - API响应数据缓存，提升响应速度
     - 显示缓存状态指示器
     - 提供手动刷新缓存选项
   - **预加载**：
     - 预加载关键资源，提升首屏加载速度
     - 预测用户行为，提前加载可能需要的内容
     - 显示预加载进度，让用户了解加载状态
   - **性能监控**：
     - 监控页面加载性能（FCP、LCP、CLS等）
     - 性能数据上报到监控系统
     - 性能异常时显示优化建议
     - 提供性能报告（仅在调试模式下）
### 2.3.4 视觉设计要求

#### 整体布局设计
- **容器结构**：
  - 最大宽度限制：max-w-md（中等宽度容器）
  - 布局方式：Flexbox垂直居中布局
  - 垂直对齐：items-center（垂直居中）
  - 水平对齐：justify-center（水平居中）
  - 高度：h-full（占满容器高度）
  - 定位：flex items-center justify-center（绝对居中）
- **背景设计**：
  - 浅色主题：bg-gray-50（浅灰色背景）
  - 深色主题：bg-gray-900（深灰色背景）
- **内边距**：无额外内边距，依靠容器自身布局

#### 欢迎图标区域视觉设计
- **容器设计**：
  - 尺寸：96x96像素（w-24 h-24）
  - 外边距：水平自动，底部6像素（mx-auto mb-6）
  - 渐变背景：bg-gradient-to-br from-blue-500 to-purple-600（蓝色到紫色渐变）
  - 圆角：rounded-2xl（圆角矩形，16px圆角）
  - 布局：flex items-center justify-center（内容居中）
  - 定位：相对定位
- **图标设计**：
  - 类型：SVG图标（聊天图标）
  - 尺寸：56x56像素（w-14 h-14）
  - 颜色：白色（text-white）
  - 图标类型：聊天图标，包含3个消息点和对话气泡
- **主题适配**：
  - 浅色主题和深色主题保持一致
  - 蓝色到紫色渐变背景
  - 白色图标始终显示

#### 欢迎文本区域视觉设计
- **主标题设计**：
  - 文本内容："欢迎使用 AutoMate"
  - 字体大小：24px（text-2xl）
  - 字体粗细：粗体（font-bold）
  - 底部边距：12px（mb-3）
  - 文本对齐：text-center（居中对齐）
  - 浅色主题颜色：继承父元素（text-gray-900）
  - 深色主题颜色：text-white
- **描述文本设计**：
  - 文本内容："选择左侧的智能体开始对话，体验智能化的任务处理"
  - 字体大小：16px（text-base）
  - 底部边距：24px（mb-6）
  - 文本对齐：text-center（居中对齐）
  - 浅色主题颜色：text-gray-600（灰色）
  - 深色主题颜色：text-gray-400（浅灰色）
  - 行高：默认1.5倍行高
- **间距设计**：
  - 主标题与描述文本间距：12px
  - 描述文本与统计卡片间距：24px

#### 统计卡片区域视觉设计
- **容器设计**：
  - 布局方式：网格布局（grid）
  - 列数：3列（grid-cols-3）
  - 卡片间距：16px（gap-4）
  - 文本对齐：text-center（居中对齐）
- **卡片样式（浅色主题）**：
  - 内边距：16px（p-4）
  - 背景：bg-gradient-to-br from-gray-100 to-gray-200（浅灰色渐变）
  - 圆角：rounded-lg（圆角矩形，8px圆角）
  - 阴影：shadow-sm（轻微阴影）
  - 过渡效果：hover时可能加深阴影
- **卡片样式（深色主题）**：
  - 内边距：16px（p-4）
  - 背景：bg-gray-800（深灰色背景）
  - 圆角：rounded-lg（圆角矩形，8px圆角）
  - 阴影：shadow-sm（轻微阴影）
  - 过渡效果：hover时可能加深阴影

#### 统计卡片1：可用智能体
- **数字显示**：
  - 数值："3"
  - 字体大小：24px（text-2xl）
  - 字体粗细：粗体（font-bold）
  - 浅色主题颜色：text-blue-600（深蓝色）
  - 深色主题颜色：text-blue-400（浅蓝色）
- **标签文本**：
  - 文本："可用智能体"
  - 字体大小：12px（text-xs）
  - 顶部边距：4px（mt-1）
  - 浅色主题颜色：text-gray-600（灰色）
  - 深色主题颜色：text-gray-400（浅灰色）

#### 统计卡片2：可用技能
- **数字显示**：
  - 数值："9"
  - 字体大小：24px（text-2xl）
  - 字体粗细：粗体（font-bold）
  - 浅色主题颜色：text-green-600（深绿色）
  - 深色主题颜色：text-green-400（浅绿色）
- **标签文本**：
  - 文本："可用技能"
  - 字体大小：12px（text-xs）
  - 顶部边距：4px（mt-1）
  - 浅色主题颜色：text-gray-600（灰色）
  - 深色主题颜色：text-gray-400（浅灰色）

#### 统计卡片3：对话次数
- **数字显示**：
  - 数值："∞"（无限符号）
  - 字体大小：24px（text-2xl）
  - 字体粗细：粗体（font-bold）
  - 浅色主题颜色：text-purple-600（深紫色）
  - 深色主题颜色：text-purple-400（浅紫色）
- **标签文本**：
  - 文本："对话次数"
  - 字体大小：12px（text-xs）
  - 顶部边距：4px（mt-1）
  - 浅色主题颜色：text-gray-600（灰色）
  - 深色主题颜色：text-gray-400（浅灰色）

#### 配色方案
- **主色调**：
  - 蓝色渐变：from-blue-500 to-blue-600 / from-blue-400 to-blue-600
  - 紫色渐变：from-purple-500 to-purple-600 / from-purple-400 to-purple-600
  - 橙色渐变：from-orange-500 to-orange-600 / from-orange-400 to-orange-600
  - 绿色：text-green-600 / text-green-400
- **欢迎图标渐变**：from-blue-500 to-purple-600（蓝色到紫色）
- **统计数字颜色**：
  - 可用智能体：蓝色（text-blue-600 / text-blue-400）
  - 可用技能：绿色（text-green-600 / text-green-400）
  - 对话次数：紫色（text-purple-600 / text-purple-400）
- **背景色**：
  - 浅色主题：bg-gray-50（容器）、bg-gradient-to-br from-gray-100 to-gray-200（卡片）
  - 深色主题：bg-gray-900（容器）、bg-gray-800（卡片）
- **文字颜色**：
  - 浅色主题：text-gray-900（主标题）、text-gray-600（描述和标签）
  - 深色主题：text-white（主标题）、text-gray-400（描述和标签）

#### 过渡动画
- **卡片悬停效果**：
  - 过渡属性：transition-colors或transition-all
  - 过渡时间：0.2s
  - 过渡效果：ease
  - 悬停时：轻微阴影加深效果
- **主题切换效果**：
  - 过渡属性：transition-colors
  - 过渡时间：0.3s
  - 过渡效果：ease
  - 所有颜色变化都有平滑过渡
- **页面切换效果**：
  - 欢迎页面显示/隐藏：hidden类的添加/移除
  - 无额外动画，保持简洁

#### 响应式设计
- **桌面端（大屏幕）**：
  - 三个卡片横向排列（grid-cols-3）
  - 容器最大宽度：max-w-md
  - 字体大小：text-2xl（24px）用于统计数字
- **平板端（中等屏幕）**：
  - 可能调整为2列布局（grid-cols-2）
  - 容器宽度自适应
  - 字体大小保持合适比例
- **移动端（小屏幕）**：
  - 调整为1列布局（grid-cols-1）
  - 卡片垂直排列
  - 卡片占满容器宽度
  - 可能减小字体大小
- **触摸设备适配**：
  - 卡片高度适合手指点击（至少44x44px）
  - 间距适当增大，便于触摸操作

#### 按钮位置
- **无按钮设计**：欢迎页面不包含任何按钮
- **交互方式**：通过点击左侧智能体列表项进入对话
- **返回方式**：可以通过取消选择智能体返回欢迎页面

#### 可访问性设计
- **对比度**：符合WCAG 2.1标准，对比度至少4.5:1
- **字体大小**：最小12px（text-xs），统计数字24px（text-2xl）
- **语义化标签**：使用h2作为主标题，p作为描述文本
- **文本对齐**：所有文本居中对齐，便于阅读
- **屏幕阅读器**：支持屏幕阅读器正确朗读内容

#### 整体风格
- **设计理念**：简洁、现代、扁平化
- **阴影使用**：轻微阴影（shadow-sm），不过度使用
- **渐变应用**：仅在欢迎图标和卡片背景使用渐变
- **圆角设计**：适度圆角（8px-16px），保持友好感
- **间距统一**：使用Tailwind的间距系统（4px基准）


## 2.4 系统设置
### 2.4.1 参考原型设计页面
    MainLayout.html
### 2.4.2 功能流程

#### 设置入口
- **位置**：左侧边栏底部区域
- **容器样式**：
  - 内边距：4像素（p-4）
  - 边框：顶部边框，灰色边框（border-t border-gray-200）
  - 布局：水平排列，两端对齐（flex items-center justify-between）

#### 设置按钮组
- **布局方式**：水平排列，按钮之间间距为2像素（gap-2）
- **按钮容器**：每个按钮都有提示框容器（tooltip-container）

#### 主题切换按钮
- **按钮样式**：
  - 布局：水平排列，图标和文本间距2像素（flex items-center gap-2）
  - 内边距：水平3像素，垂直2像素（px-3 py-2）
  - 圆角：圆角矩形（rounded-lg）
  - 悬停效果：灰色背景（hover:bg-gray-200）
  - 过渡动画：颜色过渡效果（transition-colors）
- **图标**：
  - 类型：SVG图标（太阳/月亮图标）
  - 尺寸：4x4像素
  - 颜色：灰色（text-gray-400）
  - 图标路径：太阳/月亮图标路径
- **文本标签**：
  - 文本内容："主题"
  - 字体大小：小号字体（text-sm）
  - 颜色：灰色（text-gray-600）
- **提示框**：
  - 位置：按钮左侧
  - 内容："主题"
  - 样式：深色背景，白色文字
  - 显示条件：侧边栏收缩时悬停显示
- **功能**：
  - 点击切换浅色/深色主题
  - 图标根据当前主题变化（太阳/月亮）
  - 主题设置保存到localStorage

#### 系统设置按钮
- **按钮样式**：
  - 布局：水平排列，图标和文本间距2像素（flex items-center gap-2）
  - 内边距：水平3像素，垂直2像素（px-3 py-2）
  - 圆角：圆角矩形（rounded-lg）
  - 悬停效果：灰色背景（hover:bg-gray-200）
  - 过渡动画：颜色过渡效果（transition-colors）
- **图标**：
  - 类型：SVG图标（齿轮图标）
  - 尺寸：4x4像素
  - 颜色：灰色（text-gray-400）
  - 图标路径：齿轮图标路径（复杂齿轮形状）
- **文本标签**：
  - 文本内容："设置"
  - 字体大小：小号字体（text-sm）
  - 颜色：灰色（text-gray-600）
- **提示框**：
  - 位置：按钮左侧
  - 内容："设置"
  - 样式：深色背景，白色文字
  - 显示条件：侧边栏收缩时悬停显示
- **功能**：
  - 点击打开系统设置面板
  - 设置面板包含各种系统配置选项

#### 状态信息区域
- **布局方式**：水平排列，项目间距4像素（flex items-center gap-4）
- **状态指示**：
  - 图标：圆形状态指示器（2x2像素）
  - 颜色：绿色（bg-green-500）表示在线
  - 文本："在线"
  - 字体大小：超小号字体（text-xs）
  - 颜色：灰色（text-gray-500）
- **版本信息**：
  - 文本："v1.0.0"
  - 字体大小：超小号字体（text-xs）
  - 颜色：灰色（text-gray-500）

#### 深色主题适配
- **容器样式**：
  - 边框：深灰色边框（border-gray-700）
  - 背景：深灰色背景
- **按钮样式**：
  - 悬停效果：深灰色背景（hover:bg-gray-700）
- **图标颜色**：浅灰色（text-gray-300）
- **文本颜色**：浅灰色（text-gray-300）
- **状态信息**：
  - 文本颜色：浅灰色（text-gray-500）

#### 侧边栏收缩状态
- **按钮布局**：当侧边栏收缩时，按钮变为竖向排列
- **文本隐藏**：按钮文本和提示框文本隐藏
- **图标居中**：图标居中显示
- **按钮尺寸**：按钮变为方形，40x40像素
- **提示框显示**：收缩状态下悬停显示提示框

#### 交互特性
- **主题切换**：即时切换，保存到本地存储
- **设置面板**：点击打开设置面板，包含详细配置选项
- **提示框**：收缩状态下提供按钮功能说明
- **响应式设计**：根据侧边栏状态自动调整按钮布局
- **过渡动画**：所有颜色和布局变化都有平滑过渡效果
### 2.4.3 交互流程

#### 主题切换按钮交互流程
1. **初始状态**：
   - 主题按钮显示当前主题对应的图标
   - 浅色主题：显示太阳图标
   - 深色主题：显示月亮图标
   - 按钮显示"主题"文本
   - 按钮处于可交互状态，鼠标指针为pointer
2. **用户点击主题按钮**：
   - 触发click事件
   - 按钮立即显示按下效果（transform: scale(0.95)）
   - 按钮背景色短暂加深，提供触觉反馈
   - 检查body元素的class列表
   - 判断当前主题类型
3. **主题类型判断**：
   - 如果body包含dark-theme类：当前为深色主题
   - 如果body包含light-theme类：当前为浅色主题
   - 判断过程在100ms内完成，确保即时响应
4. **确定新主题**：
   - 如果当前为浅色主题：新主题为深色主题
   - 如果当前为深色主题：新主题为浅色主题
   - 按钮图标开始旋转动画，持续200ms
5. **应用新主题**：
   - 调用setTheme函数
   - 传入新主题类型（'light'或'dark'）
   - 函数执行时间控制在50ms内
6. **样式更新**（以切换到深色主题为例）：
   - 更新body背景和文字颜色
   - 更新侧边栏所有元素的样式
   - 更新主内容区所有元素的样式
   - 更新聊天窗口所有元素的样式
   - 更新欢迎页面所有元素的样式
   - 更新底部设置区域所有元素的样式
   - 所有样式变化使用transition-colors，过渡时间为300ms
7. **图标更新**：
   - 更新主题按钮的SVG内容
   - 浅色主题：更新为太阳图标（太阳光线图标）
   - 深色主题：更新为月亮图标（弯月图标）
   - 图标切换带有淡入淡出动画，持续时间200ms
8. **数据保存**：
   - 将新主题保存到localStorage
   - 键名为"theme"
   - 值为"light"或"dark"
   - 保存操作在后台异步执行，不阻塞UI
9. **即时反馈**：
   - 所有样式变化立即生效
   - 过渡动画平滑执行
   - 按钮恢复正常状态（transform: scale(1)）
   - 如果数据保存成功，显示简短的成功提示（可选）
10. **异常处理**：
    - 如果localStorage写入失败，显示轻量级错误提示
    - 错误提示在按钮上方显示，2秒后自动消失
    - 提示内容："主题保存失败，但已应用临时主题"
    - 界面仍然显示新主题，不影响用户体验
11. **防抖处理**：
    - 300ms内禁止重复点击
    - 避免用户快速连续点击导致主题闪烁
    - 按钮在处理期间显示轻微禁用状态（opacity: 0.7）
12. **响应时间要求**：
    - 整体响应时间<100ms（从点击到开始显示变化）
    - 完整过渡时间<300ms（所有样式变化完成）
    - 如果响应时间超过500ms，显示加载指示器（小旋转图标）

#### 系统设置按钮交互流程
1. **初始状态**：
   - 设置按钮显示齿轮图标
   - 设置按钮文本显示"设置"
   - 设置面板未打开
   - 按钮处于可交互状态，鼠标指针为pointer
   - 按钮在悬停时显示轻微背景色变化
2. **用户点击设置按钮**：
   - 触发click事件
   - 按钮立即显示按下效果（transform: scale(0.95)）
   - 按钮背景色短暂加深，提供触觉反馈
   - 显示加载指示器（小旋转齿轮图标），持续时间<200ms
   - 执行设置功能
3. **打开设置面板**：
   - 显示系统设置面板（模态框或独立页面）
   - 面板从底部向上滑入，动画时间300ms，使用ease-out缓动
   - 面板背景使用半透明遮罩层（backdrop-filter: blur(4px)）
   - 设置面板包含以下选项：
     - 系统偏好设置
     - 账户管理
     - 通知设置
     - 数据管理
     - 关于信息
   - 面板打开时聚焦到第一个可交互元素，便于键盘导航
4. **设置面板显示状态**：
   - 设置面板覆盖在主内容区上方
   - 主界面内容保持可见但不可交互（pointer-events: none）
   - 设置面板有独立的滚动区域，支持鼠标滚轮和触摸滑动
   - 面板最大高度为视口高度的80%，超出时显示滚动条
   - 滚动条使用自定义样式，宽度为8px，圆角设计
5. **设置选项交互**：
   - 用户可以在设置面板中：
     - 修改系统偏好设置（如语言、默认主题等）
     - 管理账户信息
     - 配置通知选项
     - 管理本地数据（清除缓存等）
     - 查看应用版本和关于信息
   - 每个设置选项在修改时显示即时预览效果
   - 选项之间有明显的视觉分隔和分组
   - 复杂设置（如语言选择）显示下拉菜单，带有平滑展开动画
   - 开关类型的设置使用滑动开关，带有过渡动画
6. **保存设置**：
   - 用户修改设置后点击保存按钮
   - 按钮显示加载状态（旋转图标 + 文本变为"保存中..."）
   - 系统验证设置的有效性，验证时间<500ms
   - 如果验证失败，显示具体的错误信息（如"邮箱格式不正确"）
   - 错误信息在对应选项下方显示，红色文字，2秒后自动消失
   - 保存设置到localStorage或配置文件，异步执行不阻塞UI
   - 保存成功后按钮显示成功状态（绿色勾选图标 + "已保存"）
   - 显示保存成功提示（Toast消息），在屏幕顶部显示2秒后自动消失
   - 提示消息带有淡入淡出动画，持续300ms
7. **关闭设置面板**：
   - 用户点击关闭按钮或点击面板外部
   - 面板从下向上滑出，动画时间300ms，使用ease-in缓动
   - 遮罩层逐渐淡出，透明度从0.5变为0
   - 设置面板从界面中消失
   - 主界面恢复可交互状态（pointer-events: auto）
   - 设置更改立即生效
   - 关闭按钮在面板动画完成后才完全消失，避免闪烁
8. **异常处理**：
   - 如果设置面板加载失败，显示错误提示："设置面板加载失败，请重试"
   - 如果保存设置失败，显示错误提示："保存失败，请检查网络连接"
   - 错误提示提供"重试"按钮，点击后重新执行保存操作
   - 如果连续3次保存失败，建议用户刷新页面或联系技术支持
9. **响应时间要求**：
   - 设置面板打开时间<300ms（从点击到完全显示）
   - 设置选项切换响应时间<100ms（即时响应）
   - 保存操作完成时间<2秒（包括验证和保存）
   - 面板关闭时间<300ms（完全消失）
10. **可访问性设计**：
    - 支持键盘操作：ESC键关闭面板，Tab键在选项间导航
    - 设置面板打开时，焦点进入面板内
    - 面板关闭后，焦点返回到设置按钮
    - 所有可交互元素有清晰的焦点状态（outline: 2px solid blue）
    - 面板打开时，主界面元素设置为aria-hidden="true"

#### 按钮悬停效果交互流程
1. **初始状态**：
   - 按钮显示默认样式
   - 图标为灰色（text-gray-400）
   - 文本为灰色（text-gray-600）
   - 鼠标指针为pointer，提示可点击
   - 按钮处于ready状态，无特殊视觉效果
2. **用户悬停在按钮上**：
   - 触发hover事件
   - 鼠标指针变为手型（cursor: pointer），增强可点击暗示
   - 按钮背景变为灰色（hover:bg-gray-200）
   - 深色主题下背景变为深灰色（hover:bg-gray-700）
   - 按钮轻微放大（transform: scale(1.02)），提供悬浮感
   - 按钮阴影略微加深（shadow-md），增强立体感
   - 图标轻微旋转5度，增加动态效果
3. **图标和文本变化**：
   - 浅色主题下：
     - 图标颜色加深（text-gray-500），提升可读性
     - 文本颜色加深（text-gray-700），增强视觉对比
   - 深色主题下：
     - 图标颜色变浅（text-gray-200），提升在深色背景上的可见度
     - 文本颜色变浅（text-gray-200），增强可读性
   - 图标和文本变化同步进行，保持一致性
4. **过渡效果**：
   - 所有颜色变化都有transition-colors过渡
   - 过渡时间通常为0.2秒（200ms）
   - 过渡效果为ease，确保平滑自然
   - 按钮缩放使用transform过渡，时间150ms
   - 阴影变化使用box-shadow过渡，时间200ms
   - 所有过渡使用GPU加速，确保流畅度
5. **鼠标移开**：
   - 触发鼠标移出事件
   - 按钮恢复到默认样式
   - 颜色平滑过渡回原始状态
   - 按钮缩放恢复到原始大小
   - 阴影恢复到默认状态
   - 图标旋转回原始角度
   - 所有过渡时间与悬停时保持一致，确保对称性
6. **点击反馈**：
   - 用户点击按钮时（mousedown事件）
   - 按钮立即缩小（transform: scale(0.95)）
   - 背景色进一步加深，提供按压感
   - 点击持续时间<50ms，确保即时响应
   - 释放按钮时（mouseup事件）
   - 按钮恢复到悬停状态
   - 按钮缩放恢复到1.02倍
   - 背景色恢复到悬停颜色
7. **焦点状态（键盘导航）**：
   - 使用Tab键导航时，按钮获得焦点
   - 显示焦点指示器（outline: 2px solid blue）
   - 焦点指示器不占用布局空间（outline-offset: 2px）
   - 焦点状态与悬停效果叠加显示
   - 按LostFocus事件时，焦点指示器消失
8. **响应性能要求**：
   - 悬停响应时间<50ms（从鼠标进入到开始显示效果）
   - 过渡动画完成时间<200ms（完全显示悬停状态）
   - 鼠标移开响应时间<50ms（从鼠标离开到开始恢复）
   - 恢复动画完成时间<200ms（完全恢复到初始状态）
   - 所有动画帧率保持60fps，确保流畅度
9. **可访问性优化**：
   - 减少动画选项：如果用户在系统设置中关闭了动画，则使用0ms过渡时间
   - 高对比度模式：如果用户启用高对比度模式，则使用更明显的颜色变化
   - 悬停效果不依赖鼠标，支持触摸设备的悬停模拟
   - 触摸设备上，使用active状态替代hover状态
10. **性能优化**：
    - 使用CSS transform代替top/left属性，减少重排
    - 使用opacity和transform进行动画，触发GPU加速
    - 避免在hover时触发复杂计算或网络请求
    - 使用will-change属性提前告知浏览器动画属性
    - 避免频繁的DOM读写操作

#### 提示框显示交互流程
1. **侧边栏展开状态**：
   - 按钮显示文本和图标
   - 提示框不显示
   - 用户可以直接看到按钮功能
   - 按钮文本清晰可见，无需额外提示
2. **用户点击收缩按钮**：
   - 侧边栏收缩为60像素宽度
   - 按钮变为竖向排列
   - 按钮文本隐藏（使用opacity: 0，不占用布局空间）
   - 按钮图标居中显示
   - 收缩动画持续300ms，使用ease缓动
   - 收缩完成后，提示框功能自动激活
3. **用户悬停在按钮上**：
   - 触发hover事件
   - 延迟150ms后检测侧边栏是否为收缩状态（避免误触）
   - 如果为收缩状态：显示提示框
   - 如果为展开状态：不显示提示框
   - 如果鼠标在150ms内移开，则不显示提示框（防抖动）
4. **提示框显示逻辑**：
   - 提示框在按钮左侧显示
   - 提示框内容为按钮功能说明
   - 主题按钮：显示"主题"
   - 设置按钮：显示"设置"
   - 提示框位置相对于按钮计算，确保不会超出屏幕边界
   - 如果屏幕空间不足，自动调整提示框位置（如从左侧改为右侧）
5. **提示框样式**：
   - 深色背景（bg-gray-800）
   - 白色文字（text-white）
   - 圆角矩形（rounded-md，6px圆角）
   - 有边框（border border-gray-700）
   - 有箭头指向按钮（使用CSS伪元素::after创建）
   - 内边距：4px垂直，8px水平
   - 字体大小：12px
   - 字体粗细：正常
   - 阴影效果（shadow-lg），确保在复杂背景下可见
   - 最大宽度：200px，超出内容自动换行
6. **提示框动画**：
   - 显示动画：
     - 从opacity: 0和transform: translateY(5px)开始
     - 过渡到opacity: 1和transform: translateY(0)
     - 动画时间：200ms
     - 缓动效果：ease-out
   - 隐藏动画：
     - 从opacity: 1和transform: translateY(0)开始
     - 过渡到opacity: 0和transform: translateY(5px)
     - 动画时间：150ms
     - 缓动效果：ease-in
   - 使用GPU加速，确保流畅度
7. **鼠标移开**：
   - 触发鼠标移出事件
   - 提示框开始隐藏动画
   - 动画完成后提示框从DOM中移除（或使用visibility: hidden）
   - 不影响其他元素的显示
   - 延迟50ms后开始隐藏，允许用户快速移动鼠标到提示框上
   - 如果用户鼠标移到提示框上，提示框保持显示
8. **点击按钮**：
   - 提示框立即隐藏（无动画，瞬间消失）
   - 执行按钮对应的功能
   - 不触发提示框的显示逻辑
   - 按钮点击后，提示框不会再次显示，直到鼠标移开再重新悬停
9. **异常情况处理**：
   - 如果提示框内容过长，自动截断并添加省略号（...）
   - 如果屏幕空间不足无法显示提示框，则在按钮下方显示
   - 如果用户在提示框显示期间点击其他地方，提示框立即隐藏
   - 如果提示框动画被中断（如用户快速移动鼠标），则直接跳到最终状态
10. **响应性能要求**：
    - 提示框显示延迟时间：150ms（从悬停到开始显示）
    - 提示框完全显示时间：<350ms（从悬停到完全显示）
    - 提示框隐藏延迟时间：50ms（从移开到开始隐藏）
    - 提示框完全隐藏时间：<200ms（从移开到完全消失）
    - 提示框位置计算时间：<16ms（每帧）
11. **可访问性设计**：
    - 提示框内容使用aria-label或title属性提供
    - 支持屏幕阅读器朗读提示框内容
    - 提示框不接收键盘焦点（避免干扰导航）
    - 如果用户使用键盘导航按钮，显示持久的提示框（而非悬停显示）
    - 提示框文字对比度符合WCAG 2.1标准（至少4.5:1）
12. **触摸设备适配**：
    - 触摸设备上，长按按钮显示提示框（长按500ms）
    - 提示框显示后，点击提示框外部区域隐藏提示框
    - 提示框显示后，提供"关闭"按钮供用户主动关闭
    - 触摸设备上提示框尺寸增大（最小44x44px），便于点击
    - 支持多点触控，避免误触关闭提示框

#### 状态信息更新交互流程
1. **初始状态**：
   - 状态指示器显示绿色圆点
   - 状态文本显示"在线"
   - 版本信息显示"v1.0.0"
   - 状态指示器带有轻微的脉冲动画（2秒周期，表示系统活跃）
   - 所有元素使用稳定的颜色，无闪烁
2. **连接状态变化**：
   - 系统每5秒检测一次网络连接状态
   - 检测使用Navigator.onLine API和后端心跳检测相结合
   - 如果在线：
     - 状态指示器保持绿色（bg-green-500）
     - 状态文本保持"在线"
     - 脉冲动画继续，表示网络稳定
   - 如果离线：
     - 状态指示器变为红色（bg-red-500）
     - 状态文本变为"离线"
     - 脉冲动画停止，改为闪烁动画（1秒周期，提示用户注意）
     - 显示离线提示Toast消息："网络连接已断开，部分功能可能受限"
     - Toast消息持续3秒后自动消失
   - 状态变化带有颜色过渡动画，持续时间300ms，使用ease-in-out缓动
   - 文本变化带有淡入淡出效果，持续时间200ms
3. **版本信息更新**：
   - 应用启动时自动检测版本号
   - 每隔24小时检查一次版本更新（后台静默检查）
   - 如果发现新版本：
     - 版本号旁边显示更新图标（蓝色箭头向上）
     - 点击更新图标显示更新详情弹窗
     - 弹窗内容包括：当前版本、新版本、更新说明、更新按钮
     - 更新按钮带有加载状态（旋转图标 + "更新中..."）
     - 更新进度显示进度条，实时更新百分比
     - 更新完成后显示"更新成功"提示，2秒后自动消失
     - 自动刷新页面或提示用户刷新页面
   - 更新版本信息显示
   - 无需用户操作
   - 版本号使用等宽字体（font-mono），便于对比
4. **状态动画**：
   - 状态变化时有轻微的过渡效果
   - 颜色平滑过渡，使用transition-colors属性
   - 文本立即更新，但带有淡入淡出效果
   - 在线状态的脉冲动画：opacity从0.6到1.0，持续2秒，使用ease-in-out缓动
   - 离线状态的闪烁动画：opacity从1.0到0.5，持续1秒，使用ease-in-out缓动
   - 所有动画使用CSS keyframes，性能优化
5. **异常状态处理**：
   - 如果网络检测失败，显示警告状态（黄色圆点）
   - 警告文本："网络检测失败"
   - 警告动画：快速闪烁（0.5秒周期），持续10秒后恢复检测
   - 如果连续3次检测失败，显示错误提示："网络检测异常，请检查网络设置"
   - 如果版本检测失败，显示版本号为"未知"，但不影响正常使用
   - 如果更新下载失败，显示错误提示："更新下载失败，请稍后重试"
   - 错误提示提供"重试"按钮，点击后重新下载
6. **响应时间要求**：
   - 网络状态检测时间<100ms（每次检测）
   - 状态变化响应时间<200ms（从检测到状态改变）
   - 颜色过渡完成时间<300ms（完全显示新颜色）
   - 版本检测时间<1秒（后台检测）
   - 更新下载进度更新时间<100ms（每次进度更新）
   - 所有动画帧率保持60fps，确保流畅度
7. **用户交互设计**：
   - 点击状态指示器显示详细网络信息弹窗
   - 弹窗内容：网络类型、连接质量、延迟、丢包率等
   - 网络信息实时更新，每1秒刷新一次
   - 点击版本信息显示更新历史记录
   - 更新历史记录显示最近5次更新，包括版本号、更新时间、更新内容
   - 长按状态指示器3秒，手动触发网络检测（立即执行）
   - 长按版本信息3秒，手动触发版本检测（立即执行）
   - 手动触发时显示加载指示器（旋转图标）
8. **可访问性设计**：
   - 状态指示器使用aria-live属性，支持屏幕阅读器实时朗读状态变化
   - 状态文本使用role="status"，语义化明确
   - 颜色变化不仅依赖颜色，还配合图标形状变化（如在线用圆点，离线用方块）
   - 支持高对比度模式，状态指示器颜色更加鲜明
   - 支持减少动画选项，如果用户关闭动画，则取消脉冲和闪烁效果
   - 状态变化时，屏幕阅读器朗读："状态已更新为：在线/离线"
9. **性能优化**：
   - 网络检测使用节流（throttle），避免频繁检测
   - 状态更新使用requestAnimationFrame，确保动画流畅
   - 版本检测使用Web Worker，避免阻塞主线程
   - 更新下载使用分块下载，支持断点续传
   - 所有动画使用CSS transform和opacity，触发GPU加速
   - 避免在状态更新时进行复杂的DOM操作

#### 深色主题适配交互流程
1. **初始状态（浅色主题）**：
   - 容器边框：灰色边框（border-gray-200）
   - 按钮悬停：灰色背景（hover:bg-gray-200）
   - 图标颜色：灰色（text-gray-400）
   - 文本颜色：灰色（text-gray-600）
   - 状态文本：灰色（text-gray-500）
2. **用户切换到深色主题**：
   - 触发主题切换（见主题切换按钮交互流程）
3. **深色主题样式应用**：
   - 容器边框更新为深灰色（border-gray-700）
   - 按钮悬停背景更新为深灰色（hover:bg-gray-700）
   - 图标颜色更新为浅灰色（text-gray-300）
   - 文本颜色更新为浅灰色（text-gray-300）
   - 状态文本颜色更新为浅灰色（text-gray-500）
4. **颜色对比度保持**：
   - 确保所有文字在深色背景上清晰可读
   - 保持足够的对比度
   - 符合可访问性标准
5. **动画过渡**：
   - 所有颜色变化都有过渡效果
   - 平滑过渡到深色主题

#### 侧边栏收缩交互流程
1. **初始状态（展开）**：
   - 侧边栏宽度为320像素（w-80）
   - 设置区域按钮横向排列
   - 按钮显示图标和文本
   - 提示框不显示
   - 按钮文本清晰可见，间距合理（gap-2，8px）
   - 收缩按钮显示"收缩"图标（左箭头）
   - 鼠标悬停收缩按钮时，显示提示："收缩侧边栏"
2. **用户点击侧边栏收缩按钮**：
   - 触发click事件
   - 收缩按钮立即显示按下效果（transform: scale(0.95)）
   - 切换侧边栏的sidebar-collapsed类
   - 显示加载指示器（小旋转图标），持续时间<100ms
   - 按钮图标从左箭头变为右箭头，带有旋转动画（180度）
   - 收缩状态保存到localStorage，键名为"sidebarCollapsed"，值为true
3. **收缩状态变化**：
   - 侧边栏宽度从320px过渡到60px
   - 过渡时间为0.3秒（300ms）
   - 过渡效果为ease-in-out，确保流畅自然
   - 使用CSS transition属性，触发GPU加速
   - 主内容区宽度自动扩展，填充可用空间
   - 主内容区过渡时间与侧边栏一致，保持同步
4. **设置区域布局调整**：
   - 按钮布局从横向变为竖向
   - 按钮间距从gap-2（8px）变为固定8px
   - 按钮尺寸调整为40x40像素方形（w-10 h-10）
   - 按钮文本隐藏（使用opacity: 0，不占用布局空间）
   - 按钮图标居中显示（flex justify-center items-center）
   - 按钮圆角从rounded-lg（8px）调整为rounded（4px）
   - 布局过渡时间200ms，与侧边栏收缩同步进行
5. **提示框功能启用**：
   - 悬停按钮时显示提示框
   - 提示框在按钮左侧显示
   - 提示框内容为按钮功能说明
   - 提示框延迟150ms后显示（避免误触）
   - 提示框带有淡入淡出动画，持续200ms
   - 提示框箭头指向按钮，确保视觉关联性
   - 提示框最大宽度200px，超出内容自动换行
6. **用户再次点击收缩按钮**：
   - 触发click事件
   - 收缩按钮立即显示按下效果（transform: scale(0.95)）
   - 移除sidebar-collapsed类
   - 按钮图标从右箭头变为左箭头，带有旋转动画（180度）
   - 收缩状态保存到localStorage，键名为"sidebarCollapsed"，值为false
7. **展开状态恢复**：
   - 侧边栏宽度从60px过渡到320px
   - 设置区域按钮恢复横向排列
   - 按钮恢复显示图标和文本
   - 提示框功能禁用
   - 按钮文本淡入效果，持续时间200ms
   - 主内容区宽度自动收缩，为侧边栏腾出空间
   - 所有过渡时间与收缩时保持一致，确保对称性
8. **状态保持**：
   - 收缩/展开状态保存到localStorage
   - 页面刷新后恢复上次的状态
   - 收缩/展开状态不影响主题切换功能
   - 收缩/展开状态不影响设置按钮功能
   - 所有按钮功能在收缩状态下正常工作
9. **异常处理**：
   - 如果localStorage写入失败，显示轻量级错误提示
   - 错误提示在收缩按钮上方显示，2秒后自动消失
   - 提示内容："侧边栏状态保存失败，但已应用临时状态"
   - 界面仍然显示新状态，不影响用户体验
   - 如果动画卡顿，直接跳到最终状态，避免界面冻结
10. **响应时间要求**：
    - 收缩按钮点击响应时间<50ms（从点击到开始动画）
    - 侧边栏收缩动画完成时间<300ms（完全收缩到60px）
    - 按钮布局调整完成时间<250ms（完全调整为竖向）
    - 提示框显示延迟时间150ms（从悬停到开始显示）
    - 提示框完全显示时间<350ms（从悬停到完全显示）
    - 所有动画帧率保持60fps，确保流畅度
11. **用户交互设计**：
    - 支持拖拽收缩：用户可以拖拽侧边栏边缘调整宽度
    - 拖拽时显示宽度指示器（如"200px"）
    - 拖拽完成后自动吸附到最近的预设宽度（60px、200px、320px）
    - 吸附动画时间200ms，使用ease-out缓动
    - 支持键盘快捷键：Ctrl/Cmd + [ 收缩，Ctrl/Cmd + ] 展开
    - 快捷键按下时显示键盘提示Toast消息
    - 提示消息持续1秒后自动消失
12. **可访问性设计**：
    - 收缩按钮使用aria-label属性，明确功能说明
    - 支持键盘操作：Tab键导航到收缩按钮，Enter/Space键切换状态
    - 收缩按钮获得焦点时，显示焦点指示器（outline: 2px solid blue）
    - 收缩/展开状态变化时，屏幕阅读器朗读："侧边栏已收缩/展开"
    - 收缩按钮使用role="button"，语义化明确
    - 支持高对比度模式，收缩按钮颜色更加鲜明
    - 如果用户在系统设置中关闭了动画，则使用0ms过渡时间
13. **性能优化**：
    - 侧边栏收缩使用CSS transition，避免JavaScript动画
    - 按钮布局调整使用CSS flexbox，自动处理过渡
    - localStorage操作在动画完成后执行，不阻塞UI
    - 使用will-change属性提前告知浏览器变化的属性
    - 避免在动画过程中触发重排和重绘
    - 使用transform代替width属性，触发GPU加速
    - 按钮文本隐藏使用opacity: 0而非display: none，保持布局稳定性
### 2.4.4 视觉设计要求

#### 页面布局
- **设置区域位置**：
  - 位于左侧边栏底部
  - 固定在侧边栏底部区域，不随滚动移动
  - 始终可见，方便用户快速访问
- **容器结构**：
  - 容器宽度：占满侧边栏宽度（w-80，320px）
  - 内边距：16像素（p-4）
  - 边框：顶部边框分隔线（border-t border-gray-200）
  - 布局方式：水平排列，两端对齐（flex items-center justify-between）
- **内容分区**：
  - 左侧区域：操作按钮组（主题切换、系统设置）
  - 右侧区域：状态信息显示（在线状态、版本号）

#### 按钮位置与布局
- **按钮组布局**：
  - 水平排列（flex items-center）
  - 按钮间距：8像素（gap-2）
  - 按钮垂直居中对齐
- **单个按钮结构**：
  - 内部布局：水平排列图标和文本（flex items-center gap-2）
  - 图标和文本间距：8像素
  - 内边距：水平12像素，垂直8像素（px-3 py-2）
  - 圆角：8像素（rounded-lg）
- **按钮容器**：
  - 每个按钮包裹在tooltip-container中
  - 用于在侧边栏收缩时显示提示框
  - 提示框位置在按钮左侧（展开时）或右侧（收缩时）

#### 配色方案
- **浅色主题配色**：
  - **容器背景**：白色（bg-white）
  - **边框颜色**：浅灰色（border-gray-200）
  - **按钮默认状态**：
    - 背景：透明
    - 图标颜色：灰色（text-gray-400）
    - 文本颜色：灰色（text-gray-600）
  - **按钮悬停状态**：
    - 背景：浅灰色（hover:bg-gray-200）
    - 图标颜色：保持灰色
    - 文本颜色：保持灰色
  - **状态指示器**：
    - 在线状态：绿色（bg-green-500）
    - 离线状态：红色（bg-red-500）
  - **状态文本**：灰色（text-gray-500）
  - **版本文本**：灰色（text-gray-500）
- **深色主题配色**：
  - **容器背景**：深灰色（bg-gray-800）
  - **边框颜色**：深灰色（border-gray-700）
  - **按钮默认状态**：
    - 背景：透明
    - 图标颜色：浅灰色（text-gray-300）
    - 文本颜色：浅灰色（text-gray-300）
  - **按钮悬停状态**：
    - 背景：深灰色（hover:bg-gray-700）
    - 图标颜色：保持浅灰色
    - 文本颜色：保持浅灰色
  - **状态指示器**：
    - 在线状态：绿色（bg-green-500）
    - 离线状态：红色（bg-red-500）
  - **状态文本**：浅灰色（text-gray-500）
  - **版本文本**：浅灰色（text-gray-500）
- **提示框配色**：
  - 背景：深灰色（bg-gray-800）
  - 文字颜色：白色（text-white）
  - 边框：浅灰色（border-gray-700）
  - 箭头颜色：与背景一致

#### 图标设计
- **图标尺寸**：
  - 统一尺寸：16x16像素（w-4 h-4）
  - 线条宽度：2像素（stroke-width="2"）
- **图标类型**：
  - **主题切换图标**：
    - 浅色主题：太阳图标（M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z）
    - 深色主题：月亮图标（M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z）
  - **系统设置图标**：
    - 齿轮图标（M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z）
- **图标颜色**：
  - 浅色主题：灰色（text-gray-400）
  - 深色主题：浅灰色（text-gray-300）
  - 保持一致的图标风格和线条粗细

#### 字体设计
- **字体大小**：
  - 按钮文本：小号字体（text-sm，14px）
  - 状态文本：超小号字体（text-xs，12px）
  - 版本文本：超小号字体（text-xs，12px）
  - 提示框文本：超小号字体（12px）
- **字体颜色**：
  - 浅色主题：
    - 按钮文本：灰色（text-gray-600）
    - 状态/版本文本：灰色（text-gray-500）
  - 深色主题：
    - 按钮文本：浅灰色（text-gray-300）
    - 状态/版本文本：浅灰色（text-gray-500）
- **字体粗细**：
  - 按钮文本：正常字重（默认）
  - 状态/版本文本：正常字重（默认）
- **字体样式**：
  - 使用系统默认无衬线字体
  - 字体清晰易读
  - 保持与其他界面元素字体一致

#### 过渡动画
- **按钮悬停效果**：
  - 过渡属性：transition-colors
  - 过渡时间：0.2秒
  - 过渡效果：ease（缓动效果）
  - 应用范围：背景色、文字颜色、图标颜色
- **主题切换效果**：
  - 过渡属性：transition-colors
  - 过渡时间：0.2秒
  - 过渡效果：ease
  - 应用范围：所有颜色变化
  - 所有元素颜色变化同步过渡
- **侧边栏收缩效果**：
  - 过渡属性：transition
  - 过渡时间：0.3秒
  - 过渡效果：ease
  - 应用范围：侧边栏宽度、按钮布局
- **提示框显示效果**：
  - 过渡属性：transition（opacity、visibility）
  - 过渡时间：0.3秒
  - 过渡效果：ease
  - 显示：从opacity: 0到opacity: 1
  - 隐藏：从opacity: 1到opacity: 0
- **状态指示器变化效果**：
  - 过渡属性：transition-colors
  - 过渡时间：0.2秒
  - 过渡效果：ease
  - 在线/离线状态颜色平滑过渡

#### 提示框设计
- **提示框位置**：
  - 侧边栏展开时：按钮左侧（right: 100%）
  - 侧边栏收缩时：按钮右侧（left: 100%）
  - 垂直位置：垂直居中（top: 50%，transform: translateY(-50%)）
- **提示框样式**：
  - 内边距：4像素垂直，8像素水平（padding: 4px 8px）
  - 圆角：4像素（rounded）
  - 背景色：深灰色（bg-gray-800）
  - 文字颜色：白色（text-white）
  - 边框：浅灰色边框（border-gray-700）
  - 字体大小：12像素
  - 文本不换行（white-space: nowrap）
- **提示框箭头**：
  - 侧边栏展开时：箭头在右侧（指向按钮）
  - 侧边栏收缩时：箭头在左侧（指向按钮）
  - 箭头使用CSS伪元素::after创建
  - 箭头颜色：与提示框背景一致
- **提示框显示逻辑**：
  - 默认状态：opacity: 0，visibility: hidden
  - 悬停时：opacity: 1，visibility: visible
  - 只在侧边栏收缩状态下显示
  - 鼠标移开立即隐藏

#### 状态信息设计
- **状态指示器**：
  - 尺寸：8x8像素（w-2 h-2）
  - 形状：圆形（rounded-full）
  - 在线状态：绿色（bg-green-500）
  - 离线状态：红色（bg-red-500）
  - 边框：无边框
- **状态文本**：
  - 文本内容："在线"或"离线"
  - 字体大小：12像素（text-xs）
  - 字体颜色：灰色（text-gray-500）或浅灰色（text-gray-500）
  - 与状态指示器间距：4像素（gap-1）
- **版本信息**：
  - 文本内容："v1.0.0"（示例版本号）
  - 字体大小：12像素（text-xs）
  - 字体颜色：灰色（text-gray-500）或浅灰色（text-gray-500）
  - 与状态信息间距：16像素（gap-4）
- **状态区域布局**：
  - 水平排列（flex items-center）
  - 所有元素右对齐
  - 与按钮组间距：自动填充（justify-between）

#### 侧边栏收缩状态设计
- **收缩后尺寸**：
  - 侧边栏宽度：60像素
  - 过渡时间：0.3秒
- **按钮布局调整**：
  - 从横向排列变为竖向排列（flex-direction: column）
  - 按钮间距：8像素（gap-2）
  - 按钮尺寸：40x40像素方形
  - 按钮内边距：12像素（padding: 12px）
  - 按钮文本隐藏（display: none）
  - 按钮图标居中显示（justify-content: center）
- **状态信息隐藏**：
  - 状态指示器和文本完全隐藏（display: none）
  - 状态信息区域不可见
- **提示框启用**：
  - 悬停时显示提示框
  - 提示框在按钮右侧显示
  - 提示框位置：left: 100%，margin-left: 8px

#### 可访问性设计
- **对比度**：
  - 文字与背景对比度符合WCAG 2.1标准
  - 对比度至少4.5:1
  - 浅色和深色主题都保持足够对比度
- **触摸目标尺寸**：
  - 按钮最小尺寸：44x44像素（包括内边距）
  - 符合移动端触摸目标最小尺寸要求
  - 方便触摸设备操作
- **焦点状态**：
  - 键盘导航时按钮有焦点样式
  - 焦点样式使用focus:ring-2 focus:ring-blue-500
  - 确保键盘用户可以清晰看到焦点位置
- **语义化标签**：
  - 使用button元素作为按钮
  - 使用span元素作为文本标签
  - 使用title属性提供额外提示信息
- **屏幕阅读器支持**：
  - 按钮有清晰的文本标签
  - 提示框内容通过title属性提供
  - 状态信息使用语义化结构

#### 整体风格
- **设计理念**：
  - 简洁、现代、扁平化
  - 与整个应用风格保持一致
  - 强调功能性和易用性
- **阴影使用**：
  - 最小化阴影使用
  - 按钮默认状态无阴影
  - 保持简洁的视觉效果
- **圆角设计**：
  - 按钮圆角：8像素（rounded-lg）
  - 提示框圆角：4像素
  - 保持友好的视觉感受
- **间距统一**：
  - 使用Tailwind间距系统（4px基准）
  - 内边距：4的倍数（4px、8px、12px、16px）
  - 外边距：4的倍数
  - 保持一致的视觉节奏
- **颜色一致性**：
  - 使用Tailwind标准颜色系统
  - 灰色系列：gray-200、gray-300、gray-400、gray-500、gray-700、gray-800
  - 绿色系列：green-500
  - 红色系列：red-500
  - 蓝色系列：blue-500（用于焦点状态）
- **响应式设计**：
  - 侧边栏收缩功能提供更灵活的布局
  - 适应不同屏幕尺寸
  - 在小屏幕上自动调整布局


## 2.5 主题管理
### 2.5.1 原型设计页面
    MainLayout.html
### 2.5.2 功能流程

#### 主题类型
- **浅色主题**：
  - 主题标识："light"
  - 背景色：浅灰色背景（bg-gray-100）
  - 文字颜色：深灰色（text-gray-900）
  - 主要颜色：白色、浅灰色、蓝色
- **深色主题**：
  - 主题标识："dark"
  - 背景色：深灰色背景（bg-gray-900）
  - 文字颜色：白色（text-white）
  - 主要颜色：深灰色、黑色、浅蓝色

#### 主题初始化
- **初始化时机**：页面加载时自动执行
- **数据来源**：从localStorage读取保存的主题设置
- **默认主题**：如果localStorage中没有保存的主题，默认使用浅色主题
- **初始化流程**：
  1. 从localStorage获取主题设置
  2. 如果没有保存的设置，使用默认浅色主题
  3. 调用setTheme函数应用主题

#### 主题切换功能
- **触发方式**：点击左侧边栏底部的主题按钮
- **切换逻辑**：
  1. 检测当前主题类型（通过body的class判断）
  2. 确定新主题类型（浅色↔深色）
  3. 调用setTheme函数应用新主题
- **按钮状态**：
  - 浅色主题：显示太阳图标
  - 深色主题：显示月亮图标

#### 深色主题样式适配
- **全局样式**：
  - body背景：bg-gray-900
  - 文字颜色：text-white
  - 主题标识：添加dark-theme class
- **侧边栏样式**：
  - 侧边栏背景：bg-gray-800
  - 边框颜色：border-gray-700
  - 搜索框背景：bg-gray-700
  - 搜索框文字：text-white
  - 分组头部背景：bg-gray-700/30
  - 分组标题颜色：text-gray-200
  - 智能体项悬停：hover:bg-gray-700
  - 底部设置区域边框：border-gray-700
- **主内容区样式**：
  - 主内容区背景：bg-gray-900
  - 顶部栏边框：border-gray-700
- **聊天窗口样式**：
  - 聊天窗口背景：bg-gray-900
  - 分割线颜色：bg-gray-700
  - 智能体消息背景：bg-gray-800
  - 用户消息背景：bg-blue-600
  - 输入区域背景：bg-gray-800
  - 输入框背景：bg-gray-700
  - 输入框文字：text-white
  - 按钮区域背景：bg-gray-700
  - 附件容器背景：bg-gray-700
  - 附件背景：bg-gray-700
  - 附件边框：border-gray-600
  - 按钮悬停颜色：hover:text-white
- **欢迎页面样式**：
  - 统计卡片背景：bg-gray-800
  - 统计数字颜色：浅彩色（text-blue-400、text-green-400、text-purple-400）
  - 标签文字颜色：text-gray-400
  - 描述文字颜色：text-gray-400
- **底部设置样式**：
  - 按钮悬停背景：hover:bg-gray-700
  - 按钮文字颜色：text-gray-300
  - 图标颜色：text-gray-300
  - 用户头像背景：bg-gray-600
  - 用户头像内部背景：bg-gray-700
  - 用户头像图标颜色：text-gray-300

#### 浅色主题样式适配
- **全局样式**：
  - body背景：bg-gray-100
  - 文字颜色：text-gray-900
  - 主题标识：添加light-theme class
- **侧边栏样式**：
  - 侧边栏背景：bg-white
  - 边框颜色：border-gray-300
  - 搜索框背景：bg-gray-100
  - 搜索框文字：text-gray-900
  - 分组头部背景：bg-gray-100
  - 分组标题颜色：text-gray-700
  - 智能体项悬停：hover:bg-gray-200
  - 底部设置区域边框：border-gray-200
- **主内容区样式**：
  - 主内容区背景：bg-gray-50
  - 顶部栏边框：border-gray-200
- **聊天窗口样式**：
  - 聊天窗口背景：bg-gray-50
  - 分割线颜色：bg-gray-300
  - 智能体消息背景：bg-gray-200
  - 用户消息背景：bg-blue-100
  - 输入区域背景：bg-white
  - 输入框背景：bg-gray-100
  - 输入框文字：text-gray-900
  - 按钮区域背景：bg-gray-50
  - 附件容器背景：bg-gray-100
  - 附件背景：bg-gray-100
  - 附件边框：border-gray-200
  - 按钮悬停颜色：hover:text-gray-900
- **欢迎页面样式**：
  - 统计卡片背景：bg-gradient-to-br from-gray-100 to-gray-200
  - 统计数字颜色：深彩色（text-blue-600、text-green-600、text-purple-600）
  - 标签文字颜色：text-gray-600
  - 描述文字颜色：text-gray-600
- **底部设置样式**：
  - 按钮悬停背景：hover:bg-gray-200
  - 按钮文字颜色：text-gray-600
  - 图标颜色：text-gray-400
  - 用户头像背景：bg-gray-100
  - 用户头像内部背景：bg-gray-200
  - 用户头像图标颜色：text-gray-600

#### 数据持久化
- **存储方式**：使用localStorage
- **存储键名**："theme"
- **存储值**："light" 或 "dark"
- **保存时机**：每次主题切换时立即保存
- **读取时机**：页面加载初始化时读取
- **数据验证**：如果存储的值无效，使用默认浅色主题

#### 图标切换
- **太阳图标**（浅色主题）：
  - SVG路径：太阳图标路径
  - 图标描述：带有光芒的太阳
  - 使用场景：浅色主题下显示
- **月亮图标**（深色主题）：
  - SVG路径：月亮图标路径
  - 图标描述：弯月形状
  - 使用场景：深色主题下显示
- **切换逻辑**：根据当前主题动态替换SVG内容

#### 样式转换规则
- **颜色映射**：
  - text-gray-900 ↔ text-white（主文字）
  - text-gray-600 ↔ text-gray-300（次要文字）
  - text-gray-500 ↔ text-gray-400（辅助文字）
  - bg-gray-100 ↔ bg-gray-700（浅色背景）
  - bg-gray-200 ↔ bg-gray-800（中等背景）
  - border-gray-200 ↔ border-gray-700（边框颜色）
  - text-blue-600 ↔ text-blue-400（蓝色元素）
  - text-green-600 ↔ text-green-400（绿色元素）
  - text-purple-600 ↔ text-purple-400（紫色元素）
- **类名替换**：通过JavaScript动态替换CSS类名
- **批量处理**：使用querySelectorAll批量处理相同元素

#### 交互特性
- **即时切换**：点击按钮立即切换主题，无延迟
- **平滑过渡**：所有颜色变化都有transition-colors过渡效果
- **状态保持**：刷新页面后保持上次选择的主题
- **全局应用**：主题切换影响整个应用的所有页面和组件
- **响应式支持**：主题适配不同屏幕尺寸和设备
- **可访问性**：保持足够的对比度，确保文字可读性

#### 边栏收缩适配
- **按钮布局**：收缩状态下按钮竖向排列
- **文本隐藏**：按钮文本和提示框文本隐藏
- **图标居中**：图标居中显示在40x40像素的按钮中
- **提示框显示**：收缩状态下悬停显示主题按钮的提示框
- **主题保持**：收缩状态下主题功能正常工作

#### 技术实现
- **主题检测**：通过检查body的class列表判断当前主题
- **DOM操作**：使用document.querySelectorAll批量处理元素
- **样式应用**：通过修改元素的className属性应用主题
- **事件监听**：为主题按钮添加click事件监听器
- **状态管理**：使用localStorage进行状态持久化
### 2.5.3 交互流程

#### 页面加载主题初始化交互流程
1. **页面开始加载**：
   - HTML文档开始解析
   - CSS样式开始加载
   - JavaScript开始执行
   - 显示全局加载指示器（全屏遮罩 + 旋转图标）
   - 加载指示器带有进度文本："正在初始化..."
   - 加载指示器背景使用半透明遮罩（backdrop-filter: blur(4px)）
2. **initTheme函数执行**：
   - 调用initTheme函数
   - 尝试从localStorage读取主题设置
   - 执行时间<50ms，确保快速响应
   - 如果执行时间超过100ms，更新进度文本："正在加载主题设置..."
3. **读取存储数据**：
   - 调用localStorage.getItem('theme')
   - 获取存储的主题值
   - 读取操作在后台异步执行，不阻塞UI
   - 如果读取时间超过100ms，显示加载微动画（小旋转图标）
4. **数据验证**：
   - 检查读取到的值是否为null或undefined
   - 如果没有存储的值：
     - 使用默认主题'light'
     - 显示提示："使用默认浅色主题"
     - 提示在屏幕顶部显示1秒后自动消失
   - 如果有存储的值：
     - 验证值是否为'light'或'dark'
     - 如果值无效：使用默认主题'light'并记录警告日志
     - 如果值有效：使用存储的主题值
   - 验证过程<10ms，确保即时响应
5. **应用主题**：
   - 调用setTheme函数
   - 传入验证后的主题值
   - 主题应用带有淡入效果，持续时间300ms
   - 如果主题应用时间>200ms，更新进度文本："正在应用主题..."
6. **主题按钮状态设置**：
   - 根据当前主题更新主题按钮图标
   - 浅色主题：设置太阳图标
   - 深色主题：设置月亮图标
   - 图标切换带有旋转动画，持续时间200ms
   - 图标加载完成前显示占位符（灰色圆点）
7. **界面渲染完成**：
   - 所有元素应用正确的主题样式
   - 界面显示用户上次选择的主题
   - 用户体验无缝
   - 全局加载指示器淡出，持续时间200ms
   - 加载指示器完全消失后，显示"初始化完成"提示
   - 提示持续1秒后自动消失
8. **异常处理**：
   - 如果localStorage读取失败，显示错误提示："无法读取主题设置，使用默认主题"
   - 错误提示使用黄色背景，持续2秒后自动消失
   - 记录错误日志到控制台，便于开发调试
   - 确保应用不会崩溃，继续使用默认主题
   - 如果主题应用失败，显示错误提示："主题应用失败，正在重试..."
   - 自动重试最多3次，每次间隔1秒
   - 如果3次都失败，显示严重错误提示："主题应用失败，请联系技术支持"
   - 提供刷新页面按钮，点击后重新加载
9. **响应时间要求**：
   - 页面加载开始到主题初始化完成<500ms
   - localStorage读取时间<100ms
   - 数据验证时间<10ms
   - 主题应用时间<300ms
   - 界面完全渲染时间<500ms
   - 加载指示器显示时间<600ms（从开始到完全消失）
   - 所有操作在主线程执行时间<100ms，避免UI阻塞
10. **性能优化**：
    - 主题初始化使用requestIdleCallback，在浏览器空闲时执行
    - localStorage读取使用try-catch包裹，避免异常导致页面崩溃
    - 主题样式预加载，在DOMContentLoaded之前就加载完成
    - 使用CSS变量管理主题，减少DOM操作
    - 批量更新DOM，减少重排和重绘
    - 避免在主题初始化时执行复杂的计算或网络请求
11. **用户反馈**：
    - 如果初始化时间>1秒，显示详细的进度信息（如"50% 完成"）
    - 如果初始化时间>3秒，显示加载提示："初始化时间较长，请稍候..."
    - 提供取消初始化按钮，点击后跳过主题初始化（使用默认主题）
    - 初始化完成后，如果用户取消过，显示提示："已使用默认主题，可在设置中更改"
    - 支持用户手动触发重新初始化（在设置中提供"重置主题"按钮）

#### 主题切换完整交互流程
1. **用户准备切换**：
   - 用户看到主题按钮
   - 主题按钮显示当前主题对应的图标
   - 浅色主题：显示太阳图标
   - 深色主题：显示月亮图标
   - 按钮处于可交互状态，鼠标指针为pointer
   - 按钮在悬停时显示轻微背景色变化，提示可点击
2. **用户点击主题按钮**：
   - 触发click事件监听器
   - 按钮立即显示按下效果（transform: scale(0.95)）
   - 按钮背景色短暂加深，提供触觉反馈
   - 事件处理器开始执行
   - 显示小加载指示器（旋转图标），持续时间<100ms
   - 按钮在处理期间显示轻微禁用状态（opacity: 0.7）
   - 300ms内禁止重复点击（防抖处理）
3. **获取当前主题**：
   - 检查body元素的classList
   - 判断是否包含'dark-theme'类
   - 判断是否包含'light-theme'类
   - 判断过程<10ms，确保即时响应
   - 如果无法确定主题，使用默认主题'light'并记录警告日志
4. **确定目标主题**：
   - 如果当前为'light'：目标主题为'dark'
   - 如果当前为'dark'：目标主题为'light'
   - 按钮图标开始旋转动画，持续200ms
   - 动画使用transform: rotate(180deg)，带有ease-out缓动
5. **调用setTheme函数**：
   - 传入目标主题值
   - 开始主题切换处理
   - 函数执行时间控制在50ms内
   - 如果执行时间>100ms，显示加载提示："正在切换主题..."
6. **setTheme函数处理**：
   - 移除body的当前主题class（'light-theme'或'dark-theme'）
   - 添加新的主题class到body
   - 开始批量更新所有UI元素的样式
   - 使用requestAnimationFrame确保动画流畅
   - 所有更新在单个帧内完成，避免重排
7. **更新侧边栏样式**：
   - 使用querySelectorAll查找侧边栏元素
   - 遍历所有需要更新的元素
   - 根据主题类型替换CSS类名：
     - 浅色→深色：bg-white→bg-gray-800, border-gray-300→border-gray-700等
     - 深色→浅色：bg-gray-800→bg-white, border-gray-700→border-gray-300等
   - 所有元素使用transition-colors，过渡时间300ms
   - 更新过程在<50ms内完成，不阻塞UI
8. **更新主内容区样式**：
   - 查找主内容区元素
   - 更新背景色和边框色
   - 更新文字颜色
   - 使用CSS变量批量更新，减少DOM操作
   - 过渡效果与侧边栏保持一致
9. **更新聊天窗口样式**：
   - 查找所有聊天内容面板
   - 更新消息背景色（用户消息和智能体消息）
   - 更新输入框样式（背景色、边框色、文字颜色）
   - 更新按钮和附件样式
   - 更新滚动条样式（轨道和滑块颜色）
   - 如果有大量消息，使用虚拟滚动优化性能
   - 更新过程分批进行，每批处理50条消息，避免卡顿
10. **更新欢迎页面样式**：
    - 查找欢迎页面元素
    - 更新统计卡片背景（使用渐变过渡）
    - 更新统计数字颜色（带淡入效果）
    - 更新标签和描述文字颜色
    - 欢迎图标渐变背景平滑过渡
    - 所有过渡时间300ms，使用ease-in-out缓动
11. **更新底部设置样式**：
    - 查找底部设置区域元素
    - 更新按钮样式（背景色、边框色、图标颜色）
    - 更新文字和图标颜色
    - 更新状态信息颜色（在线/离线状态、版本号）
    - 状态指示器颜色平滑过渡
    - 提示框样式同步更新
12. **更新主题按钮图标**：
    - 查找主题按钮内的SVG元素
    - 替换SVG的innerHTML内容
    - 浅色主题：替换为太阳图标SVG路径
    - 深色主题：替换为月亮图标SVG路径
    - 图标切换带有淡入淡出效果，持续时间200ms
    - 图标加载完成前显示占位符（灰色圆点）
    - 图标旋转动画完成（180度）
    - 按钮恢复正常状态（transform: scale(1)）
13. **保存主题设置**：
    - 调用localStorage.setItem('theme', newTheme)
    - 将新主题值保存到本地存储
    - 保存操作在后台异步执行，不阻塞UI
    - 如果保存成功，显示简短成功提示（可选）："主题已切换"
    - 提示在按钮上方显示，2秒后自动消失
    - 如果保存失败，显示错误提示（见异常处理流程）
14. **过渡效果执行**：
    - 所有CSS类名变化触发transition-colors过渡
    - 颜色平滑过渡到新主题
    - 过渡时间通常为0.2-0.3秒（200-300ms）
    - 过渡效果为ease-in-out，确保自然流畅
    - 使用GPU加速，保持60fps帧率
    - 如果用户禁用动画，则使用0ms过渡时间
15. **切换完成**：
    - 所有元素显示新主题样式
    - 用户看到完整的主题切换效果
    - 主题切换功能保持响应状态
    - 按钮恢复到正常可交互状态
    - 加载指示器消失
    - 所有过渡动画完成
16. **异常处理**：
    - 如果主题切换过程中出现错误，显示错误提示："主题切换失败，正在重试..."
    - 自动重试最多3次，每次间隔500ms
    - 如果3次都失败，显示错误提示："主题切换失败，已恢复原主题"
    - 错误提示使用红色背景，持续3秒后自动消失
    - 提供刷新页面按钮，点击后重新加载页面
    - 记录错误日志到控制台，包含详细的错误信息和堆栈
    - 确保应用不会崩溃，始终显示可用的主题
17. **响应时间要求**：
    - 按钮点击响应时间<50ms（从点击到开始显示变化）
    - 主题切换启动时间<100ms（从点击到开始应用新主题）
    - 样式更新完成时间<200ms（所有元素样式更新完成）
    - 过渡动画完成时间<300ms（所有颜色过渡完成）
    - 整体切换完成时间<500ms（从点击到完全显示新主题）
    - 保存操作完成时间<100ms（异步保存，不阻塞UI）
    - 所有动画帧率保持60fps，确保流畅度
18. **性能优化**：
    - 使用CSS变量管理主题，减少DOM操作
    - 批量更新DOM，减少重排和重绘
    - 使用requestAnimationFrame，确保动画流畅
    - 使用transform和opacity进行动画，触发GPU加速
    - 避免在主题切换时执行复杂的计算或网络请求
    - 使用will-change属性提前告知浏览器变化的属性
    - 大量消息更新时使用虚拟滚动，避免渲染过多DOM节点
    - 使用MutationObserver监听主题变化，减少手动DOM操作
19. **用户反馈**：
    - 如果切换时间>1秒，显示加载提示："切换主题中，请稍候..."
    - 如果切换时间>3秒，显示警告提示："切换时间较长，可能存在问题"
    - 提供"取消切换"按钮，点击后恢复原主题
    - 切换完成后，如果用户取消过，显示提示："已恢复原主题"
    - 支持用户自定义过渡时间（在设置中提供"主题切换动画速度"选项）
    - 支持用户禁用主题切换动画（在设置中提供"禁用动画"选项）

#### 侧边栏收缩时主题切换交互流程
1. **侧边栏收缩状态**：
   - 侧边栏宽度为60像素
   - 按钮竖向排列
   - 按钮文本隐藏（使用opacity: 0，不占用布局空间）
   - 提示框功能启用
   - 按钮尺寸为40x40像素方形（w-10 h-10）
   - 按钮圆角调整为rounded（4px）
   - 按钮图标居中显示
   - 主题按钮显示当前主题对应的图标
2. **用户悬停主题按钮**：
   - 触发hover事件
   - 延迟150ms后检测侧边栏是否为收缩状态（避免误触）
   - 检测到侧边栏为收缩状态
   - 显示提示框在按钮左侧
   - 提示框内容："主题"
   - 提示框带有淡入动画，持续200ms
   - 提示框背景为深灰色（bg-gray-800），文字为白色
   - 提示框箭头指向按钮，确保视觉关联性
   - 如果鼠标在150ms内移开，则不显示提示框（防抖动）
3. **用户点击主题按钮**：
   - 触发click事件
   - 按钮立即显示按下效果（transform: scale(0.95)）
   - 按钮背景色短暂加深，提供触觉反馈
   - 提示框立即隐藏（无动画，瞬间消失）
   - 显示小加载指示器（旋转图标），持续时间<100ms
   - 按钮在处理期间显示轻微禁用状态（opacity: 0.7）
   - 300ms内禁止重复点击（防抖处理）
   - 执行主题切换逻辑（与展开状态相同）
4. **主题切换执行**：
   - 按照标准主题切换流程执行
   - 更新所有元素样式
   - 更新主题按钮图标
   - 保存主题设置
   - 按钮图标开始旋转动画，持续200ms
   - 动画使用transform: rotate(180deg)，带有ease-out缓动
   - 所有样式更新在<200ms内完成
   - 颜色过渡时间300ms，使用ease-in-out缓动
   - 使用GPU加速，保持60fps帧率
5. **保持收缩状态**：
   - 侧边栏保持收缩状态（宽度60px）
   - 按钮保持竖向排列
   - 提示框功能继续工作
   - 侧边栏状态不因主题切换而改变
   - 侧边栏收缩状态保存到localStorage，键名为"sidebarCollapsed"
   - 确保收缩状态在主题切换后仍然有效
6. **新主题显示**：
   - 按钮图标更新为对应主题的图标
   - 图标切换带有淡入淡出效果，持续时间200ms
   - 图标加载完成前显示占位符（灰色圆点）
   - 按钮恢复正常状态（transform: scale(1)）
   - 按钮禁用状态消失（opacity: 1）
   - 加载指示器消失
   - 提示框继续在悬停时显示
   - 提示框样式根据新主题自动调整
   - 收缩状态下主题切换正常工作
   - 如果保存成功，显示简短成功提示："主题已切换"
   - 提示在按钮上方显示，2秒后自动消失
7. **异常处理**：
   - 如果主题切换失败，显示错误提示："主题切换失败，正在重试..."
   - 自动重试最多3次，每次间隔500ms
   - 如果3次都失败，显示错误提示："主题切换失败，已恢复原主题"
   - 错误提示使用红色背景，持续3秒后自动消失
   - 提供刷新页面按钮，点击后重新加载页面
   - 记录错误日志到控制台
   - 确保应用不会崩溃，收缩状态始终保持
8. **响应时间要求**：
   - 提示框显示延迟时间150ms（从悬停到开始显示）
   - 提示框完全显示时间<350ms（从悬停到完全显示）
   - 按钮点击响应时间<50ms（从点击到开始显示变化）
   - 主题切换启动时间<100ms（从点击到开始应用新主题）
   - 整体切换完成时间<500ms（从点击到完全显示新主题）
   - 所有动画帧率保持60fps，确保流畅度
9. **用户反馈**：
    - 如果切换时间>1秒，显示加载提示："切换主题中，请稍候..."
    - 提示在按钮上方显示，不遮挡其他元素
    - 提供取消切换按钮，点击后恢复原主题
    - 切换完成后，如果用户取消过，显示提示："已恢复原主题"
    - 支持用户自定义提示框显示延迟（在设置中提供选项）
    - 支持用户禁用提示框（在设置中提供"禁用提示框"选项）
10. **可访问性设计**：
    - 主题按钮使用aria-label属性，明确功能说明
    - 提示框内容使用aria-describedby属性关联
    - 支持键盘操作：Tab键导航到主题按钮，Enter/Space键切换主题
    - 主题按钮获得焦点时，显示焦点指示器（outline: 2px solid blue）
    - 收缩状态下，焦点指示器不超出侧边栏边界
    - 主题切换时，屏幕阅读器朗读："主题已切换为：深色/浅色"
    - 提示框不接收键盘焦点（避免干扰导航）
    - 支持高对比度模式，提示框颜色更加鲜明
    - 如果用户禁用动画，则提示框使用0ms过渡时间
11. **性能优化**：
    - 提示框使用CSS transform进行动画，触发GPU加速
    - 提示框延迟使用setTimeout，避免阻塞主线程
    - 主题切换使用requestAnimationFrame，确保动画流畅
    - 按钮图标使用SVG，避免图片加载延迟
    - 避免在主题切换时触发复杂的DOM操作
    - 提示框使用will-change属性，提前告知浏览器变化的属性
    - 侧边栏收缩状态使用CSS类控制，减少JavaScript操作

#### localStorage异常处理交互流程
1. **正常读取情况**：
   - localStorage.getItem('theme')成功执行
   - 返回存储的主题值
   - 流程正常进行
   - 读取时间<50ms，确保快速响应
   - 如果读取时间>100ms，显示加载微动画（小旋转图标）
2. **读取失败情况**：
   - localStorage被禁用或存储空间已满
   - getItem抛出异常
   - catch块捕获异常
   - 异常类型：SecurityError（安全限制）、QuotaExceededError（空间已满）
   - 异常信息包含详细错误代码和描述
3. **异常处理**：
   - 捕获到异常时使用默认主题'light'
   - 显示错误提示："无法读取主题设置，使用默认浅色主题"
   - 错误提示使用黄色背景，持续2秒后自动消失
   - 记录错误日志到控制台，包含异常类型、堆栈信息和时间戳
   - 错误日志格式："[localStorage][read] Error type: SecurityError, Time: 2024-01-29 10:30:45"
   - 确保应用不会崩溃，继续使用默认主题
   - 如果是SecurityError，检查是否在隐私模式下运行
   - 如果是QuotaExceededError，尝试清理过期数据
   - 自动重试最多3次，每次间隔1秒
   - 如果3次都失败，显示警告提示："localStorage访问受限，主题设置不会保存"
4. **正常保存情况**：
   - localStorage.setItem('theme', value)成功执行
   - 主题设置成功保存
   - 流程正常完成
   - 保存操作在后台异步执行，不阻塞UI
   - 如果保存成功，显示简短成功提示（可选）："设置已保存"
   - 提示在按钮上方显示，1秒后自动消失
   - 保存时间<100ms，确保快速响应
5. **保存失败情况**：
   - localStorage被禁用或存储配额已满
   - setItem抛出异常
   - catch块捕获异常
   - 异常类型：SecurityError、QuotaExceededError
   - 异常信息包含详细错误代码和描述
6. **保存异常处理**：
   - 捕获到异常时忽略保存错误
   - 显示错误提示："无法保存主题设置，设置仅在当前会话有效"
   - 错误提示使用红色背景，持续3秒后自动消失
   - 记录错误日志到控制台，包含异常类型、堆栈信息和时间戳
   - 错误日志格式："[localStorage][write] Error type: QuotaExceededError, Value: dark, Time: 2024-01-29 10:30:50"
   - 确保应用继续正常运行
   - 主题切换在当前会话中仍然有效
   - 如果是SecurityError，检查是否在隐私模式下运行
   - 如果是QuotaExceededError，尝试清理过期数据并重试
   - 自动重试最多3次，每次间隔1秒
   - 如果3次都失败，显示严重错误提示："localStorage空间已满，请清理浏览器数据"
7. **用户通知**：
   - 如果localStorage读取失败，显示详细错误提示
   - 如果localStorage保存失败，显示详细错误提示
   - 提供解决建议：
     - SecurityError："请检查浏览器隐私设置，确保允许使用localStorage"
     - QuotaExceededError："请清理浏览器缓存或存储数据，释放存储空间"
   - 提供"重试"按钮，点击后重新执行读取/保存操作
   - 提供"清理数据"按钮（仅针对QuotaExceededError），点击后清理过期数据
   - 提供"检查浏览器设置"链接，点击后打开浏览器存储设置页面
   - 提示用户刷新页面或重新打开应用（针对持续失败的情况）
   - 所有提示都带有淡入淡出动画，持续时间200ms
   - 提示位置固定在屏幕顶部，不遮挡主要操作区域
8. **降级策略**：
   - 如果localStorage完全不可用，使用内存存储作为后备方案
   - 内存存储使用全局变量或Map对象
   - 内存存储在页面刷新后丢失，但保证当前会话正常工作
   - 显示持久化提示："当前使用内存存储，刷新页面后设置将丢失"
   - 提示在屏幕顶部持续显示，带有"关闭"按钮
   - 用户点击"关闭"按钮后，提示消失，但1分钟后自动重新显示
   - 记录降级日志："[localStorage][fallback] Fallback to memory storage"
   - 定期检查localStorage是否恢复可用（每30秒检查一次）
   - 如果localStorage恢复可用，自动切换回localStorage存储
   - 切换回localStorage时显示提示："存储已恢复，设置将自动保存"
9. **监控和诊断**：
   - 监控localStorage的成功率和失败率
   - 统计失败原因分布（SecurityError、QuotaExceededError、其他错误）
   - 记录失败发生的频率和模式
   - 如果失败率>50%，触发警报并上报错误
   - 提供诊断工具，在控制台输出localStorage使用情况：
     - 已使用空间：calculateUsage()
     - 剩余空间：estimateRemainingSpace()
     - 存储键列表：getKeys()
   - 诊断工具可通过在控制台执行window.localStorageDiagnostic()调用
10. **响应时间要求**：
    - localStorage读取时间<50ms（正常情况）
    - localStorage保存时间<100ms（正常情况）
    - 异常捕获时间<10ms（try-catch执行）
    - 错误提示显示时间<50ms（从捕获到显示提示）
    - 重试间隔1秒（自动重试）
    - 降级切换时间<100ms（切换到内存存储）
    - 所有操作在主线程执行时间<100ms，避免UI阻塞
11. **性能优化**：
    - 使用try-catch包裹所有localStorage操作
    - 避免在localStorage操作时执行复杂计算
    - localStorage操作使用异步执行，不阻塞UI
    - 错误日志批量写入，减少localStorage写入次数
    - 使用debounce减少频繁的错误提示
    - 内存存储使用WeakMap或Map，避免内存泄漏
    - 定期清理过期的内存存储数据（每5分钟清理一次）
12. **用户体验保障**：
    - 无论localStorage是否可用，应用都能正常运行
    - 所有错误都有清晰的提示和解决方案
    - 用户始终知道当前存储状态（正常、受限、降级）
    - 提供多种恢复方案（重试、清理、刷新）
    - 不强制用户刷新页面，保持工作流程连续性
    - 降级到内存存储时，明确告知用户限制
    - 存储恢复时，明确告知用户改进
    - 所有提示都简洁明了，避免技术术语

#### 系统主题偏好交互流程
1. **首次访问应用**：
   - 用户首次打开应用
   - localStorage中没有主题设置
   - 显示欢迎提示："欢迎使用！已为您设置默认浅色主题"
   - 提示带有淡入动画，持续200ms
   - 提示在屏幕顶部显示3秒后自动消失
   - 使用默认浅色主题
   - 默认主题应用带有淡入效果，持续时间300ms
   - 显示主题切换引导动画（主题按钮轻微闪烁3次，每次持续500ms）
   - 引导动画完成后，主题按钮恢复正常状态
2. **用户切换主题**：
   - 用户点击主题按钮
   - 主题切换执行（见主题切换完整交互流程）
   - 主题设置保存到localStorage
   - 显示切换提示："已切换到深色主题"
   - 提示使用绿色背景，持续2秒后自动消失
   - 提示带有淡入淡出动画，持续时间200ms
   - 记录主题切换日志："[theme] User switched to dark theme at 2024-01-29 10:30:00"
   - 如果是首次切换，显示额外提示："主题设置已保存，下次访问自动应用"
   - 额外提示在主提示下方显示，持续时间5秒
3. **刷新页面**：
   - 用户刷新浏览器页面
   - 应用重新加载
   - 显示全局加载指示器（全屏遮罩 + 旋转图标）
   - 加载指示器带有进度文本："正在恢复您的设置..."
   - 加载指示器背景使用半透明遮罩（backdrop-filter: blur(4px)）
   - initTheme函数重新执行
   - 读取localStorage中的主题设置
   - 读取时间<100ms，确保快速响应
4. **读取上次选择**：
   - 从localStorage读取保存的主题
   - 检测到用户上次选择的是深色主题
   - 显示恢复提示："已恢复您上次的选择：深色主题"
   - 提示使用蓝色背景，持续2秒后自动消失
   - 应用深色主题
   - 主题应用带有淡入效果，持续时间300ms
   - 如果读取失败，显示错误提示（见localStorage异常处理流程）
5. **用户偏好保持**：
   - 用户看到深色主题
   - 主题偏好得到保持
   - 无需重新选择主题
   - 显示确认提示："您的主题偏好已成功恢复"
   - 提示带有勾选图标，持续时间1.5秒后自动消失
   - 主题按钮图标立即更新为月亮图标
   - 图标切换带有旋转动画，持续200ms
6. **跨会话保持**：
   - 用户关闭浏览器
   - 用户重新打开应用
   - 主题设置从localStorage读取
   - 显示欢迎提示："欢迎回来！已为您恢复深色主题"
   - 提示带有淡入动画，持续200ms
   - 提示在屏幕顶部显示3秒后自动消失
   - 用户选择的主题得到保持
   - 主题应用带有淡入效果，持续时间300ms
   - 显示会话恢复统计："您上次使用：深色主题，上次访问：2024-01-28"
   - 统计信息在欢迎提示下方显示，持续时间5秒
7. **多设备同步**（可选）：
   - 如果支持云端同步，主题设置自动同步到云端
   - 同步操作在后台异步执行，不阻塞UI
   - 显示同步状态指示器（小云图标）
   - 同步成功：绿色勾选图标
   - 同步中：旋转图标
   - 同步失败：红色叉号图标
   - 如果同步失败，显示错误提示："主题设置同步失败，下次同步将自动重试"
   - 错误提示使用黄色背景，持续3秒后自动消失
   - 提供手动重试按钮，点击后重新同步
   - 云端设置在多设备间共享，保持一致性
8. **主题历史记录**：
   - 记录用户主题切换历史（最近10次）
   - 历史记录包括：切换时间、主题类型、切换来源（手动/自动）
   - 在设置中提供"主题历史"查看入口
   - 用户可以查看完整的主题切换记录
   - 提供历史记录导出功能（CSV格式）
   - 提供历史记录清除功能，清除后显示确认提示："主题历史已清除"
   - 清除提示持续2秒后自动消失
9. **主题使用统计**：
   - 统计用户主题使用时长（浅色/深色）
   - 统计主题切换频率（每天/每周/每月）
   - 在设置中提供"主题使用统计"查看入口
   - 使用图表展示（饼图、柱状图）
   - 提供数据导出功能（CSV、JSON格式）
   - 帮助用户了解自己的使用习惯
   - 统计数据定期备份到localStorage
10. **智能推荐**：
    - 根据用户使用习惯推荐主题
    - 如果用户在晚上9点到早上7点主要使用深色主题
    - 显示推荐提示："检测到您习惯在夜间使用深色主题，是否启用自动切换？"
    - 提供"启用自动切换"按钮，点击后开启自动切换功能
    - 自动切换根据系统时间自动切换主题
    - 提供时间设置：白天开始时间（默认7:00）、夜晚开始时间（默认21:00）
    - 支持自定义时间，精确到分钟
    - 自动切换前10分钟显示预告提示："即将在10分钟后切换到深色主题"
    - 预告提示带有倒计时，持续10秒后自动消失
    - 提供立即切换按钮，点击后立即切换主题
    - 提供取消按钮，点击后取消本次自动切换
11. **异常处理**：
    - 如果localStorage读取失败，显示错误提示："无法恢复主题设置，使用默认主题"
    - 错误提示使用红色背景，持续3秒后自动消失
    - 记录错误日志到控制台
    - 如果云端同步失败，显示错误提示（见多设备同步）
    - 如果主题历史记录读取失败，显示提示："主题历史记录不可用"
    - 如果统计数据计算失败，显示提示："主题统计数据不可用"
    - 所有异常都不影响主要功能，应用继续正常运行
12. **响应时间要求**：
    - 首次访问初始化时间<500ms（从打开到完全显示）
    - 主题切换执行时间<500ms（从点击到完全显示新主题）
    - 刷新页面恢复时间<600ms（从刷新到完全恢复）
    - 跨会话恢复时间<600ms（从打开到完全恢复）
    - localStorage读取时间<100ms
    - 云端同步时间<2秒（异步执行）
    - 历史记录读取时间<200ms
    - 统计数据计算时间<500ms
    - 所有提示显示时间<50ms
    - 所有动画帧率保持60fps
13. **用户反馈**：
    - 所有重要操作都有明确的反馈提示
    - 提示内容简洁明了，避免技术术语
    - 提示持续时间合理（1.5-5秒），不干扰用户
    - 提示位置固定在屏幕顶部，不遮挡主要操作区域
    - 提示颜色编码：绿色（成功）、黄色（警告）、红色（错误）、蓝色（信息）
    - 提供手动关闭按钮，点击后立即关闭提示
    - 支持用户自定义提示显示（在设置中提供选项）
    - 支持用户禁用提示（在设置中提供"禁用提示"选项）
    - 如果禁用提示，使用静默通知（状态栏小图标）
    - 静默通知点击后显示详细信息
14. **性能优化**：
    - 主题设置使用缓存，减少localStorage读取次数
    - 历史记录批量写入，减少存储操作
    - 统计数据异步计算，不阻塞UI
    - 云端同步使用Web Worker，不阻塞主线程
    - 提示使用CSS动画，触发GPU加速
    - 避免频繁的DOM操作
    - 使用requestAnimationFrame确保动画流畅
    - 定期清理过期数据（每24小时清理一次）
    - 历史记录限制为最近10条，避免占用过多存储空间

#### 主题可访问性交互流程
1. **对比度验证**：
   - 浅色主题：深色文字在浅色背景上对比度足够
   - 深色主题：浅色文字在深色背景上对比度足够
   - 符合WCAG 2.1标准（至少4.5:1）
   - 大号文字（18pt以上）对比度至少3:1
   - 使用自动化工具定期验证对比度（如axe-core、contrast-checker）
   - 如果发现对比度不达标，自动调整颜色
   - 显示验证提示："已优化文字对比度，提升可读性"
   - 提示在屏幕顶部显示2秒后自动消失
   - 提供对比度检查工具，在设置中提供入口
   - 用户可以手动检查任意元素的对比度
   - 工具显示对比度比值、WCAG评级、建议改进
2. **焦点可见性**：
   - 主题切换不影响键盘导航
   - 焦点元素在新主题下清晰可见
   - 焦点样式保持一致
   - 使用outline: 2px solid blue作为焦点指示器
   - 焦点指示器不占用布局空间（outline-offset: 2px）
   - 焦点指示器颜色与主题背景形成高对比度
   - 浅色主题：深蓝色焦点（#0000FF）
   - 深色主题：浅蓝色焦点（#4FC3F7）
   - 焦点获得时，显示焦点动画（scale: 1.05）
   - 焦点丢失时，动画立即消失
   - 焦点指示器使用CSS transition，过渡时间150ms
   - 支持用户自定义焦点样式（在设置中提供选项）
   - 提供多种焦点样式：实线、虚线、双线、发光效果
   - 用户可以选择适合自己视力需求的焦点样式
   - 显示焦点预览，帮助用户选择
3. **动画偏好尊重**：
   - 检测用户的系统动画偏好（prefers-reduced-motion）
   - 如果用户禁用动画：减少过渡效果
   - 如果用户偏好减弱动画：使用更快的过渡（150ms代替300ms）
   - 自动应用系统偏好，无需用户手动设置
   - 显示应用提示："已应用您的动画偏好设置"
   - 提示在屏幕顶部显示2秒后自动消失
   - 在设置中显示当前动画偏好状态
   - 提供"动画效果"选项：跟随系统、禁用动画、减少动画、正常动画
   - 用户可以手动覆盖系统偏好
   - 设置更改立即生效，无需刷新页面
   - 记录动画偏好日志："[a11y] Animation preference changed: reduced"
4. **高对比度模式**（可选）：
   - 检测系统是否启用了高对比度模式（prefers-contrast: more）
   - 如果启用：应用高对比度主题变体
   - 高对比度主题特点：
     - 颜色更加鲜明（黑色/白色/纯色）
     - 去除渐变和阴影效果
     - 增加边框宽度（2px代替1px）
     - 使用更粗的字体（font-weight: 600）
     - 增加文字与背景的对比度（至少7:1）
   - 显示模式切换提示："已启用高对比度模式"
   - 提示使用黄色背景，持续3秒后自动消失
   - 在设置中显示高对比度模式状态
   - 提供"高对比度模式"开关，手动启用/禁用
   - 开关状态实时保存到localStorage
   - 高对比度模式下的所有元素都经过手动验证
   - 确保视觉障碍用户也能正常使用
   - 提供高对比度预览，切换前可以预览效果
   - 预览在模态框中显示，包含所有主要界面元素
   - 提供"应用"和"取消"按钮
5. **屏幕阅读器支持**：
   - 主题切换时，屏幕阅读器朗读："主题已切换为：深色/浅色"
   - 使用aria-live="polite"属性，确保状态变化被及时朗读
   - 使用aria-label属性，提供按钮和图标的描述
   - 主题按钮：aria-label="切换主题，当前为深色主题"
   - 设置按钮：aria-label="打开系统设置"
   - 收缩按钮：aria-label="收缩/展开侧边栏"
   - 使用role="button"属性，明确元素功能
   - 使用aria-pressed属性，表示按钮的按下状态
   - 使用aria-expanded属性，表示可展开/折叠元素的状态
   - 所有动态内容更新都使用aria-live区域
   - 提供屏幕阅读器测试工具，在设置中提供入口
   - 工具可以测试所有元素的aria属性
   - 工具显示屏幕阅读器朗读的文本预览
   - 工具显示aria属性验证结果（通过/失败）
6. **键盘导航增强**：
   - 支持完整的键盘导航（Tab、Shift+Tab、Enter、Space、Escape）
   - 主题按钮可以使用Tab键导航到
   - 按Enter或Space键触发主题切换
   - 按Escape键关闭所有模态框和下拉菜单
   - 键盘焦点顺序符合逻辑：从左到右、从上到下
   - 焦点陷阱：模态框打开时，焦点限制在模态框内
   - 模态框关闭后，焦点返回到触发元素
   - 显示键盘导航提示："按Tab键导航，按Enter键选择"
   - 提示在首次使用键盘导航时显示
   - 提示在屏幕底部显示5秒后自动消失
   - 提供键盘快捷键列表（按?键显示）
   - 快捷键包括：主题切换（T）、设置（S）、收缩（[ ]）、关闭（Esc）
   - 所有快捷键都可以在设置中自定义
   - 显示快捷键冲突检测，避免重复使用
7. **色彩盲友好设计**：
   - 不仅依赖颜色传达信息
   - 使用图标、形状、文字等多种方式传达信息
   - 在线状态：绿色圆点 + 文字"在线"
   - 离线状态：红色方块 + 文字"离线"
   - 错误状态：红色边框 + 错误图标 + 文字说明
   - 成功状态：绿色边框 + 成功图标 + 文字说明
   - 警告状态：黄色边框 + 警告图标 + 文字说明
   - 提供色彩盲模拟工具，在设置中提供入口
   - 工具可以模拟不同类型的色彩盲（红绿色盲、蓝黄色盲等）
   - 工具显示模拟后的界面效果
   - 工具提供改进建议
   - 支持用户自定义颜色方案（在设置中提供选项）
   - 提供预设方案：默认、色彩盲友好、高对比度、单色
   - 预设方案可以预览和切换
8. **字体大小调整**：
   - 支持用户自定义字体大小
   - 提供预设大小：小（14px）、中（16px）、大（18px）、特大（20px）
   - 提供自定义大小滑块（12px-24px）
   - 字体大小更改实时预览
   - 预览区域显示所有主要界面元素
   - 字体大小保存到localStorage
   - 刷新页面后自动恢复
   - 检测系统字体大小偏好（prefers-reduced-data）
   - 自动应用系统偏好
   - 显示应用提示："已应用您的字体大小偏好"
   - 提示在屏幕顶部显示2秒后自动消失
   - 字体大小不影响布局（使用相对单位em、rem）
   - 确保字体增大后元素不重叠、不溢出
9. **响应式设计**：
   - 主题适配各种屏幕尺寸（桌面、平板、手机）
   - 横屏和竖屏都能正常显示
   - 触摸设备优化：增大可点击区域（最小44x44px）
   - 触摸设备优化：增加按钮间距（最小8px）
   - 触摸设备优化：提供触觉反馈（振动）
   - 响应式断点：sm（640px）、md（768px）、lg（1024px）、xl（1280px）
   - 在每个断点都验证可访问性
   - 提供响应式测试工具，在设置中提供入口
   - 工具可以模拟不同屏幕尺寸
   - 工具显示当前屏幕尺寸和断点
   - 工具显示响应式布局问题（如果有）
10. **可访问性测试**：
    - 定期进行可访问性测试（每月一次）
    - 使用自动化测试工具（axe-core、pa11y、Lighthouse）
    - 生成可访问性报告
    - 报告包括：对比度、键盘导航、屏幕阅读器、色彩盲友好等
    - 报告评分：A、AA、AAA（WCAG等级）
    - 在设置中提供"可访问性报告"查看入口
    - 报告以PDF格式导出，便于分享
    - 报告包含具体的改进建议
    - 提供问题修复跟踪（已修复、进行中、待修复）
    - 显示修复进度百分比
    - 显示可访问性徽章（如"WCAG 2.1 AA 级别"）
    - 徽章在设置页面和关于信息中显示
11. **用户反馈收集**：
    - 提供可访问性反馈入口
    - 用户可以报告可访问性问题
    - 反馈表单包括：问题描述、使用场景、期望行为、联系方式
    - 反馈自动分类（对比度、键盘导航、屏幕阅读器等）
    - 反馈优先级标记（高、中、低）
    - 反馈处理时间<24小时
    - 处理完成后通知用户
    - 显示感谢提示："感谢您的反馈，我们将尽快处理"
    - 提示持续3秒后自动消失
    - 统计反馈数据，分析常见问题
    - 根据反馈持续改进可访问性
12. **响应时间要求**：
    - 焦点指示器显示时间<50ms（从获得焦点到显示）
    - 焦点指示器消失时间<50ms（从失去焦点到消失）
    - 高对比度模式切换时间<300ms（从检测到完全应用）
    - 屏幕阅读器朗读延迟<100ms（从状态变化到朗读）
    - 键盘导航响应时间<50ms（从按键到焦点移动）
    - 字体大小更改预览时间<100ms（实时预览）
    - 所有可访问性功能在主线程执行时间<100ms
    - 所有动画帧率保持60fps
13. **性能优化**：
    - 使用CSS变量管理主题，减少重复计算
    - 焦点指示器使用CSS outline，不触发重排
    - 高对比度模式使用CSS类切换，避免复杂逻辑
    - 屏幕阅读器属性使用aria-live，减少DOM更新
    - 键盘导航使用原生Tab顺序，避免JavaScript干预
    - 色彩盲模拟使用CSS filter，不影响性能
    - 字体大小使用相对单位，减少媒体查询
    - 可访问性测试在后台异步执行，不阻塞UI
    - 反馈收集使用防抖，避免频繁提交
14. **用户体验保障**：
    - 所有可访问性功能都经过真实用户测试
    - 测试用户包括：视力障碍、色彩盲、运动障碍、老年用户
    - 测试结果形成报告，指导产品改进
    - 所有可访问性功能都有清晰的说明和帮助文档
    - 提供在线可访问性帮助中心
    - 帮助中心包括：使用指南、常见问题、视频教程
    - 提供可访问性客服支持
    - 客服支持语音、视频、文字多种沟通方式
    - 持续关注可访问性标准和最佳实践
    - 定期更新可访问性功能，跟上技术发展
### 2.5.4 视觉设计要求

#### 主题按钮设计
- **按钮位置**：
  - 位于左侧边栏底部区域
  - 在设置按钮左侧
  - 距离底部边框16px（p-4）
- **按钮容器**：
  - 容器设计：内边距上下8px，左右12px（px-3 py-2）
  - 圆角：圆角8px（rounded-lg）
  - 过渡效果：transition-colors
  - 布局方式：Flexbox水平排列，间距8px（gap-2）
- **按钮图标尺寸**：
  - 图标大小：16x16px（w-4 h-4）
  - 图标类型：SVG矢量图标
  - 太阳图标：用于浅色主题显示
  - 月亮图标：用于深色主题显示
- **按钮文本**：
  - 字体大小：14px（text-sm）
  - 浅色主题：text-gray-600
  - 深色主题：text-gray-300
  - 与图标间距：8px（gap-2）
- **悬停效果**：
  - 浅色主题：hover:bg-gray-200
  - 深色主题：hover:bg-gray-700
  - 过渡时间：0.2s
- **收缩状态设计**：
  - 按钮变为竖向排列
  - 容器尺寸：40x40像素
  - 内边距：12px
  - 文本隐藏
  - 图标居中显示
  - 提示框在左侧显示

#### 配色方案
- **浅色主题配色**：
  - 主背景色：bg-gray-100（#f3f4f6）
  - 主文字色：text-gray-900（#111827）
  - 次要文字色：text-gray-600（#4b5563）
  - 辅助文字色：text-gray-400（#9ca3af）
  - 侧边栏背景：bg-white（#ffffff）
  - 边框色：border-gray-200（#e5e7eb）、border-gray-300（#d1d5db）
  - 搜索框背景：bg-gray-100（#f3f4f6）
  - 分组背景：bg-gray-100（#f3f4f6）
  - 智能体项悬停：hover:bg-gray-200（#e5e7eb）
  - 智能体项选中：bg-gradient-to-r from-e0e7ff to-dbeafe
  - 在线状态：bg-green-500（#10b981）、text-green-400（#4ade80）
  - 用户消息背景：bg-blue-100（#dbeafe）
  - 智能体消息背景：bg-gray-200（#e5e7eb）
  - 输入框背景：bg-gray-100（#f3f4f6）
  - 按钮区域背景：bg-gray-50（#f9fafb）
  - 附件背景：bg-gray-100（#f3f4f6）
  - 附件边框：border-gray-200（#e5e7eb）
  - 统计卡片背景：bg-gradient-to-br from-gray-100 to-gray-200
  - 统计数字：text-blue-600（#2563eb）、text-green-600（#059669）、text-purple-600（#7c3aed）
  - 主题按钮图标：text-gray-400（#9ca3af）
- **深色主题配色**：
  - 主背景色：bg-gray-900（#111827）
  - 主文字色：text-white（#ffffff）
  - 次要文字色：text-gray-300（#d1d5db）
  - 辅助文字色：text-gray-400（#9ca3af）
  - 侧边栏背景：bg-gray-800（#1f2937）
  - 边框色：border-gray-700（#374151）
  - 搜索框背景：bg-gray-700（#374151）
  - 分组背景：bg-gray-700/30（rgba(55, 65, 81, 0.3)）
  - 智能体项悬停：hover:bg-gray-700（#374151）
  - 智能体项选中：bg-gradient-to-r from-2563eb to-3b82f6
  - 在线状态：bg-green-500（#10b981）、text-green-400（#4ade80）
  - 用户消息背景：bg-blue-600（#2563eb）
  - 智能体消息背景：bg-gray-800（#1f2937）
  - 输入框背景：bg-gray-700（#374151）
  - 按钮区域背景：bg-gray-700（#374151）
  - 附件背景：bg-gray-700（#374151）
  - 附件边框：border-gray-600（#4b5563）
  - 统计卡片背景：bg-gray-800（#1f2937）
  - 统计数字：text-blue-400（#60a5fa）、text-green-400（#4ade80）、text-purple-400（#a78bfa）
  - 主题按钮图标：text-gray-300（#d1d5db）

#### 布局结构
- **侧边栏布局**：
  - 固定宽度：320px（w-80）
  - 收缩宽度：60px
  - 高度：100vh
  - 布局方式：Flexbox垂直排列（flex flex-col）
  - 滚动条：细滚动条，宽度6px
- **主内容区布局**：
  - 弹性宽度：flex-1，占满剩余空间
  - 布局方式：Flexbox垂直排列（flex flex-col）
  - 顶部栏高度：64px（h-16）
  - 内容区：flex-1
- **主题按钮布局**：
  - 展开状态：Flexbox水平排列（flex items-center gap-2）
  - 收缩状态：Flexbox垂直排列（flex items-center gap-2），方向改为column
- **底部设置区域布局**：
  - 容器：Flexbox水平排列，两端对齐（flex items-center justify-between）
  - 按钮组：Flexbox水平排列，间距8px（flex items-center gap-2）
  - 状态信息：Flexbox水平排列，间距16px（flex items-center gap-4）

#### 图标设计
- **太阳图标**（浅色主题）：
  - 图标类型：SVG矢量图标
  - 尺寸：16x16px
  - 颜色：text-gray-400（浅色主题）、text-gray-300（深色主题）
  - SVG路径：圆形太阳图标，带有8条光芒射线
  - 显示时机：当主题为浅色时显示
- **月亮图标**（深色主题）：
  - 图标类型：SVG矢量图标
  - 尺寸：16x16px
  - 颜色：text-gray-400（浅色主题）、text-gray-300（深色主题）
  - SVG路径：弯月形状图标
  - 显示时机：当主题为深色时显示
- **切换动画**：
  - 图标切换：立即替换SVG内容
  - 过渡效果：无特殊过渡，直接切换
  - 用户反馈：图标变化明显，易于识别

#### 提示框设计
- **容器设计**：
  - 相对定位容器（tooltip-container）
  - 定位方式：相对定位
- **提示框设计**：
  - 绝对定位（tooltip）
  - 位置：收缩状态下在左侧100%（left: 100%）
  - 垂直居中：transform translateY(-50%)
  - 外边距：左侧8px（margin-left: 8px）
  - 背景色：深灰色（bg-gray-800，#1f2937）
  - 文字颜色：白色（text-white，#f9fafb）
  - 内边距：上下4px，左右8px（px-1 py-2）
  - 圆角：4px
  - 字体大小：12px（text-xs）
  - 边框：1px深灰色边框（border border-gray-700，#374151）
  - 过渡效果：all 0.3s ease
  - z-index：1000
  - 透明度：默认0，visibility: hidden
  - 显示条件：侧边栏收缩且悬停时opacity: 1, visibility: visible
- **箭头设计**：
  - 使用伪元素::after创建
  - 位置：绝对定位，right: 100%, top: 50%
  - 变换：translateY(-50%)
  - 边框样式：4px实线边框，颜色透明
  - 边框颜色：border-color: transparent #1f2937 transparent transparent

#### 滚动条设计
- **深色主题滚动条**：
  - 轨道背景：#1f2937（gray-800）
  - 滑块背景：#4b5563（gray-600）
  - 滑块圆角：3px
  - 悬停滑块：#6b7280（gray-500）
- **浅色主题滚动条**：
  - 轨道背景：#e5e7eb（gray-200）
  - 滑块背景：#9ca3af（gray-400）
  - 滑块圆角：3px
  - 悬停滑块：#6b7280（gray-500）
- **滚动条尺寸**：宽度6px
- **应用范围**：侧边栏、聊天窗口等可滚动区域

#### 过渡动画
- **颜色过渡**：
  - 过渡属性：transition-colors
  - 过渡时间：0.2s或0.3s
  - 过渡效果：ease
  - 应用元素：所有按钮、智能体项、输入框等交互元素
- **侧边栏收缩过渡**：
  - 过渡属性：transition-width
  - 过渡时间：0.3s
  - 过渡效果：ease
  - 宽度变化：320px ↔ 60px
- **分组展开/折叠过渡**：
  - 过渡属性：transition-all
  - 过渡时间：0.3s
  - 过渡效果：ease
  - 高度变化：0 ↔ 500px
  - 透明度变化：0 ↔ 1
- **提示框过渡**：
  - 过渡属性：all
  - 过渡时间：0.3s
  - 过渡效果：ease
  - 透明度变化：0 ↔ 1
  - 可见性变化：hidden ↔ visible

#### 对比度与可访问性
- **文字对比度**：
  - 浅色主题：深色文字在浅色背景上对比度≥4.5:1
  - 深色主题：浅色文字在深色背景上对比度≥4.5:1
  - 符合WCAG 2.1标准
- **焦点指示器**：
  - 焦点状态：2px蓝色圆环（focus:ring-2 focus:ring-blue-500）
  - 应用元素：输入框、按钮等可交互元素
- **键盘导航**：
  - 支持Tab键导航
  - 主题按钮可通过键盘访问
  - 焦点顺序符合逻辑
- **屏幕阅读器支持**：
  - 使用语义化HTML标签
  - 按钮有明确的标签文本
  - 图标有aria-label属性

#### 主题一致性
- **颜色映射规则**：
  - text-gray-900 ↔ text-white（主文字）
  - text-gray-600 ↔ text-gray-300（次要文字）
  - text-gray-400 ↔ text-gray-400（辅助文字）
  - bg-gray-100 ↔ bg-gray-700（浅色背景）
  - bg-gray-200 ↔ bg-gray-800（中等背景）
  - border-gray-200 ↔ border-gray-700（边框颜色）
  - bg-white ↔ bg-gray-800（侧边栏背景）
  - bg-gray-50 ↔ bg-gray-900（主内容背景）
  - text-blue-600 ↔ text-blue-400（蓝色元素）
  - text-green-600 ↔ text-green-400（绿色元素）
  - text-purple-600 ↔ text-purple-400（紫色元素）
- **全局应用**：
  - 主题切换影响整个应用
  - 所有页面和组件保持一致的配色方案
  - 颜色映射规则统一应用
