# 开发环境配置

本文档定义了AutoMate项目的开发环境配置规范和最佳实践。

## 1. 开发服务器配置

### 1.1 服务器启动位置

**重要原则**：开发服务器必须在项目根目录启动，以确保正确访问所有资源。

**项目根目录**：`f:\AI软件\AutoMate`

**正确的启动方式**：
```bash
cd "f:\AI软件\AutoMate"
python -m http.server 8080
```

**错误的启动方式**：
```bash
cd "f:\AI软件\AutoMate\prototypes"
python -m http.server 8080
```

**原因**：
- Python http.server 默认不允许访问上级目录（安全限制）
- 在子目录启动会导致无法访问 `config/` 目录
- 会导致配置文件加载失败（404错误）

### 1.2 资源路径规范

**HTML中的资源路径**：
- 使用绝对路径：`/config/agents.json`
- 不使用相对路径：`../config/agents.json`

**原因**：
- 服务器在根目录启动时，绝对路径更可靠
- 避免因文件位置变化导致的路径错误
- 与生产环境路径保持一致

### 1.3 访问地址

**开发服务器地址**：`http://localhost:8080`

**原型页面地址**：`http://localhost:8080/prototypes/MainLayout.html`

**配置文件地址**：`http://localhost:8080/config/agents.json`

## 2. 目录结构

### 2.1 项目目录布局

```
AutoMate/
├── config/              # 配置文件目录
│   └── agents.json    # 智能体配置文件
├── prototypes/          # 原型文件目录
│   ├── MainLayout.html # 主界面原型
│   └── css/          # 样式文件
├── docs/              # 文档目录
├── skills/            # 技能存储目录
├── data/              # 数据存储目录
└── logs/              # 日志目录
```

### 2.2 关键目录说明

| 目录 | 用途 | 访问要求 |
| :--- | :--- | :--- |
| `config/` | 存储智能体配置文件 | 必须可读 |
| `prototypes/` | 存储HTML原型文件 | 必须可读 |
| `docs/` | 存储项目文档 | 必须可读 |
| `skills/` | 存储技能脚本 | 必须可读写 |
| `data/` | 存储数据库文件 | 必须可读写 |
| `logs/` | 存储运行日志 | 必须可读写 |

## 3. 配置文件管理

### 3.1 agents.json 配置文件

**文件路径**：`./config/agents.json`

**加载方式**：通过 fetch API 加载

**示例代码**：
```javascript
fetch('/config/agents.json')
  .then(response => response.json())
  .then(data => {
    // 处理配置数据
  })
  .catch(error => {
    console.error('加载配置失败:', error);
  });
```

**错误处理**：
- 404错误：检查服务器启动位置和文件路径
- JSON解析错误：检查配置文件格式
- 权限错误：检查文件读取权限

### 3.2 配置文件格式

**JSON结构**：
```json
{
  "agents": [
    {
      "group_name": "分组名称",
      "agents": [
        {
          "id": "agent-001",
          "name": "智能体名称",
          "description": "描述信息",
          "avatar": "avatar.png",
          "type": "general",
          "config": {
            "url": "model-url",
            "api_key": "your-api-key",
            "model": "gpt-3.5-turbo"
          },
          "skills": []
        }
      ]
    }
  ],
  "skills": {}
}
```

**验证要点**：
- JSON格式正确性
- 必填字段完整性
- 分组名称唯一性
- 智能体ID唯一性

## 4. 开发工具配置

### 4.1 Python HTTP 服务器

**启动命令**：
```bash
python -m http.server 8080
```

**常用参数**：
- `--bind 0.0.0.0`：绑定到所有网络接口
- `--directory /path/to/dir`：指定服务目录
- `8080`：端口号

**注意事项**：
- 默认不允许访问上级目录
- 端口被占用会报错
- Ctrl+C 停止服务器

### 4.2 端口配置

**常用端口**：
- `8080`：开发服务器默认端口
- `3000`：Vite 开发服务器端口
- `5173`：Vite 默认端口

**端口冲突处理**：
1. 检查端口占用：`netstat -ano | findstr :8080`
2. 更换端口：使用其他可用端口
3. 停止占用进程：`taskkill /PID <pid> /F`

## 5. 浏览器调试

### 5.1 开发者工具

**常用功能**：
- **Console**：查看JavaScript错误和日志
- **Network**：检查网络请求和响应
- **Elements**：检查DOM结构和样式
- **Sources**：调试JavaScript代码

### 5.2 常见问题排查

**配置文件加载失败**：
1. 检查服务器启动位置
2. 检查文件路径是否正确
3. 检查浏览器Console错误信息
4. 检查Network标签中的请求状态

**样式加载失败**：
1. 检查CSS文件路径
2. 检查文件是否存在
3. 清除浏览器缓存
4. 检查Network标签中的请求状态

**JavaScript错误**：
1. 查看Console错误信息
2. 检查语法错误
3. 检查变量未定义错误
4. 检查异步操作错误

## 6. 最佳实践

### 6.1 开发流程

1. **启动服务器**：在项目根目录启动
2. **打开浏览器**：访问 `http://localhost:8080/prototypes/MainLayout.html`
3. **打开开发者工具**：F12 或右键 -> 检查
4. **修改代码**：编辑HTML或配置文件
5. **刷新页面**：Ctrl+R 或 F5
6. **查看效果**：检查Console和Network

### 6.2 错误处理

**配置加载失败**：
- 显示友好错误提示
- 提供重试按钮
- 记录错误日志

**网络请求失败**：
- 检查服务器是否运行
- 检查端口是否正确
- 检查防火墙设置

**文件权限错误**：
- 检查文件权限设置
- 检查文件是否被占用
- 检查磁盘空间

### 6.3 性能优化

**减少刷新次数**：
- 使用浏览器自动刷新功能
- 使用热重载（如Vite）
- 只修改必要的代码

**缓存管理**：
- 开发时禁用缓存
- 使用Ctrl+Shift+R强制刷新
- 清除浏览器缓存

## 7. 参考资源

- [Python http.server 文档](https://docs.python.org/3/library/http.server.html)
- [Chrome 开发者工具](https://developer.chrome.com/docs/devtools/)
- [MDN Web 文档](https://developer.mozilla.org/)
