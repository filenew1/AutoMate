# 智能体模块

本文档定义了AutoMate项目中智能体模块的详细设计。

## 1. 模块概述

### 1.1 模块功能

智能体模块负责智能体的加载、分组、搜索、状态管理等功能。

### 1.2 参考原型

- [MainLayout.html](../../prototypes/MainLayout.html)

## 2. 功能流程

### 2.1 应用启动时自动加载

**触发场景：** 系统启动时

**处理流程：**

1. 读取配置文件（默认路径：`./config/agents.json`）
2. 显示启动加载动画和提示信息
3. 解析JSON配置，按`group_name`字段对智能体进行分组
4. 渲染分组信息和智能体列表到左侧边栏
5. 加载完成后显示"加载完成"提示

**重要注意事项：**

**开发服务器配置**：
- 开发服务器必须在项目根目录（`f:\AI软件\AutoMate`）启动
- 使用命令：`cd "f:\AI软件\AutoMate" && python -m http.server 8080`
- 在子目录（如 `prototypes/`）启动会导致无法访问 `config/` 目录

**资源路径规范**：
- 使用绝对路径：`/config/agents.json`
- 不使用相对路径：`../config/agents.json`
- 确保服务器在根目录启动时路径正确

**错误处理：**
- 配置文件不存在：显示友好错误提示并提供默认配置
- 配置文件格式错误：显示错误位置和修复建议
- 配置文件为空：显示"无智能体配置"提示
- 配置文件权限不足：显示权限错误提示
- 404错误：检查服务器启动位置和文件路径

### 2.2 智能体配置管理

**触发场景：** 配置文件被修改时

**处理流程：**

1. 监听配置文件变更事件
2. 读取变更后的配置文件内容
3. 解析配置文件并验证格式
4. 对比配置差异，生成变更报告
5. 更新内存中的智能体配置
6. 重新渲染智能体列表
7. 显示"配置已更新"提示

**错误处理：**

- 文件被占用：显示占用提示并提供重试选项
- 权限不足：显示权限错误提示
- 配置格式错误：显示错误位置和修复建议

### 2.3 智能体分组展示

**触发场景：** 配置加载完成后、用户创建/删除/重命名分组时

**处理流程：**

1. 按`group_name`字段聚合智能体
2. 处理分组名称重复的情况（添加数字后缀）
3. 维护分组的展开/折叠状态
4. 保存分组状态到本地存储
5. 渲染分组和智能体列表

**错误处理：**

- 分组为空：显示"该分组无智能体"提示
- 分组删除时包含智能体：提示用户移动智能体

### 2.4 智能体搜索

**触发场景：** 用户在搜索框输入内容时

**处理流程：**

1. 实时获取搜索框输入
2. 对输入进行清理和验证
3. 按名称、描述等字段进行匹配
4. 高亮匹配的文本内容
5. 限制搜索结果数量
6. 显示搜索结果

**错误处理：**

- 搜索输入为空：显示全部智能体列表
- 搜索词过长：限制搜索词长度
- 无匹配结果：显示"未找到匹配的智能体"提示

### 2.5 智能体选择与状态

**触发场景：** 用户点击智能体列表项时

**处理流程：**

1. 识别点击的智能体ID
2. 更新智能体选中状态
3. 切换主内容区显示的聊天窗口
4. 保存最后选中的智能体到本地存储
5. 加载智能体相关的技能列表

**错误处理：**

- 智能体数据加载失败：显示错误提示和重试按钮

### 2.6 智能体状态展示

**触发场景：** 应用启动时、定期检查时

**处理流程：**

1. 检查智能体的在线状态
2. 计算响应时间
3. 更新状态记录
4. 更新状态指示（绿色/红色状态点）
5. 记录最后在线时间

**错误处理：**

- 状态检查失败：保持上次状态并显示错误提示
- 网络连接中断：显示离线提示

### 2.7 智能体状态展示

### 3.1 页面布局

**左侧边栏：**

- 固定宽度280px（默认），支持拖拽调整宽度（范围：200px-500px）
- 搜索区域：顶部固定高度，带搜索图标和清空按钮
- 智能体列表：可滚动区域，分组显示
- 底部设置：固定高度，包含主题切换和设置按钮

### 3.2 配色方案

**浅色主题：**

- 侧边栏背景：`#ffffff`
- 分组头部背景：`#f3f4f6`
- 智能体项背景：默认透明，hover时`#f9fafb`
- 选中智能体背景：`linear-gradient(135deg, #e0e7ff 0%, #dbeafe 50%, #ede9fe 100%)`
- 文本颜色：智能体名称`#1e40af`，描述`#6b7280`
- 在线状态：`#10b981`

**深色主题：**

- 侧边栏背景：`#1f2937`
- 分组头部背景：`#374151`
- 智能体项背景：默认透明，hover时`#374151`
- 选中智能体背景：`linear-gradient(135deg, rgba(37, 99, 235, 0.3) 0%, rgba(59, 130, 246, 0.4) 100%)`
- 文本颜色：智能体名称`#93c5fd`，描述`#9ca3af`
- 在线状态：`#34d399`

### 3.3 按钮样式

- **主题切换按钮**：图标按钮，圆角，悬停时背景色变化
- **设置按钮**：图标按钮，圆角，悬停时背景色变化
- **搜索清空按钮**：圆形按钮，位于搜索框右侧

### 3.4 字体排版

- 智能体名称：14px，中等字重
- 智能体描述：12px，常规字重
- 分组名称：14px，半粗体
- 状态文字：12px，浅色
- 版本信息：12px，浅色

### 3.5 动画效果

- 智能体项选中：左侧渐变指示条从0到100%的缩放动画
- 智能体项悬停：轻微右移（2px），背景色渐变
- 在线状态：呼吸动画（2秒循环），阴影扩散效果
- 分组折叠/展开：平滑高度过渡动画（0.3秒）
- 侧边栏收缩/展开：宽度变化动画（0.3秒）

## 4. UI元素

### 4.1 侧边栏容器

- **id**：`sidebar`
- **默认宽度**：280px
- **调整范围**：200px-500px
- **收缩状态宽度**：60px
- **样式类**：`sidebar-collapsed`（收缩状态）
- **过渡动画**：宽度变化动画（0.3秒）

### 4.2 搜索区域

**搜索输入框：**

- **id**：`searchInput`
- **placeholder**："搜索智能体..."
- **图标**：搜索图标（SVG），位于左侧
- **聚焦效果**：蓝色边框和阴影
- **样式**：圆角，浅灰色背景

**搜索清空按钮：**

- **id**：`searchClearBtn`
- **显示条件**：搜索框内容非空时显示
- **图标**：叉号图标（SVG）
- **样式类**：`search-clear-btn`

**搜索高亮：**

- **样式类**：`search-highlight`
- **浅色主题**：黄色背景（#fef08a到#fde047渐变），棕色文本（#854d0e）
- **深色主题**：深棕色背景（#713f12到#a16207渐变），黄色文本（#fef08a）

### 4.3 智能体分组

**分组头部：**

- **样式类**：`group-header`
- **折叠状态**：添加`collapsed`类
- **图标**：Chevron图标（SVG），折叠时旋转-90度
- **悬停效果**：背景色变化，左侧蓝色边框

**分组内容：**

- **样式类**：`group-content`
- **展开状态**：`expanded`类
- **折叠状态**：`collapsed`类
- **动画**：平滑高度过渡动画（0.3秒）

### 4.4 智能体项

**基本属性：**

- **样式类**：`agent-item`
- **选中状态**：添加`selected`类
- **数据属性**：`data-agent-id`, `data-agent-name`, `data-agent-avatar`

**头像：**

- **尺寸**：48px × 48px
- **样式**：圆形渐变背景
- **图标**：SVG图标（白色，7px × 7px）

**在线状态：**

- **尺寸**：12px × 12px
- **在线**：绿色（#10b981）圆点，2px白色边框
- **离线**：红色圆点，2px白色边框
- **动画**：呼吸动画（2秒循环）
- **位置**：头像右下角

**文本信息：**

- **名称**：14px，中等字重，蓝色文本（#1e40af）
- **描述**：12px，常规字重，浅色文本（#6b7280）
- **状态文字**：12px，绿色文本（#10b981）

### 4.5 底部设置区域

**主题切换按钮：**

- **图标**：太阳/月亮SVG图标（4px × 4px）
- **提示**："主题"（tooltip）
- **悬停效果**：背景色变化（#f9fafb）

**设置按钮：**

- **图标**：设置SVG图标（4px × 4px）
- **提示**："设置"（tooltip）
- **悬停效果**：背景色变化（#f9fafb）

**版本信息：**

- **格式**："v1.0.0"
- **样式**：12px，浅色文本（#6b7280）

## 5. 数据存储

### 5.1 智能体配置

- 智能体信息以JSON格式存储
- 配置文件路径：`./config/agents.json`
- 无需数据库表

### 5.2 相关日志存储

- **聊天消息日志**：存储用户和智能体之间的聊天消息
- **技能调用日志**：存储智能体调用技能的记录

## 6. 数据逻辑

### 6.1 智能体配置加载逻辑

**触发场景：** 应用启动时

**数据来源：** 本地JSON配置文件

**处理流程：**

1. 读取配置文件内容
2. 解析JSON格式数据
3. 按`group_name`字段对智能体进行分组
4. 验证配置格式的合法性
5. 生成智能体列表数据结构

**数据去向：** 内存中的智能体管理对象，用于渲染左侧边栏

**错误处理：**

- 配置文件不存在：使用默认配置
- 配置文件格式错误：显示错误位置并使用默认配置

### 6.2 智能体分组逻辑

**触发场景：** 配置加载完成后、用户创建/删除/重命名分组时

**数据来源：** 解析后的智能体配置数据、用户操作输入

**处理流程：**

1. 按`group_name`字段聚合智能体
2. 处理分组名称重复的情况（添加数字后缀）
3. 维护分组的展开/折叠状态
4. 保存分组状态到本地存储

**数据去向：** 左侧边栏的分组展示、本地存储的分组状态

### 6.3 智能体搜索逻辑

**触发场景：** 用户在搜索框输入内容时

**数据来源：** 用户输入的搜索关键词、内存中的智能体列表

**处理流程：**

1. 实时获取搜索框输入
2. 对输入进行清理和验证
3. 按名称、描述等字段进行匹配
4. 高亮匹配的文本内容
5. 限制搜索结果数量

**数据去向：** 搜索结果列表的展示

**错误处理：**

- 搜索输入为空：显示全部智能体列表
- 无匹配结果：显示"未找到匹配的智能体"提示

### 6.4 智能体选择逻辑

**触发场景：** 用户点击智能体列表项时

**数据来源：** 用户点击操作、内存中的智能体列表

**处理流程：**

1. 识别点击的智能体ID
2. 更新智能体选中状态
3. 切换主内容区显示的聊天窗口
4. 保存最后选中的智能体到本地存储
5. 加载智能体相关的技能列表

**数据去向：** 主内容区的聊天窗口、本地存储的选中状态

**错误处理：**

- 智能体数据加载失败：显示错误提示和重试按钮

### 6.5 智能体状态检查逻辑

**触发场景：** 应用启动时、定期检查时

**数据来源：** 智能体配置、网络连接状态、状态记录

**处理流程：**

1. 检查智能体的在线状态
2. 计算响应时间
3. 更新状态记录
4. 更新状态指示（绿色/红色状态点）
5. 记录最后在线时间

**数据去向：** 状态记录、智能体列表项的状态显示

**错误处理：**

- 状态检查失败：保持上次状态并显示错误提示
- 网络连接中断：显示离线提示并更新状态记录

## 7. 参考资源

- [智能体配置示例](../../config/agents.json)
- [原型设计页面](../../prototypes/MainLayout.html)
- [开发环境配置规范](../基础规范/开发环境配置.md)
